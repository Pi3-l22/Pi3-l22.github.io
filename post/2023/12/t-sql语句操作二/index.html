<!DOCTYPE html>
<html lang="zh-cn">

<head>
  
  <script>
    (function() {
      const currentTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', currentTheme);
    })();
  </script>

  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="LiuChao">

  
  
  <meta name="description" content="数据库实验之T-SQL语句操作(二)">
  

  
  <link rel="icon" href="/favicon.ico">

  
  
  <meta name="keywords" content=" study  latex  life  academic ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:url" content="/post/2023/12/t-sql%E8%AF%AD%E5%8F%A5%E6%93%8D%E4%BD%9C%E4%BA%8C/">
  <meta property="og:site_name" content="Pi3&#39;s Notes">
  <meta property="og:title" content="T-SQL语句操作(二)">
  <meta property="og:description" content="数据库实验之T-SQL语句操作(二)">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-12-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-12-17T00:00:00+00:00">
    <meta property="article:tag" content="学习">
    <meta property="article:tag" content="SQLServer">
    <meta property="article:tag" content="SQL">


  
  <link rel="canonical" href="/post/2023/12/t-sql%E8%AF%AD%E5%8F%A5%E6%93%8D%E4%BD%9C%E4%BA%8C/">

  
  
  
  <meta itemprop="name" content="T-SQL语句操作(二)">
  <meta itemprop="description" content="数据库实验之T-SQL语句操作(二)">
  <meta itemprop="datePublished" content="2023-12-17T00:00:00+00:00">
  <meta itemprop="dateModified" content="2023-12-17T00:00:00+00:00">
  <meta itemprop="wordCount" content="4969">
  <meta itemprop="keywords" content="学习,SQLServer,SQL">

  
  <link media="screen" rel="stylesheet" href='/css/common.css'>
  <link media="screen" rel="stylesheet" href='/css/content.css'>
  
  <link media="screen" rel="stylesheet" href='/css/theme.css'>
  
  <link media="screen" rel="stylesheet" href='/css/iconfont/iconfont.css'>
  
  <link rel="stylesheet" href='/css/syntax/xcode.css' 
    data-theme-style="light" 
    media="(prefers-color-scheme: light)">
  <link rel="stylesheet" href='/css/syntax/catppuccin-mocha.css' 
    data-theme-style="dark" 
    media="not all">

  
  
  <title>T-SQL语句操作(二) - Pi3&#39;s Notes</title>
  

  
  

  
<link rel="stylesheet" href='/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="/">Pi3&#39;s Notes</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/">主页</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/post/">归档</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/about/">关于</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link theme-toggle" href="javascript:void(0);">黑暗</a>
    </span>
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1>T-SQL语句操作(二)</h1>
  
  <div>
    <b>Keywords: </b>
    
    <a class="link" href='/tags/%E5%AD%A6%E4%B9%A0'>#学习</a>
    
    <a class="link" href='/tags/sqlserver'>#SQLServer</a>
    
    <a class="link" href='/tags/sql'>#SQL</a>
    
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#select语句的数据统计功能">SELECT语句的数据统计功能</a></li>
    <li><a href="#视图的创建与应用">视图的创建与应用</a>
      <ul>
        <li><a href="#利用ssms创建视图">利用SSMS创建视图</a></li>
        <li><a href="#利用t-sql创建视图">利用T-SQL创建视图</a></li>
      </ul>
    </li>
    <li><a href="#数据库关系图的关系">数据库关系图的关系</a></li>
    <li><a href="#触发器的使用">触发器的使用</a></li>
    <li><a href="#存储过程">存储过程</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content">
    
    <p>1、实验目的
  熟练掌握T-SQL的统计功能与视图、关系图、触发器和存储过程的使用
2、实验内容与要求
（1）SELECT语句的数据统计功能
（2）视图的创建与应用
（3）数据库关系图的使用
（4）触发器的使用
（5）存储过程的使用
要求：给出完整的T-SQL语句与操作结果或SSMS的操作界面。
3、实验环境
Microsoft SQL Server (Express) + SQL Server Management Studio</p>
<h2 id="select语句的数据统计功能">SELECT语句的数据统计功能</h2>
<p>SELECT数据统计的语句格式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="err">分组列表</span><span class="o">&gt;</span><span class="p">,]</span><span class="err">{</span><span class="o">&lt;</span><span class="err">统计表达式</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[[</span><span class="k">AS</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="err">别名</span><span class="o">&gt;</span><span class="p">]</span><span class="err">}</span><span class="p">[,</span><span class="err">……</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="err">数据源</span><span class="o">&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">[</span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="err">条件表达式</span><span class="o">&gt;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">[</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">  </span><span class="o">&lt;</span><span class="err">分组列表</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">HAVING</span><span class="w"> </span><span class="o">&lt;</span><span class="err">分组筛选条件</span><span class="o">&gt;</span><span class="p">]]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">[</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="err">排序列表</span><span class="o">&gt;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>说明：
（1） &lt;统计表达式&gt;是由T-SQL统计函数组成，一般要定义一个别名。
（2） GROUP BY子句表示要以&lt;分组列表&gt;进行分组统计，若省略，则不分组，得到一个整个结果集的统计结果。
（3）HAVING短语与GROUP BY配合使用，它对分组统计的结果进行筛选， 语句中的&lt;统计表达式&gt;应出现在 &lt;分组筛选条件&gt;中。
（4）注意WHERE子句与HAVING短语的区别。WHERE决定参与统计	的记录，HAVING决定统计后的结果。</p>
<p>常用的统计函数
1）COUNT——计数
格式：<code>COUNT(*| [DISTINCT]&lt;列名&gt;)</code></p>
<p>2）MAX——求最大值
格式：<code>MAX(&lt;列名&gt;)</code></p>
<p>3）MIN——求最小值
格式：<code>MIN(&lt;列名&gt;)</code></p>
<p>4）AVG——求平均值
格式：<code>AVG(&lt;数值型列名&gt;)</code></p>
<p>5）SUM——求和
格式：<code>SUM(&lt;数值型列名&gt;)</code></p>
<p><strong>实现下列数据查询、统计功能:</strong></p>
<p>1）统计计算机学院的教师人数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_teacher</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">instno</span><span class="o">=</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">instno</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;计算机学院&#39;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>2）统计网络工程专业每个学生的选课课程数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">sname</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;课程数&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">majorno</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">majoyname</span><span class="o">=</span><span class="s1">&#39;网络工程&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">sname</span><span class="w">
</span></span></span></code></pre></div><p>3）统计“数据库”课程的最高分、最低分和平均成绩</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;最高分&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MIN</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;最低分&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AVG</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;平均分&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cno</span><span class="o">=</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">cno</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>4）查询“数据库”课程高于平均分的学生学号和成绩</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="o">&gt;</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">cno</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>5）查询“数据库”课程成绩最高的学生学号和姓名（采用MAX函数和子查询）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">sname</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="o">=</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">cno</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>6）查询平均分高于75分的课程号</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQl" data-lang="SQl"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">cno</span><span class="o">=</span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">75</span><span class="w">
</span></span></span></code></pre></div><p>7）查询计算机学院平均分高于75分的学生学号</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">majorno</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;计算机学院&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">having</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">75</span><span class="w">
</span></span></span></code></pre></div><p>8）统计有不及格成绩的学生人数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;不及格人数&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="o">&lt;</span><span class="mi">60</span><span class="w">
</span></span></span></code></pre></div><p>9）查询选课人数少于10人的课程号</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQl" data-lang="SQl"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="视图的创建与应用">视图的创建与应用</h2>
<h3 id="利用ssms创建视图">利用SSMS创建视图</h3>
<p>下面以创建与tab_score对应的成绩视图View_score为例，说明视图的创建过程。
（1）打开SSMS，打开“stuinfo”数据库文件夹，选择“视图”。
（2）单击右键，在快捷菜单中选择“新建视图…”。
（3）在“添加表”对话框中选择视图所需要的表，本例需要选择tab_student、tab_course、tab_teacher和tab_score这4个表。表的选择顺序没有特别要求，但一般先选择外部键所在的表（tab_score），在选择主键所在的表（另外3个表），然后关闭对话框。
（4）选择视图的列名，在表区的4个表中选择视图要映射的列（主键和外部键一般选外部键，即1:n联系的n端表中的列）。本例选择tab_score中的sno、cno、tno、score，在另外3个表中分别选sname、cname、tname。此时可在视图列区用鼠标拖动列名左边的小方块可以调整列在语句中的位置。
（5）点击“保存”或“关闭”按钮，在“选择名称”对话框中输入视图名“View_score”，单击“确定”，操作结束。</p>
<h3 id="利用t-sql创建视图">利用T-SQL创建视图</h3>
<p>语句格式</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="w">	</span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">&lt;</span><span class="err">视图名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[(</span><span class="o">&lt;</span><span class="err">视图列表</span><span class="o">&gt;</span><span class="p">)]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">&lt;</span><span class="err">子查询</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">WITH</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="k">OPTION</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>说明：
1） WITH CHECK OPTION选项，表示在对视图进行UPDATE、INSERT和DELETE操作时要满足视图&lt;子查询&gt;中的WHERE条件。
2） &lt;视图列表&gt;用来指定视图中的列名，一般省略不用。视图中的列名由&lt;子查询&gt;的SELECT语句的查询列表指定，若其中出现来自多表的同名列或表达式可以定义列别名。</p>
<p><strong>利用SSMS和T-SQL创建下列视图:</strong>
（1）创建视图View_score，包括学号、姓名、专业名称、学院名称、课程号、课程名、课程类型、开课学期，学分，教师号、教师名，职称，成绩等列内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_score</span><span class="w"> </span><span class="k">as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">sname</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">majoyname</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="p">,</span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">cname</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">ctype</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">term</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">credit</span><span class="p">,</span><span class="n">sc</span><span class="p">.</span><span class="n">tno</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">tname</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">majorno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_teacher</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">tno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">tno</span><span class="w">
</span></span></span></code></pre></div><p>（2）创建视图View_score_XY01和View_score_XY02 ，视图包含View_score的所有列，但前者只有“计算机学院”学生，后者只有“网络空间安全学院”的学生。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_score_XY01</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">svc</span><span class="p">.</span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;计算机学院&#39;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_score_XY02</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">svc</span><span class="p">.</span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;网络空间安全学院&#39;</span><span class="w">
</span></span></span></code></pre></div><p>（3）创建视图View_majoy，视图列包括专业号、专业名称、学院号、学院名称。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_majoy</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">majoyname</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">instno</span><span class="w">
</span></span></span></code></pre></div><p>（4）创建视图View_teacher，视图列包括教师号、教师名称，性别、职称、学院号、学院名称。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_teacher</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">tno</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">tname</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">tsex</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">instno</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_teacher</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w">
</span></span></span></code></pre></div><p>（5）创建视图View_course，视图列包括课程号、课程名称，课程类型、开课学期、学分、专业号、专业名称、学院号、学院名称。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_course</span><span class="w"> </span><span class="k">as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">cname</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">ctype</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">term</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">credit</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">majoyno</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">majoyname</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">majoyno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">instno</span><span class="w">
</span></span></span></code></pre></div><p>（6）创建视图View_student，视图列包括学号、姓名，性别、生日、班级、年级、专业号、专业名称、学院号、学院名称。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQl" data-lang="SQl"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">view_student</span><span class="w"> </span><span class="k">as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">sname</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">ssex</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">Birthday</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="k">class</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">grade</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">majorno</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">majoyname</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_major</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">majorno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">majoyno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">instno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">instno</span><span class="w">
</span></span></span></code></pre></div><p><strong>利用视图实现数据查询和统计:</strong></p>
<p>1）查询全校的教师的工号、姓名、所在学院名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">tno</span><span class="p">,</span><span class="n">tname</span><span class="p">,</span><span class="n">instname</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">view_teacher</span><span class="w">
</span></span></span></code></pre></div><p>2）查询授课教师的工号、姓名、讲授课程名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">tno</span><span class="p">,</span><span class="n">tname</span><span class="p">,</span><span class="n">cname</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span></code></pre></div><p>3）查询 “数据结构”课程的学生的学号、姓名、课程名、成绩、任课教师名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">score</span><span class="p">,</span><span class="n">tname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="w">
</span></span></span></code></pre></div><p>4）查询“计算机学院”所有学生的学号、姓名、课程名、成绩、任课教师名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">score</span><span class="p">,</span><span class="n">tname</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;计算机学院&#39;</span><span class="w">
</span></span></span></code></pre></div><p>5）查询所有授课的“教授”的工号、姓名和授课课程名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">tno</span><span class="p">,</span><span class="n">tname</span><span class="p">,</span><span class="n">cname</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;教授&#39;</span><span class="w">
</span></span></span></code></pre></div><p>6）统计“数据库”课程的最高分、最低分和平均成绩</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;最高分&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MIN</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;最低分&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AVG</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;平均分&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="w">
</span></span></span></code></pre></div><p>7）查询“数据库”课程高于平均分的学生学号和成绩</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;数据库&#39;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>8）查询平均分最高的课程号、课程名、任课教师、平均成绩</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">cno</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">tname</span><span class="p">,</span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">cno</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">tname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">avg_score</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><p>9）查询平均分高于75分的学号、姓名、平均成绩、专业名称、学院名称</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_score</span><span class="p">,</span><span class="n">majoyname</span><span class="p">,</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">majoyname</span><span class="p">,</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">having</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">75</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span></code></pre></div><p>10）查询计算机学院平均分高于75分的学生学号、姓名、平均成绩、专业名称</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_score</span><span class="p">,</span><span class="n">majoyname</span><span class="p">,</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">view_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">majoyname</span><span class="p">,</span><span class="n">instname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">having</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">instname</span><span class="o">=</span><span class="s1">&#39;计算机学院&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span></code></pre></div><h2 id="数据库关系图的关系">数据库关系图的关系</h2>
<p>在SSMS中，通过创建关系图可以定义基本表的主键与外部键约束。
（1）创建数据库“stuinfo1”
（2）利用SELECT的INTO子句将“stuinfo”数据库中的基本复制到“stuinfo1”数据库。T-SQL语句如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">stuinfo1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_institute</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_institute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_majoy</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_majoy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_teacher</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_teacher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_course</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_student</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">stuinfo</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">tab_score</span><span class="w">
</span></span></span></code></pre></div><p>（3）打开 “stuinfo1”数据库文件夹，选中“数据库关系图”，点击右键在快捷菜单中点击“新建数据库关系图”。
（4）在“添加表”对话框中将基本表添加到关系图编辑框中
（5）定义各个基本表的主键
（6）定义各基本表之间的外部键约束，同时关系图也创建了。
（7）关闭关系图编辑器，保存关系图。
（在实验报告中给出每个步骤的操作界面）</p>
<h2 id="触发器的使用">触发器的使用</h2>
<ol>
<li>操作准备
（1）在tab_student表中添加一个学生记录，如:
s020，王五，男，1999-8-9,  …”。
（2）在tab_score表中添加该学生的选课记录和成绩。</li>
<li>操作场景：学生“王五”退学处理。</li>
<li>具体操作要求如下：
设计一个删除tab_student表中记录的触发器，如果删除的记录是“王五”，则将该学生记录复制tab_student1表中，同时在tab_score表中删除该学生选课记录，并将该学生的记录复制tab_score1表中；否则禁止删除记录。</li>
<li>创建触发器</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">trig_delete</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">tab_student</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">DELETE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="s1">&#39;王五&#39;</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">sname</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">deleted</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">BEGIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	       </span><span class="n">PRINT</span><span class="w"> </span><span class="s1">&#39; This record not is 王五, Can not delete! &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	       </span><span class="k">ROLLBACK</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">BEGIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	     </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_student1</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">deleted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	     </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">tab_score1</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">tab_score</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_score</span><span class="p">,</span><span class="n">deleted</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">				</span><span class="k">WHERE</span><span class="w"> </span><span class="n">tab_score</span><span class="p">.</span><span class="n">sno</span><span class="o">=</span><span class="n">deleted</span><span class="p">.</span><span class="n">sno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	     </span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sno</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">sno</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">deleted</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>运行触发器
在SSMS的查询编辑器执行以下命令
（1）DELETE FROM  tab_student WHERE sname &lt;&gt; &lsquo;王五&rsquo;
然后打开tab_student、tab_student1、tab_score和tab_score1观察表记录。</li>
</ol>
<p>（2）DELETE FROM  tab_student WHERE sname= &lsquo;王五&rsquo;
然后打开tab_student、tab_student1、tab_score和tab_score1观察表记录。</p>
<h2 id="存储过程">存储过程</h2>
<p>存储过程是一个由SQL 语句和流程控制语句组成的程序，它存储在数据库内，可由应用程序通过一个调用执行。
存储过程允许用户声明变量、有条件执行以及其它的编程功能，可包含程序流以及对数据库的查询。它可以接受参数，也可返回参数，还可返回单个或多个结果集。
存储过程具有以下优点：
（1）可以在单个存储过程中执行一系列 SQL 语句。
（2）可以从自己的存储过程内引用其它存储过程，这可以简化一系列复杂语句。
（3）存储过程在创建时即在服务器上进行编译，所以执行起来比单个 SQL 语句快。</p>
<ol>
<li>创建存储过程
语句格式：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="o">&lt;</span><span class="err">存储过程名</span><span class="o">&gt;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="o">&lt;</span><span class="err">参数名</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="err">数据类型</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nb">VARYING</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="err">初值</span><span class="o">&gt;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">OUTPUT</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">,...</span><span class="n">n</span><span class="w"> </span><span class="p">]</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">RECOMPILE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ENCRYPTION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RECOMPILE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ENCRYPTION</span><span class="w"> </span><span class="err">}</span><span class="p">]</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AS</span><span class="w">  </span><span class="o">&lt;</span><span class="n">SQL语句组</span><span class="o">&gt;</span><span class="w"> 
</span></span></span></code></pre></div><ol start="2">
<li>执行存储过程
语句格式：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">EXECUTE</span><span class="w"> </span><span class="o">&lt;</span><span class="err">存储过程名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="err">参数</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">OUTPUT</span><span class="p">]]</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">,...</span><span class="n">n</span><span class="w"> </span><span class="p">]</span><span class="w"> 
</span></span></span></code></pre></div><ol start="3">
<li>删除存储过程
语句格式：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="o">&lt;</span><span class="err">存储过程名</span><span class="o">&gt;</span><span class="w">  
</span></span></span></code></pre></div><ol start="4">
<li>举例
例1 查询所有学生的选课和成绩信息。
（1）存储过程创建</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysobjects</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;stu_info_all&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_info_all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_info_all</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">score</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_scores</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  	     	</span><span class="n">tab_student</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="w"> 
</span></span></span></code></pre></div><p>（2）存储过程执行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">EXECUTE</span><span class="w"> </span><span class="n">stu_info_all</span><span class="w">
</span></span></span></code></pre></div><p>例2 根据姓名查询某个学生的学号、姓名、选修课程名和成绩信息。
（1）存储过程创建</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysobjects</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;stu_info_name&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_info_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_info_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="n">sname</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="n">sname</span><span class="p">,</span><span class="n">cname</span><span class="p">,</span><span class="n">score</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_scores</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">tab_student</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">sname</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="o">+@</span><span class="n">sname</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="w">
</span></span></span></code></pre></div><p>（2）存储过程执行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">EXECUTE</span><span class="w"> </span><span class="n">stu_info_name</span><span class="w"> </span><span class="s1">&#39;王&#39;</span><span class="w">
</span></span></span></code></pre></div><p>例3 根据姓名查询某个学生的平均成绩，并以参数形式返回。
（1）存储过程创建</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysobjects</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;stu_avg_score&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="n">sname</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="n">avg_score</span><span class="w"> </span><span class="nb">smallint</span><span class="w"> </span><span class="k">OUTPUT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">avg_score</span><span class="o">=</span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">sno</span><span class="o">=</span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">sno</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sname</span><span class="o">=@</span><span class="n">sname</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>（2）存储过程执行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">avg_score1</span><span class="w"> </span><span class="nb">smallint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXECUTE</span><span class="w"> </span><span class="n">stu_avg_score</span><span class="w"> </span><span class="s1">&#39;李四&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">avg_score1</span><span class="w"> </span><span class="k">OUTPUT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="o">@</span><span class="n">avg_score1</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PRINT</span><span class="w"> </span><span class="s1">&#39;ERROR: No this Student!&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PRINT</span><span class="w"> </span><span class="s1">&#39;The average score is &#39;</span><span class="o">+</span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">avg_score1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w">
</span></span></span></code></pre></div><p>例4  查询某一学期所有学生的姓名、最高分、最低分和平均成绩。</p>
<p>（1）存储过程创建</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/**************创建视图****************/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysobjects</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;View_score&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">View_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">View_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="p">,</span><span class="w"> </span><span class="n">sname</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cno</span><span class="p">,</span><span class="w"> </span><span class="n">cname</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">tno</span><span class="p">,</span><span class="w"> </span><span class="n">tname</span><span class="p">,</span><span class="n">term</span><span class="p">,</span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tab_score</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab_student</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">sno</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab_teacher</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">tno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">tno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab_course</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">cno</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/**************创建存储过程****************/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysobjects</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;stu_max_score&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_max_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">stu_max_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="n">term</span><span class="w"> </span><span class="nb">smallint</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">sname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">姓名</span><span class="p">,</span><span class="k">max</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="k">AS</span><span class="w"> </span><span class="err">最高分</span><span class="p">,</span><span class="k">min</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="k">AS</span><span class="w"> </span><span class="err">最低分</span><span class="p">,</span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">平均分</span><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">View_score</span><span class="w"> 	</span><span class="k">WHERE</span><span class="w"> </span><span class="n">term</span><span class="o">=@</span><span class="n">term</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sname</span><span class="w"> 
</span></span></span></code></pre></div><p>（2）存储过程执行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">EXECUTE</span><span class="w"> </span><span class="n">stu_max_score</span><span class="w">  </span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div>
    
  </article>
  <div class="paginator">
    
    <a class="link" href="/post/2023/12/%E5%9F%BA%E4%BA%8Eudp%E7%9A%84%E5%A4%9A%E4%BA%BA%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%AE%A4/">← prev</a>
    
    
    <a class="link" href="/post/2023/12/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">next →</a>
    
  </div>
  <div class="comment">
    
    
    
    
      
      <div class="giscus-wrapper">
        <script>
          
          const currentTheme = localStorage.getItem('theme') || 'light';
          const giscusTheme = currentTheme === 'light' ? 'light_tritanopia' : 'dark_tritanopia';
          
          
          const giscusScript = document.createElement('script');
          giscusScript.src = "https://giscus.app/client.js";
          giscusScript.setAttribute("data-repo", "Pi3-l22/Pi3-l22.github.io");
          giscusScript.setAttribute("data-repo-id", "R_kgDOMx7kWw");
          giscusScript.setAttribute("data-category", "Announcements");
          giscusScript.setAttribute("data-category-id", "DIC_kwDOMx7kW84CjHMe");
          giscusScript.setAttribute("data-mapping", "pathname");
          giscusScript.setAttribute("data-strict", "0");
          giscusScript.setAttribute("data-reactions-enabled", "1");
          giscusScript.setAttribute("data-emit-metadata", "0");
          giscusScript.setAttribute("data-input-position", "top");
          giscusScript.setAttribute("data-theme", giscusTheme);
          giscusScript.setAttribute("data-lang", "zh-CN");
          giscusScript.setAttribute("data-loading", "lazy");
          giscusScript.setAttribute("crossorigin", "anonymous");
          giscusScript.async = true;
          
          
          document.querySelector('.giscus-wrapper').appendChild(giscusScript);
        </script>
      </div>
      
      
    
    
    
  </div>
  
</main>

    <footer id="footer">
  <div>
    <span style="display: flex;align-items: center;">© 2021 - 2024<img src="https://p.sda1.dev/19/68796ec343c7a7eecbe99de4a9df6c66/rainbow.gif" width=20>By LiuChao</span>
  </div>
  
  

  

  <div class="footnote">
    <span><a class=link href=/index.xml><span class="iconfont icon-RSS"></span></a>  |  <a class=link href=https://github.com/Pi3-l22 Target=_ blank><span class="iconfont icon-GitHub"></span></a>  |  <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener><span class="iconfont icon-creative-commons-fill"></span></a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-WE6L6RF96W"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-WE6L6RF96W');
        }
      </script>
    
  




  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const currentTheme = localStorage.getItem('theme') || 'light';
      

      const lightStyle = document.querySelector('link[data-theme-style="light"]');
      const darkStyle = document.querySelector('link[data-theme-style="dark"]');
      
      
      const systemThemeMedia = window.matchMedia('(prefers-color-scheme: dark)');
      systemThemeMedia.addListener(function(e) {
        
        if (!localStorage.getItem('theme')) {
          const newTheme = e.matches ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          
          if (newTheme === 'light') {
            lightStyle.media = 'all';
            darkStyle.media = 'not all';
          } else {
            lightStyle.media = 'not all';
            darkStyle.media = 'all';
          }
          
          
          const giscusFrame = document.querySelector('iframe.giscus-frame');
          if (giscusFrame) {
            const giscusTheme = newTheme === 'light' ? 'light_tritanopia' : 'dark_tritanopia';
            giscusFrame.contentWindow.postMessage(
              { giscus: { setConfig: { theme: giscusTheme } } },
              'https://giscus.app'
            );
          }
        }
      });

      
      if (currentTheme === 'light') {
        lightStyle.media = 'all';
        darkStyle.media = 'not all';
      } else {
        lightStyle.media = 'not all';
        darkStyle.media = 'all';
      }

      
      function updateGiscusTheme() {
        const giscusFrame = document.querySelector('iframe.giscus-frame');
        if (giscusFrame) {
          const giscusTheme = currentTheme === 'light' ? 'light_tritanopia' : 'dark_tritanopia';
          giscusFrame.contentWindow.postMessage(
            { giscus: { setConfig: { theme: giscusTheme } } },
            'https://giscus.app'
          );
        } else {
          
          setTimeout(updateGiscusTheme, 1000);
        }
      }
      
      
      updateGiscusTheme();

      const themeToggle = document.querySelector('.theme-toggle');
      if (themeToggle) {
        themeToggle.textContent = currentTheme === 'light' ? '黑暗' : '明亮';
        
        themeToggle.addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'light' ? 'dark' : 'light';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          
          if (newTheme === 'light') {
            lightStyle.media = 'all';
            darkStyle.media = 'not all';
          } else {
            lightStyle.media = 'not all';
            darkStyle.media = 'all';
          }
          
          
          const giscusFrame = document.querySelector('iframe.giscus-frame');
          if (giscusFrame) {
            const giscusTheme = newTheme === 'light' ? 'light_tritanopia' : 'dark_tritanopia';
            giscusFrame.contentWindow.postMessage(
              { giscus: { setConfig: { theme: giscusTheme } } },
              'https://giscus.app'
            );
          }
          
          this.textContent = newTheme === 'light' ? '黑暗' : '明亮';
        });
      }
    });
  </script>

</body>

</html>
