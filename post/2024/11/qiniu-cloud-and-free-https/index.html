<!doctype html><html lang=zh-cn><head><script>(function(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=author content="LiuChao"><meta name=description content="七牛云图床与免费HTTPS证书配置"><link rel=icon href=https://blog.pi3.fun/favicon.ico><meta name=keywords content=" study  latex  life  academic "><meta property="og:url" content="https://blog.pi3.fun/post/2024/11/qiniu-cloud-and-free-https/"><meta property="og:site_name" content="Pi3's Notes"><meta property="og:title" content="七牛云图床与免费HTTPS证书"><meta property="og:description" content="七牛云图床与免费HTTPS证书配置"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-11-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-01T00:00:00+00:00"><meta property="article:tag" content="生活"><meta property="article:tag" content="博客"><link rel=canonical href=https://blog.pi3.fun/post/2024/11/qiniu-cloud-and-free-https/><meta itemprop=name content="七牛云图床与免费HTTPS证书"><meta itemprop=description content="七牛云图床与免费HTTPS证书配置"><meta itemprop=datePublished content="2024-11-01T00:00:00+00:00"><meta itemprop=dateModified content="2024-11-01T00:00:00+00:00"><meta itemprop=wordCount content="1741"><meta itemprop=keywords content="生活,博客"><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/common.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/content.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/theme.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/iconfont/iconfont.css><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/xcode.css data-theme-style=light media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/catppuccin-mocha.css data-theme-style=dark media="not all"><title>七牛云图床与免费HTTPS证书 - Pi3's Notes</title>
<link rel=stylesheet href=https://blog.pi3.fun/css/single.css><link href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.css rel=stylesheet><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.js></script><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],ignoredTags:["script","noscript","style","textarea","pre","code","option"],throwOnError:!1})})</script></head><body><div id=wrapper><header id=header><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Regular/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Italic/result.css><link rel=stylesheet href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css><h1><a href=https://blog.pi3.fun/>Pi3's Notes</a></h1><nav><span class=nav-bar-item><a class=link href=/>文章</a>
</span><span class=nav-bar-item><a class=link href=https://www.boyouquan.com/planet-shuttle>穿梭</a>
</span><span class=nav-bar-item><a class=link href=/about/>关于</a>
</span><span class=nav-bar-item><a class=link href=/links/>友链</a>
</span><span class=nav-bar-item><a class="link theme-toggle" href=javascript:void(0);>黑暗</a></span></nav></header><main id=main class=post><h1>七牛云图床与免费HTTPS证书</h1><div><b>Keywords: </b><a class=link href=https://blog.pi3.fun/tags/%E7%94%9F%E6%B4%BB>#生活</a>
<a class=link href=https://blog.pi3.fun/tags/%E5%8D%9A%E5%AE%A2>#博客</a></div><div><b>Release Date: </b><span>2024-11-01</span></div><details><summary><b>Table of Contents</b></summary><div class=toc><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#配置图床>配置图床</a></li><li><a href=#自定义源站域名>自定义源站域名</a></li><li><a href=#配置-cdn>配置 CDN</a></li></ul></nav></div></details><article class=content><p>前几天备案的域名终于审核通过了，也因此可以来配置一下图床和 CDN 了。</p><h2 id=前言>前言</h2><p>在此之前，我的博客上的图片都是存放在 GitHub 的公开仓库中，并且使用 jsDelivr 的 CDN 服务，但事实上 jsDelivr 的 CDN 在国内近几年基本上算是不可访问，连通情况时好时坏。</p><p><img src=https://cdn.pi3.fun/blog/202411012214524.png alt=image.png></p><p>同时，使用 GitHub 和 jsDelivr 作为图床服务，我也觉得不是很好，毕竟 GitHub 是代码仓库，jsDelivr 也是前端静态资源的 CDN 服务。于是，我决定将博客文章的图床迁移到国内的对象存储服务上。</p><p>在了解一番后，我也发现实际上国内的服务，无论是 CDN 还是对象存储，都有不少的弊端，其中最重要的一点就是域名需要备案，不过一些大厂的对象存储服务倒是提供了现成的域名，不需要自己准备备案的域名，但是缺点也很明显：收费贵且收费规则十分复杂。比如，阿里云的对象存储 oss 的计费项目就有：</p><ul><li>存储费用</li><li>流量费用</li><li>请求费用</li><li>数据处理费用</li><li>对象标签费用</li><li>传输加速费用</li><li>临时存储费用</li><li>DDoS 防护费用</li><li>数据索引费用</li><li>跨区域复制 RTC 费用</li></ul><p>最后，我选择了<a href=https://www.qiniu.com/>七牛云</a>的对象存储服务，因为它提供存储和 CDN 的免费额度，这些免费额度对于我来说完全足够了，也不需要先支付费用，等之后需要升级的时候再付费即可。</p><p>七牛云的对象存储免费额度包括：每月 10GB 的标准存储空间、每月 1000千次的 GET 请求、每月 100 千次的PUT/DELETE 请求以及每月 10 GB 的CDN回源流出流量。</p><p>七牛云的 CDN 服务免费额度包括：</p><p><img src=https://cdn.pi3.fun/blog/202411012230435.png alt=image.png></p><h2 id=配置图床>配置图床</h2><p>配置七牛云 + PicGo 图床并不难，网上的教程也很多，这里简单记录一下。</p><p>先在七牛云上创建一个空间，访问控制选择 <code>公开</code>，存储区域选择离自己近的地方。</p><p><img src=https://cdn.pi3.fun/blog/202411012234968.png alt=image.png></p><p>空间创建成功后还需要配置已经<strong class=chinese>备案的域名</strong>，默认提供的测试域名只保留 30 天。</p><p>接着配置 PicGo</p><p><img src=https://cdn.pi3.fun/blog/202411012238195.png alt=image.png></p><p>AccessKey 和 SecretKey 都在<a href=https://portal.qiniu.com/user/key>七牛云开发者平台</a><strong>个人中心-密钥管理</strong>中获取。</p><p>Bucket 为空间名称；访问网址为配置的备案域名（需要<a href=#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BA%90%E7%AB%99%E5%9F%9F%E5%90%8D>自定义源站域名</a>，可以先使用测试域名进行测试）；存储区域为选择区域的代号，华东浙江为 <code>z0</code>；存储路径为空间中的文件夹，没有则为根目录。</p><p><img src=https://cdn.pi3.fun/blog/202411012241475.png alt=image.png></p><p>以上便完成了七牛云 + PicGo 图床的配置。</p><p>除此之外，最好还是设置一下 Referer 防盗链对图片进行防护，以防别人盗取图片。配置了防盗链，图片只能在你设置的网站上显示。</p><p><img src=https://cdn.pi3.fun/blog/202411012258797.png alt=image.png></p><p>如果开启了 CDN 则需要在 CDN 中配置 Referer 防盗链，最好同时也配置一下告警。</p><p><img src=https://cdn.pi3.fun/blog/202411012300650.png alt=image.png></p><h2 id=自定义源站域名>自定义源站域名</h2><p>虽然没有<a href=#%E9%85%8D%E7%BD%AE%20CDN>配置 CDN</a> 服务，但是由于七牛云服务器在国内，实际上在国内区域有没有 CDN 的差别不是特别的大，而且选择的对象存储区域也是自己所在地，所以效果也不差，比 GitHub + jsDelivr 肯定是好了不少。</p><p><img src=https://cdn.pi3.fun/blog/202411012353697.png alt=image.png></p><p>配置自定义源站域名也很简单，在<a href=https://portal.qiniu.com/kodo/bucket/>七牛云 - 对象存储 - 空间管理</a><strong>选择空间-域名管理-自定义源站域名</strong>中添加已备案的域名，根据说明进行 CNAME 解析即可。</p><p><img src=https://cdn.pi3.fun/blog/202411012311928.png alt=image.png></p><p>接下来就是配置 HTTPS，这里我使用 <a href=https://ohttps.com/>ohttps</a> 的免费证书服务，虽然免费的Let&rsquo;s Encrypt 证书只支持 90 天有效期，但是 <a href=https://ohttps.com/>ohttps</a> 支持<strong class=chinese>自动更新</strong>和<strong class=chinese>自动部署</strong>。</p><p>注册 <a href=https://ohttps.com/>ohttps</a> 账户并登录，在<strong class=chinese>证书管理</strong>中选择<strong class=chinese>创建证书</strong>，选择免费的 Let&rsquo;s Encrypt 证书，并输入域名。</p><p><img src=https://cdn.pi3.fun/blog/202411012318345.png alt=image.png></p><p>接着根据提示进行 CNAME 域名解析，验证解析记录，等待 3~15 分钟即可创建证书。</p><p><img src=https://cdn.pi3.fun/blog/202411012319612.png alt=image.png></p><p>随后将证书的私钥文件和证书文件下载下来。</p><p><img src=https://cdn.pi3.fun/blog/202411012326340.png alt=image.png></p><p>到<a href=https://portal.qiniu.com/certificate/ssl>七牛云 - 证书管理</a>，分别上传对应的<strong class=chinese>私钥</strong>和<strong class=chinese>证书</strong>文件。</p><p><img src=https://cdn.pi3.fun/blog/202411012331041.png alt=image.png></p><p>最后回到 <a href=https://ohttps.com/>ohttps</a> 种，选择部署节点-添加结点，选择七牛云-SSL。</p><p><img src=https://cdn.pi3.fun/blog/202411012334279.png alt=image.png></p><p>同样输入<a href=https://portal.qiniu.com/user/key>七牛云开发者平台</a><strong>个人中心-密钥管理</strong>中获取的 AccessKey 和 SecretKey</p><p><img src=https://cdn.pi3.fun/blog/202411012335624.png alt=image.png></p><p>下一步，选择关联的证书，创建部署结点。</p><p><img src=https://cdn.pi3.fun/blog/202411012337976.png alt=image.png></p><p>回到<strong class=chinese>证书管理</strong>中选择相应的证书完成自动更新和自动部署的配置。</p><p><img src=https://cdn.pi3.fun/blog/202411012339795.png alt=image.png></p><h2 id=配置-cdn>配置 CDN</h2><p>由于七牛云还提供 CDN 的免费额度，于是我便想再给图床配置一个 CDN 服务。</p><p>在<a href=https://portal.qiniu.com/cdn/domain/create>七牛云 - 添加域名</a>，添加一个域名（需要备案），通信协议可以选择 HTTPS 但是针对 HTTPS 的请求流量没有免费额度，需要单独按量付费或者购买资源包（资源包包含 HTTP 和 HTTPS 的流量）。这里我不想付费，于是选择了 HTTP 协议。源站配置选择七牛云的存储空间，其他选项默认。最后完成 CNAME 解析就算配置成功了。</p><p><img src=https://cdn.pi3.fun/blog/202411012249273.png alt=image.png></p><p>但我满心欢喜将博客文章中的图片迁移到 CDN 的域名上时，我发现在电脑的浏览器上文章中的图片都不能显示，而手机上的浏览器则可以打开图片。经过一番研究，发现罪魁祸首就是没有启用 HTTPS 协议而是使用 HTTP 协议。</p><p>由于我的博客网站启用了 HTTPS 协议，但是图片却还是 HTTP 协议，请求图片时浏览器会自动将 HTTP 协议的请求转成 HTTPS 协议，控制台报错：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>Failed to load resource: net::ERR_CERT_COMMON_NAME_INVALID
</span></span></code></pre></div><p>导致了图片不能显示。相反在手机浏览器上对于 HTTP 不安全请求规则并不严格，所有依旧能够请求到图片。</p><p>最后尝试了很多解决方法，都不启作用，我也不想单独给 CDN 的 HTTPS 请求付费，于是无奈只能放弃 CDN，重新使用自定义源站域名。</p></article><div class=paginator><a class=link href=https://blog.pi3.fun/post/2024/10/interesting-regex-issues/>← prev</a>
<a class=link href=https://blog.pi3.fun/post/2024/11/python-scheduled-crawler/>next →</a></div><div class=comment><div id=tcomment></div><script src=https://registry.npmmirror.com/twikoo/1.6.39/files/dist/twikoo.min.js></script><script async>twikoo.init({envId:"https://twikoo.pi3.fun/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div></main><footer id=footer><div><span style=display:flex;align-items:center><span style=margin-right:.5rem>© 2021 - 2025</span><img src=https://cdn.pi3.fun/static/rainbow.gif loading=lazy width=20 alt=rainbow><span style=margin-left:.5rem>By Liu Chao</span></span></div><div class=footnote><span><a href=https://foreverblog.cn/go.html target=_blank><img src=https://img.foreverblog.cn/logo_en_default.png style=width:auto;height:16px></a> |
<a data-accent-color href=https://www.boyouquan.com/planet-shuttle style="font-size:16px;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6);background-clip:text;color:transparent">博友圈·星球穿梭</a><br><a class=link href=/index.xml><span class="iconfont icon-RSS"></span></a> | <a class=link href=https://github.com/Pi3-l22 target=_ blank><span class="iconfont icon-GitHub"></span></a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener><span class="iconfont icon-creative-commons-fill"></span></a></span></div><div class=blog-icon></div></footer></div><script>document.addEventListener("DOMContentLoaded",function(){const n=localStorage.getItem("theme")||"light",e=document.querySelector('link[data-theme-style="light"]'),t=document.querySelector('link[data-theme-style="dark"]'),i=window.matchMedia("(prefers-color-scheme: dark)");i.addListener(function(n){if(!localStorage.getItem("theme")){const s=n.matches?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),s==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const o=document.querySelector("iframe.giscus-frame");if(o){const e=s==="light"?"light_tritanopia":"dark_tritanopia";o.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}}}),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");function o(){const e=document.querySelector("iframe.giscus-frame");if(e){const t=n==="light"?"light_tritanopia":"dark_tritanopia";e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}else setTimeout(o,1e3)}o();const s=document.querySelector(".theme-toggle");s&&(s.textContent=n==="light"?"黑暗":"明亮",s.addEventListener("click",function(){const o=document.documentElement.getAttribute("data-theme"),n=o==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const s=document.querySelector("iframe.giscus-frame");if(s){const e=n==="light"?"light_tritanopia":"dark_tritanopia";s.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}this.textContent=n==="light"?"黑暗":"明亮"}))})</script><script src=https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){confetti({particleCount:150,spread:100})})</script></body></html>