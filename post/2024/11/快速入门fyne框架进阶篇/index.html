<!doctype html><html lang=zh-cn><head><script>(function(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=author content="LiuChao"><meta name=description content="快速入门 Go 语言 Fyne UI 框架进阶篇，自定义主题配置"><link rel=icon href=https://blog.pi3.fun/favicon.ico><meta name=keywords content=" study  latex  life  academic "><meta property="og:url" content="https://blog.pi3.fun/post/2024/11/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8fyne%E6%A1%86%E6%9E%B6%E8%BF%9B%E9%98%B6%E7%AF%87/"><meta property="og:site_name" content="Pi3's Notes"><meta property="og:title" content="快速入门Fyne框架：进阶篇"><meta property="og:description" content="快速入门 Go 语言 Fyne UI 框架进阶篇，自定义主题配置"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-11-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-11T00:00:00+00:00"><meta property="article:tag" content="技术"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Fyne"><link rel=canonical href=https://blog.pi3.fun/post/2024/11/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8fyne%E6%A1%86%E6%9E%B6%E8%BF%9B%E9%98%B6%E7%AF%87/><meta itemprop=name content="快速入门Fyne框架：进阶篇"><meta itemprop=description content="快速入门 Go 语言 Fyne UI 框架进阶篇，自定义主题配置"><meta itemprop=datePublished content="2024-11-11T00:00:00+00:00"><meta itemprop=dateModified content="2024-11-11T00:00:00+00:00"><meta itemprop=wordCount content="3393"><meta itemprop=keywords content="技术,Golang,Fyne"><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/common.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/content.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/theme.css><link media=screen rel=stylesheet href=https://blog.pi3.fun/css/iconfont/iconfont.css><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/xcode.css data-theme-style=light media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://blog.pi3.fun/css/syntax/catppuccin-mocha.css data-theme-style=dark media="not all"><title>快速入门Fyne框架：进阶篇 - Pi3's Notes</title>
<link rel=stylesheet href=https://blog.pi3.fun/css/single.css><link href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.css rel=stylesheet><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/katex.min.js></script><script defer src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-100-y/KaTeX/0.15.2/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],ignoredTags:["script","noscript","style","textarea","pre","code","option"],throwOnError:!1})})</script></head><body><div id=wrapper><header id=header><h1><a href=https://blog.pi3.fun/>Pi3's Notes</a></h1><nav><span class=nav-bar-item><a class=link href=/>文章</a>
</span><span class=nav-bar-item><a class=link href=/post/>归档</a>
</span><span class=nav-bar-item><a class=link href=/about/>关于</a>
</span><span class=nav-bar-item><a class=link href=/links/>友链</a>
</span><span class=nav-bar-item><a class="link theme-toggle" href=javascript:void(0);>黑暗</a></span></nav></header><main id=main class=post><h1>快速入门Fyne框架：进阶篇</h1><div><b>Keywords: </b><a class=link href=https://blog.pi3.fun/tags/%E6%8A%80%E6%9C%AF>#技术</a>
<a class=link href=https://blog.pi3.fun/tags/golang>#Golang</a>
<a class=link href=https://blog.pi3.fun/tags/fyne>#Fyne</a></div><details><summary><b>Table of Contents</b></summary><div class=toc><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#热重载>热重载</a></li><li><a href=#自定义主题>自定义主题</a><ul><li><a href=#主题接口>主题接口</a></li><li><a href=#自定义颜色>自定义颜色</a></li></ul></li><li><a href=#捆绑资源>捆绑资源</a><ul><li><a href=#bundle>bundle</a></li><li><a href=#自定义图标>自定义图标</a></li><li><a href=#自定义字体>自定义字体</a></li></ul></li></ul></nav></div></details><article class=content><p>快速入门 Go 语言 Fyne UI 框架进阶篇，自定义主题配置。</p><p><img src=https://image.pi3.fun/blog/fyne_go.jpg alt=fyne_go.jpg></p><ul><li>参考课程：<a href=https://www.bilibili.com/video/BV1kz421i7iB>Go语言+Fyne快速上手教程</a></li><li>参考文档：<a href=https://docs.fyne.io/>Fyne.io</a></li><li>笔记仓库：<a href=https://github.com/Slumhee/Go002Fyne-02_gofynetutorials02>InkkaPlum频道的Golang及Fyne框架教程的代码和文字版教程。</a></li></ul><h2 id=前言>前言</h2><p>在上一篇笔记中，我们学习了如何快速使用 Fyne 框架编写一个简易的 markdown 编辑器。其中提到了几个问题：</p><ol><li>Fyne 不支持热重载</li><li>自定义中文字体需要编写 <code>theme.go</code> 和 <code>util.go</code></li></ol><p>下面，我们同样通过 markdown 编辑器的例子来逐一解决这些问题。</p><h2 id=热重载>热重载</h2><p>可以通过 Air 工具来实现 Fyne 的热重载功能。此工具的开发者当初是因为 <code>Gin</code> 缺乏实时重载的功能而开发, 那么也顺便解决了 Fyne 学习者的问题。</p><p>GitHub 项目地址：<a href=https://github.com/air-verse/air>air: ☁️ Live reload for Go apps</a></p><p>配置非常简单：</p><p>安装 Air 工具</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install github.com/air-verse/air@latest
</span></span></code></pre></div><p>打开项目目录，运行以下命令，这会将具有默认设置的 <code>.air.toml</code> 配置文件初始化到当前目录。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>air init
</span></span></code></pre></div><p>在这之后，你只需执行 <code>air</code> 命令，无需额外参数，它就能使用 <code>.air.toml</code> 文件中的配置了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>air
</span></span></code></pre></div><p>通过执行 <code>air</code> 指令替代原先的 <code>go run .</code> 指令启动项目，项目就可以支持热重载了。</p><h2 id=自定义主题>自定义主题</h2><h3 id=主题接口>主题接口</h3><p>Fyne 的主题实际上就是一个<strong class=chinese>接口</strong><code>fyne.Theme</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Theme</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Color</span><span class=p>(</span><span class=nx>ThemeColorName</span><span class=p>,</span> <span class=nx>ThemeVariant</span><span class=p>)</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Color</span>  <span class=c1>// 颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Font</span><span class=p>(</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>Resource</span>  <span class=c1>// 字体
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Icon</span><span class=p>(</span><span class=nx>ThemeIconName</span><span class=p>)</span> <span class=nx>Resource</span>  <span class=c1>// 图标
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Size</span><span class=p>(</span><span class=nx>ThemeSizeName</span><span class=p>)</span> <span class=kt>float32</span>  <span class=c1>// 大小
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>要实现自定义的主题，我们只需要定义一个自定义主题并实现这个接口中的所有函数，即实现这个接口。</p><p>比如我定义了一个自定义主题 <code>myTheme</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>myTheme</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span></code></pre></div><p>在这里，官方文档中提到，最好通过<strong class=chinese>断言</strong>我们实现的这个接口，以便编译错误时更接近错误的位置。即通过以下代码实现<strong class=chinese>断言</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>_</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Theme</span> <span class=p>=</span> <span class=p>(</span><span class=o>*</span><span class=nx>myTheme</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)</span>
</span></span></code></pre></div><p>举个例子方便理解：比如当我们写了以上断言代码后，由于没有实现接口的全部函数，导致程序报错，这时程序会直接定位到 <code>theme.go</code> 中的错误。比如以下报错信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>.</span><span class=err>\</span><span class=nx>theme</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>29</span><span class=p>:</span><span class=mi>20</span><span class=p>:</span> <span class=nx>cannot</span> <span class=nf>use</span> <span class=p>(</span><span class=o>*</span><span class=nx>myTheme</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)</span> <span class=p>(</span><span class=nx>value</span> <span class=nx>of</span> <span class=kd>type</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nx>as</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Theme</span> <span class=nx>value</span> <span class=nx>in</span> <span class=nx>variable</span> <span class=nx>declaration</span><span class=p>:</span> <span class=o>*</span><span class=nx>myTheme</span> <span class=nx>does</span> <span class=nx>not</span> <span class=nx>implement</span> <span class=nx>fyne</span><span class=p>.</span><span class=nf>Theme</span> <span class=p>(</span><span class=nx>missing</span> <span class=nx>method</span> <span class=nx>Size</span><span class=p>)</span>
</span></span></code></pre></div><p>但是，如果我们没有写以上断言的代码后，程序由于没有实现接口而报错，程序也许会定位到 <code>main.go</code> 中，错误位置不够清晰，难以寻找到真实的错误原因。比如以下报错信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>.</span><span class=err>\</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span><span class=mi>24</span><span class=p>:</span> <span class=nx>cannot</span> <span class=nx>use</span> <span class=o>&amp;</span><span class=nx>myTheme</span><span class=p>{</span><span class=err>…</span><span class=p>}</span> <span class=p>(</span><span class=nx>value</span> <span class=nx>of</span> <span class=kd>type</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nx>as</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Theme</span> <span class=nx>value</span> <span class=nx>in</span> <span class=nx>argument</span> <span class=nx>to</span> <span class=nx>a</span><span class=p>.</span><span class=nf>Settings</span><span class=p>().</span><span class=nx>SetTheme</span><span class=p>:</span> <span class=o>*</span><span class=nx>myTheme</span> <span class=nx>does</span> <span class=nx>not</span> <span class=nx>implement</span> <span class=nx>fyne</span><span class=p>.</span><span class=nf>Theme</span> <span class=p>(</span><span class=nx>missing</span> <span class=nx>method</span> <span class=nx>Size</span><span class=p>)</span>
</span></span></code></pre></div><p>因此，在这里使用断言代码，断言我们实现的接口的好处在于：提高代码的健壮性和可维护性。</p><h3 id=自定义颜色>自定义颜色</h3><p>接下来，我们想要实现一个自定义的主题，就可以新建一个 <code>theme.go</code> 文件，在其中去实现 Fyne 定义的 Theme 接口。</p><p>比如我们想要自定义颜色，就去实现 <code>Color</code> 函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 导入颜色包，这里需要从 &#34;image/color&#34; 导入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=s>&#34;image/color&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义一个名为 myTheme 的结构体，假设它实现了 fyne.Theme 接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>myTheme</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 这里可以定义其他与主题相关的字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Color 方法实现了 fyne.Theme 接口中的 Color 方法
</span></span></span><span class=line><span class=cl><span class=c1>// name 是颜色名称，variant 是主题变体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Color</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeColorName</span><span class=p>,</span> <span class=nx>variant</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeVariant</span><span class=p>)</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 检查颜色名称是否为背景色
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>name</span> <span class=o>==</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameBackground</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果是亮色主题
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=nx>variant</span> <span class=o>==</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>VariantLight</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 返回白色作为背景色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>R</span><span class=p>:</span> <span class=mi>254</span><span class=p>,</span> <span class=nx>G</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=nx>B</span><span class=p>:</span> <span class=mi>216</span><span class=p>,</span> <span class=nx>A</span><span class=p>:</span> <span class=mh>0xff</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 否则暗色主题，返回黑色作为背景色
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>R</span><span class=p>:</span> <span class=mi>149</span><span class=p>,</span> <span class=nx>G</span><span class=p>:</span> <span class=mi>125</span><span class=p>,</span> <span class=nx>B</span><span class=p>:</span> <span class=mi>173</span><span class=p>,</span> <span class=nx>A</span><span class=p>:</span> <span class=mh>0xff</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 对于其他颜色名称，调用默认主题的 Color 方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Color</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>variant</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>当然，前面提到过，要想使自定义主题有效，就必须要让我们的 <code>myTheme</code> 去实现 <code>Theme</code> 的所有方法。因此，即使我们只是设置一个主题颜色，我们仍然需要实现其他方法。如果不需要修改，则可直接返回默认值，但方法必须被实现！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeIconName</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Size</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeSizeName</span><span class=p>)</span> <span class=kt>float32</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Size</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>style</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Font</span><span class=p>(</span><span class=nx>style</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>最后，只需要在 <code>main.go</code> 中添加以下代码，则可以将我们自定义的主题引入程序中。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nf>Settings</span><span class=p>().</span><span class=nf>SetTheme</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>myTheme</span><span class=p>{})</span>
</span></span></code></pre></div><p><img src=https://image.pi3.fun/blog/202411121525912.png alt=image.png></p><p><img src=https://image.pi3.fun/blog/202411121526349.png alt=image.png></p><blockquote><p>这里没有设置输入框 <code>theme.ColorNameInputBackground</code> 的颜色，所以显示了默认的黑白颜色。</p></blockquote><p>以上就是设置一个自定义<strong class=chinese>背景颜色</strong>的代码和效果，如果我们想要同时设置<strong class=chinese>其他控件</strong>的颜色，我们可以利用 Go 语言的 <code>switch</code> 语言来逐一判断并设置颜色。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Color 方法实现了 fyne.Theme 接口中的 Color 方法 
</span></span></span><span class=line><span class=cl><span class=c1>// m 是指向 myTheme 结构体的指针，允许方法修改 myTheme 的状态 
</span></span></span><span class=line><span class=cl><span class=c1>// n 是颜色名称，v 是主题变体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Color</span><span class=p>(</span><span class=nx>n</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeColorName</span><span class=p>,</span> <span class=nx>v</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeVariant</span><span class=p>)</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=nx>n</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameBackground</span><span class=p>:</span>  <span class=c1>// 背景色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>190</span><span class=p>,</span> <span class=mi>233</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameButton</span><span class=p>:</span>  <span class=c1>// 按钮颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>122</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameDisabledButton</span><span class=p>:</span>  <span class=c1>// 禁用按钮颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>142</span><span class=p>,</span> <span class=mi>142</span><span class=p>,</span> <span class=mi>147</span><span class=p>,</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameHover</span><span class=p>:</span>  <span class=c1>// 悬停时的颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameFocus</span><span class=p>:</span>  <span class=c1>// 焦点时的颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>255</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>ColorNameShadow</span><span class=p>:</span>  <span class=c1>// 阴影颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>50</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=p>:</span>  <span class=c1>// 其他没有匹配到的控件 设置为默认主题颜色
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Color</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span> <span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>同理，要想自定义字体、图标和大小，也是利用相似的步骤，实现对应的方法即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeIconName</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span><span class=err>……</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Size</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeSizeName</span><span class=p>)</span> <span class=kt>float32</span> <span class=p>{</span><span class=err>……</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>style</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span><span class=err>……</span><span class=p>}</span>
</span></span></code></pre></div><p>不过在自定义字体和图标之前，需要先要了解和学习一下关于 Fyne 的捆绑资源操作。</p><h2 id=捆绑资源>捆绑资源</h2><h3 id=bundle>bundle</h3><p>我们都知道基于 Go 的应用程序通常构建为单个二进制可执行文件，这使得我们分发使用十分的方便，Fyne 应用程序也是如此。</p><p>但不幸的是 GUI 应用程序通常需要<strong class=chinese>额外的资源</strong>来呈现用户界面，比如图片、字体、音频等等。为了应对这一挑战，Go 应用程序可以将资产捆绑到二进制文件本身中。</p><p>Fyne 工具包更喜欢使用 <code>fyne bundle</code>，因为它具有各种好处，我们将在下面探讨。</p><p>如果我们想要将一张图片捆绑到应用程序中，使得程序在运行时可以被使用，则我们可以执行下面的指令来捆绑资源：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fyne</span> <span class=nx>bundle</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>bundled</span><span class=p>.</span><span class=k>go</span> <span class=nx>image</span><span class=p>.</span><span class=nx>png</span>
</span></span></code></pre></div><p>同时以上代码会在文件夹中生成一个 <code>bundled.go</code> 文件，其中直接包含了我们捆绑的图片的<strong class=chinese>二进制数据</strong>，这样我们就可以在程序中使用图片，而不需要带上这张图片。</p><p>事实上，它的所有二进制信息已经在代码变量中了。比如下方 <code>bundled.go</code> 文件中的 <code>StaticContent</code> 就存放了图片 <code>image.png</code> 的所有二进制数据。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>resourceImagePng</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>fyne</span><span class=p>.</span><span class=nx>StaticResource</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>StaticName</span><span class=p>:</span> <span class=s>&#34;image.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>StaticContent</span><span class=p>:</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>不过需要注意的是，重复执行 <code>fyne bundle -o bundled.go image.png</code> 会相互覆盖。如果想捆绑多个资源，可以使用 <code>-append</code> 追加资源：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fyne</span> <span class=nx>bundle</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>bundled</span><span class=p>.</span><span class=k>go</span> <span class=nx>image1</span><span class=p>.</span><span class=nx>png</span>
</span></span><span class=line><span class=cl><span class=nx>fyne</span> <span class=nx>bundle</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>bundled</span><span class=p>.</span><span class=k>go</span> <span class=o>-</span><span class=nx>append</span> <span class=nx>image2</span><span class=p>.</span><span class=nx>png</span>
</span></span></code></pre></div><p>接着，就可以在程序中使用这些捆绑的资源。比如在 canvas 上加载一个图像：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>img</span> <span class=o>:=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nf>NewImageFromResource</span><span class=p>(</span><span class=nx>resourceImagePng</span><span class=p>)</span>
</span></span></code></pre></div><p>注意这里的 <code>resourceImagePng</code> 资源名称是有规则的。比如我捆绑了 <code>image1.png</code> 和 <code>image2.png</code> 两张图片，则它们对应的资源名称就为 <code>resourceImage1Png</code> 和 <code>resourceImage2Png</code>。</p><blockquote><p>默认命名规则为，文件名开头字母一定大写，文件后缀名开头一定大写，其他保持原样。即 <code>resource&lt;Name>&lt;Ext></code></p></blockquote><h3 id=自定义图标>自定义图标</h3><p>了解了 Fyne 的捆绑资源操作，接上一节，我们就可以通过绑定资源来自定义图标。</p><p>比如，我们捆绑了一张 <code>icon.jpeg</code> 图片，想要让它替换掉默认的 Home 图标。只需要在 <code>theme.go</code> 中修改实现 <code>Icon</code> 方法的代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeIconName</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>name</span> <span class=o>==</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>IconNameHome</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>resourceIconJpeg</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这样就可以将默认的 Home 图标，替换为自己的图片。在代码中同样使用 Home 图标即可。比如下面使用 Home 图标 <code>theme.HomeIcon()</code> 创建了一个图标按钮。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>widget</span><span class=p>.</span><span class=nf>NewButtonWithIcon</span><span class=p>(</span><span class=s>&#34;Home&#34;</span><span class=p>,</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>HomeIcon</span><span class=p>(),</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{})</span>
</span></span></code></pre></div><blockquote><p>Fyne 内置了一些常用的图标。在 <a href=https://docs.fyne.io/explore/icons>主题图标 |Fyne.io</a> 中可以查看所有图标。</p></blockquote><h3 id=自定义字体>自定义字体</h3><p>对于自定义字体也可以是类似的方法。通过 <code>fyne bundle</code> 将字体文件绑定进 <code>bundle.go</code>，在 <code>theme.go</code> 中实现 <code>Font</code> 方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>style</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>resourceNotoSansHansRegularTtf</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在 <code>main.go</code> 中设置主题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nf>Settings</span><span class=p>().</span><span class=nf>SetTheme</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>myTheme</span><span class=p>{})</span>
</span></span></code></pre></div><p>这样就完成了字体的引入，但是这样的方法也有缺点，就是体积非常大！<code>NotoSansHans-Regular.ttf</code> 字体体积为 <strong>8.5 MB</strong>，但是引入了 <code>bundle.go</code> 文件后，<code>bundle.go</code> 的文件体积就变为了 <strong>21.3 MB</strong>。</p><hr><p>还有一种方法就是先在 <code>theme.go</code> 中的 <code>myTheme</code> 结构体中增加一个字体字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>myTheme</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>font</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>接着就是实现 Font 方法，这里只需要返回结构体中的 Font 字段的数据。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>s</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>font</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>具体的读取字体数据的步骤，我们可以新建一个 <code>util.go</code> 文件或者也可以直接写在 <code>theme.go</code> 中，在其中实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;os&#34;</span>  <span class=c1>// 导入 os 包，用于文件操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>&#34;log&#34;</span> <span class=c1>// 导入 log 包，用于日志记录
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// loadFont 函数用于加载指定路径的字体文件
</span></span></span><span class=line><span class=cl><span class=c1>// 参数 fontPath 是字体文件的路径，返回值是字体文件的字节切片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>loadFont</span><span class=p>(</span><span class=nx>fontPath</span> <span class=kt>string</span><span class=p>)</span> <span class=p>[]</span><span class=kt>byte</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用 os.ReadFile 读取字体文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// fontData 存储读取到的字节数据，err 存储可能发生的错误
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fontData</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>fontPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果读取字体文件时发生错误，记录错误信息并终止程序
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;无法加载字体文件: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回加载的字体文件数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>fontData</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>最后就可以在 <code>main.go</code> 中引入这个字体，具体方法为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 使用 loadFont 函数加载指定路径的字体文件，并将其作为静态资源创建
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>customFont</span> <span class=o>:=</span> <span class=nx>fyne</span><span class=p>.</span><span class=nf>NewStaticResource</span><span class=p>(</span><span class=s>&#34;NotoSansHans.ttf&#34;</span><span class=p>,</span> <span class=nf>loadFont</span><span class=p>(</span><span class=s>&#34;NotoSansHans-Regular.ttf&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>// 设置应用程序的主题为自定义主题，并将加载的字体应用于该主题
</span></span></span><span class=line><span class=cl><span class=c1>// myTheme 是自定义主题的结构体，其中包含字体信息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nf>Settings</span><span class=p>().</span><span class=nf>SetTheme</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>myTheme</span><span class=p>{</span><span class=nx>font</span><span class=p>:</span> <span class=nx>customFont</span><span class=p>})</span>
</span></span></code></pre></div><p>这也是上一篇教程中引入中文字体的方法。这个方法没有将字体文件捆绑在程序中，而是在程序执行时读取字体文件，所以这种自定义字体的方式，需要带上字体文件一起分发，也不是很方便。</p><p><img src=https://image.pi3.fun/blog/202411121802447.png alt=image.png></p><hr><p>用同样的方法，我们可以分别设置字体的粗体、斜体和等宽体显示的样式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>myTheme</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>regular</span>   <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl>    <span class=nx>bold</span>      <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl>    <span class=nx>italic</span>    <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl>    <span class=nx>monospace</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>s</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Monospace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>monospace</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Bold</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>bold</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Italic</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>italic</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>regular</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>利用类型的思路，还有更高阶全面的设置方法，同样要另外带上字体文件。</p><p><code>theme.go</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>myTheme</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>regular</span><span class=p>,</span> <span class=nx>bold</span><span class=p>,</span> <span class=nx>italic</span><span class=p>,</span> <span class=nx>boldItalic</span><span class=p>,</span> <span class=nx>monospace</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Color</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeColorName</span><span class=p>,</span> <span class=nx>variant</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeVariant</span><span class=p>)</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Color</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>variant</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeIconName</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Icon</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Font</span><span class=p>(</span><span class=nx>style</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>TextStyle</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>style</span><span class=p>.</span><span class=nx>Monospace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>monospace</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>style</span><span class=p>.</span><span class=nx>Bold</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>style</span><span class=p>.</span><span class=nx>Italic</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>boldItalic</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>bold</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>style</span><span class=p>.</span><span class=nx>Italic</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>italic</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>regular</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>Size</span><span class=p>(</span><span class=nx>name</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>ThemeSizeName</span><span class=p>)</span> <span class=kt>float32</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>DefaultTheme</span><span class=p>().</span><span class=nf>Size</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>myTheme</span><span class=p>)</span> <span class=nf>SetFonts</span><span class=p>(</span><span class=nx>regularFontPath</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>monoFontPath</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nx>regular</span> <span class=p>=</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>TextFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nx>bold</span> <span class=p>=</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>TextBoldFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nx>italic</span> <span class=p>=</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>TextItalicFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nx>boldItalic</span> <span class=p>=</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>TextBoldItalicFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nx>monospace</span> <span class=p>=</span> <span class=nx>theme</span><span class=p>.</span><span class=nf>TextMonospaceFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>regularFontPath</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>regular</span> <span class=p>=</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>regularFontPath</span><span class=p>,</span> <span class=s>&#34;Regular&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>regular</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>bold</span> <span class=p>=</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>regularFontPath</span><span class=p>,</span> <span class=s>&#34;Bold&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>bold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>italic</span> <span class=p>=</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>regularFontPath</span><span class=p>,</span> <span class=s>&#34;Italic&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>italic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>boldItalic</span> <span class=p>=</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>regularFontPath</span><span class=p>,</span> <span class=s>&#34;BoldItalic&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>boldItalic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>monoFontPath</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>monospace</span> <span class=p>=</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>monoFontPath</span><span class=p>,</span> <span class=s>&#34;Regular&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>monospace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nx>monospace</span> <span class=p>=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>regular</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>loadCustomFont</span><span class=p>(</span><span class=nx>env</span><span class=p>,</span> <span class=nx>variant</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>fallback</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span><span class=p>)</span> <span class=nx>fyne</span><span class=p>.</span><span class=nx>Resource</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>variantPath</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Replace</span><span class=p>(</span><span class=nx>env</span><span class=p>,</span> <span class=s>&#34;Regular&#34;</span><span class=p>,</span> <span class=nx>variant</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fyne</span><span class=p>.</span><span class=nf>LoadResourceFromPath</span><span class=p>(</span><span class=nx>variantPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fyne</span><span class=p>.</span><span class=nf>LogError</span><span class=p>(</span><span class=s>&#34;Error loading specified font&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>fallback</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>main.go</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 设置主题
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>t</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>myTheme</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=nx>t</span><span class=p>.</span><span class=nf>SetFonts</span><span class=p>(</span><span class=s>&#34;./assets/font/Consolas-with-Yahei Regular Nerd Font.ttf&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 注意&#34;./assets/font&#34;目录下有4个文件:
</span></span></span><span class=line><span class=cl><span class=c1>// Consolas-with-Yahei Bold Nerd Font.ttf
</span></span></span><span class=line><span class=cl><span class=c1>// Consolas-with-Yahei BoldItalic Nerd Font.ttf
</span></span></span><span class=line><span class=cl><span class=c1>// Consolas-with-Yahei Italic Nerd Font.ttf
</span></span></span><span class=line><span class=cl><span class=c1>// Consolas-with-Yahei Regular Nerd Font.ttf
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nf>Settings</span><span class=p>().</span><span class=nf>SetTheme</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span></code></pre></div></article><div class=paginator><a class=link href=https://blog.pi3.fun/post/2024/go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A85%E8%BF%90%E7%AE%97%E7%AC%A6/>← prev</a>
<a class=link href=https://blog.pi3.fun/post/2024/go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A86%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/>next →</a></div><div class=comment><div id=tcomment></div><script src=https://registry.npmmirror.com/twikoo/1.6.39/files/dist/twikoo.min.js></script><script async>twikoo.init({envId:"https://twikoo.pi3.fun/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div></main><footer id=footer><div><span style=display:flex;align-items:center><span style=margin-right:.5rem>© 2021 - 2024</span><img src=https://image.pi3.fun/static/rainbow.gif loading=lazy width=20 alt=rainbow><span style=margin-left:.5rem>By Liu Chao</span></span></div><div class=footnote><span><a href=https://www.foreverblog.cn/ target=_blank><img src=https://img.foreverblog.cn/logo_en_default.png style=width:auto;height:16px></a> | <a class=link href=https://blogscn.fun/ target=_blank><img src=https://photo.xiangming.site/img/blogscn.png style=width:auto;height:15px></a><br><a class=link href=/index.xml><span class="iconfont icon-RSS"></span></a> | <a class=link href=https://github.com/Pi3-l22 target=_ blank><span class="iconfont icon-GitHub"></span></a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener><span class="iconfont icon-creative-commons-fill"></span></a></span></div><div class=blog-icon></div></footer></div><script>document.addEventListener("DOMContentLoaded",function(){const n=localStorage.getItem("theme")||"light",e=document.querySelector('link[data-theme-style="light"]'),t=document.querySelector('link[data-theme-style="dark"]'),i=window.matchMedia("(prefers-color-scheme: dark)");i.addListener(function(n){if(!localStorage.getItem("theme")){const s=n.matches?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),s==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const o=document.querySelector("iframe.giscus-frame");if(o){const e=s==="light"?"light_tritanopia":"dark_tritanopia";o.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}}}),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");function o(){const e=document.querySelector("iframe.giscus-frame");if(e){const t=n==="light"?"light_tritanopia":"dark_tritanopia";e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}else setTimeout(o,1e3)}o();const s=document.querySelector(".theme-toggle");s&&(s.textContent=n==="light"?"黑暗":"明亮",s.addEventListener("click",function(){const o=document.documentElement.getAttribute("data-theme"),n=o==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),n==="light"?(e.media="all",t.media="not all"):(e.media="not all",t.media="all");const s=document.querySelector("iframe.giscus-frame");if(s){const e=n==="light"?"light_tritanopia":"dark_tritanopia";s.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}this.textContent=n==="light"?"黑暗":"明亮"}))})</script></body></html>